{
  "name" : "1211.4321.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "Bayesian nonparametric models for ranked data",
    "authors" : [ "François Caron", "Yee Whye Teh" ],
    "emails" : [ ],
    "sections" : [ {
      "heading" : null,
      "text" : "IS S\nN 02\n49 -6\n39 9\nIS R\nN IN\nR IA\n/R R\n-- 81\n40 --\nFR +E\nN G\nRESEARCH REPORT N° 8140 November 19, 2012\nProject-Team ALEA\nBayesian nonparametric models for ranked data François Caron, Yee Whye Teh\nar X\niv :1\n21 1.\n43 21\nv1 [\nst at\n.M L\n] 1\n9 N\nov 2\n01 2\nRESEARCH CENTRE BORDEAUX – SUD-OUEST\n351, Cours de la Libération Bâtiment A 29 33405 Talence Cedex\nBayesian nonparametric models for ranked data\nFrançois Caron∗, Yee Whye Teh†\nProject-Team ALEA\nResearch Report n° 8140 — November 19, 2012 — 18 pages\nAbstract: We develop a Bayesian nonparametric extension of the popular Plackett-Luce choice model that can handle an infinite number of choice items. Our framework is based on the theory of random atomic measures, with the prior specified by a gamma process. We derive a posterior characterization and a simple and effective Gibbs sampler for posterior simulation. We develop a time-varying extension of our model, and apply it to the New York Times lists of weekly bestselling books.\nKey-words: choice models, generalized Bradley-Terry model, Plackett-Luce model, gamma process, Markov Chain Monte Carlo\n∗ INRIA Bordeaux Sud-Ouest, Institut de Mathématiques de Bordeaux, University of Bordeaux, France † Department of Statistics, Oxford University, United Kingdom\nModèles bayésiens non paramétriques pour les données de rang Résumé : On s’intéresse dans ce rapport à une extension bayésienne non paramétrique du modèle de Plackett-Luce pour les données de rang, pouvant traiter un nombre potentiellement infini d’éléments. Notre cadre se base sur la théorie des mesures complètement aléatoires, avec comme a priori un processus de gamma. Nous dérivons une caractérisation de la loi a posteriori et un échantillonneur de Gibbs simple pour approcher la loi a posteriori. Nous développons également une version dynamique de notre modèle, et l’appliquons aux listes hebdomadaires des 20 meilleures ventes du New York Times.\nMots-clés : Modèles de choix, modèle de Bradley-Terry généralisé, modèle de Plackett-Luce, processus de gamma, méthodes de Monte Carlo par chaı̂ne de Markov\nBayesian nonparametric models for ranked data 3"
    }, {
      "heading" : "1 Introduction",
      "text" : "Data in the form of partial rankings, i.e. in terms of an ordered list of the top-m items, arise in many contexts. For example, in this paper we consider datasets consisting of the top 20 bestselling books as published each week by the New York Times. The Plackett-Luce model [1, 2] is a popular model for modeling such partial rankings of a finite collection ofM items. It has found many applications, including choice modeling [3], sport ranking [4], and voting [5]. [6, Chap. 9] provides detailed discussions on the statistical foundations of this model.\nIn the Plackett-Luce model, each item k ∈ [M ] = {1, . . . ,M} is assigned a positive rating parameter wk, which represents the desirability or rating of a product in the case of choice modeling, or the skill of a player in sport rankings. The Plackett-Luce model assumes the following generative story for a top-m list ρ = (ρ1, . . . , ρm) of items ρi ∈ [M ]: At each stage i = 1, . . . ,m, an item is chosen to be the ith item in the list from among the items that have not yet appeared, with the probability that ρi is selected being proportional to its desirability wρi . The overall probability of a given partial ranking ρ is then:\nP (ρ) = m∏ i=1 wρi(∑M k=1 wk ) − (∑i−1 j=1 wρj ) . (1)\nwith the denominator in (1) being the sum over all items not yet selected at stage i. In many situations the collection of available items can be very large and potentially unknown. In this case, a nonparametric approach can be sensible, where the pool of items is assumed to be infinite and the model allows for the possibility of items not observed in previous top-m lists to appear in new ones. In this paper we propose such a Bayesian nonparametric Plackett-Luce model. Our approach is built upon recent work on Bayesian inference for the (finite) Plackett-Luce model and its extensions [7, 8, 9]. Our model assumes the existence of an infinite pool of items {Xk}∞k=1, each with its own rating parameter, {wk}∞k=1. The probability of a top-m list of items, say (Xρ1 , . . . , Xρm), is then a direct extension of the finite case (1):\nP (Xρ1 , . . . , Xρm) = m∏ i=1 wρi(∑∞ k=1 wk ) − (∑i−1 j=1 wρj ) . (2)\nTo formalize the framework, a natural representation to encapsulate the pool of items along with their ratings is using an atomic measure:\nG = ∞∑ k=1 wkδXk (3)\nUsing this representation, note that the top item Xρ1 in our list is simply a draw from the probability measure obtained by normalizing G, while subsequent items in the top-m list are draws from probability measures obtained by first removing from G the atoms corresponding to previously picked items and normalizing. Described this way, it is clear that the Plackett-Luce model is basically a partial size-biased permutation of the atoms in G [10], and the existing machinery of random measures and exchangeable random partitions [11] can be brought to bear on our problem.\nIn particular, in Section 2 we will use a gamma process as the prior over the atomic measureG. This is a completely random measure [12] with gamma marginals, such that the corresponding normalized probability measure is a Dirichlet process. We will show that with the introduction of a suitable set of auxiliary variables, we can characterize the posterior law ofG given observations of top-m lists distributed according to (2). A simple Gibbs sampler can then be derived to simulate from the posterior distribution. In Section 3 we develop a time-varying extension of our model and derive a simple and effective Gibbs sampler for posterior simulation. In Section 4 we apply our time-varying Bayesian nonparametric PlackettLuce model to the aforementioned New York Times bestsellers datasets, and conclude in Section 5.\nRR n° 8140\nBayesian nonparametric models for ranked data 4"
    }, {
      "heading" : "2 A Bayesian nonparametric model for partial ranking",
      "text" : "We start this section by briefly describing a Bayesian approach to inference in finite Plackett-Luce models [9], and taking the infinite limit to arrive at the nonparametric model. This will give good intuitions for how the model operates, before we rederive the same nonparametric model more formally using gamma processes. Throughout this paper we will suppose that our data consists of L partial rankings, with ρ` = (ρ`1, . . . , ρ`m) for ` ∈ [L]. For notational simplicity we assume that all the partial rankings are length m."
    }, {
      "heading" : "2.1 Finite Plackett-Luce model with gamma prior",
      "text" : "Suppose we have M choice items, with item k ∈ [M ] having a positive desirability parameter wk. A partial ranking ρ` = (ρ`1, . . . , ρ`m) can be constructed generatively by picking the ith item ρ`i at the ith stage for i = 1, . . . ,m, with probability proportional to wρ`i as in (1). An alternative Thurstonian interpretation, which will be important in the following, is as follows: For each item k let z`k ∼ Exp(wk) be exponentially distributed with rate wk. Thinking of z`k as the arrival time of item k in a race, let ρ`i be the index of the ith item to arrive (the ith smallest value among (z`k)Mk=1). The resulting probability of ρ` can then be shown to still be (1). In this interpretation (z`k) can be understood as latent variables, and the EM algorithm can be applied to derive an algorithm to find a ML parameter setting for (wk)Mk=1 given multiple partial rankings. Unfortunately the posterior distribution of (z`k) given ρ` is difficult to compute directly, so we instead consider an alternative parameterization: Let Z`i = zρ`i − zρ` i−1 be the waiting time for the ith item to arrive after the i − 1th item (with zρ`0 defined to be 0). Then it can be shown that the joint probability is:\nP ((ρ`) L `=1, (Z`i) L,m `=1,i=1|(wk) M k=1) = L∏ `=1 m∏ i=1 wρ`i exp ( −Z`i (∑M k=1 wk − ∑i−1 j=1 wρ`j )) (4)\nNote that the posterior of (Z`i)mi=1 is simply factorized with Z`i|ρ, w ∼ Exp( ∑M k=1 wk − ∑i−1 j=1 wρ`j ), and the ML parameter setting can be easily derived as well. Taking a further step, we note that a factorized gamma prior over (wk) is conjugate to (4), say wk ∼ Gamma( αM , τ) with hyperparameters α, τ > 0. Now Bayesian inference can be carried out either with a VB EM algorithm, or a Gibbs sampler. In this paper we shall consider only Gibbs sampling algorithms. In this case the parameter updates are of the form\nwk|(ρ`), (Z`i), (wk′)k′ 6=k ∼ Gamma ( α M + nk, τ + ∑L `=1 ∑m i=1 δ`ikZ`i ) (5)\nwhere nk is the number of occurrences of item k among the observed partial rankings, and δ`ik = 0 if there is a j < i with ρ`j = k and 1 otherwise. These terms arise by regrouping those in the exponential in (4).\nA nonparametric Plackett-Luce model can now be easily derived by taking the limit as the number of choice items M → ∞. For those items k that have appeared among the observed partial rankings, the limiting conditional distribution (5) is well defined since nk > 0. For items that did not appear in the observations, (5) becomes degenerate at 0. Instead we can define w∗ = ∑ k:nk=0\nwk to be the total desirability among all infinitely many previously unobserved items, and show that\nw∗|(ρ`), (Z`i), (wk)k:nk>0 ∼ Gamma ( α, τ + ∑L `=1 ∑m i=1 Z`i ) (6)\nThe Gibbs sampler thus alternates between updating (Z`i), and updating the ratings of the observed items (wk)k:nk>0 and of the unobserved ones w∗. This nonparametric model allows us to estimate the probability of seeing new items appearing in future partial rankings in a consistent manner. While intuitive, this\nRR n° 8140\nBayesian nonparametric models for ranked data 5\nderivation is ad hoc in the sense that it arises as the infinite limit of the Gibbs sampler for finite models, and is unsatisfying as it did not directly capture the structure of the underlying infinite dimensional object, which we will show in the next subsection to be a gamma process."
    }, {
      "heading" : "2.2 A Bayesian nonparametric Plackett-Luce model",
      "text" : "Let X be a measurable space of choice items. A gamma process is a completely random measure over X with gamma marginals. Specifically, it is a random atomic measure of the form (3), such that for each measurable subset A, the (random) mass G(A) is gamma distributed. Assuming that G has no fixed atoms (that is, for each element x ∈ X we have G({x}) = 0 with probability one) and that the atom locations {Xk} are independent of their masses {wk}, it can be shown that such a random measure can be constructed as follows: each Xk is iid according to a base distribution H (which we assume is non-atomic with density h(x)), while the set of masses {wk} is distributed according to a Poisson process over R+ with intensity λ(w) = αw−1e−wτ where α > 0 is the concentration parameter and τ > 0 the inverse scale. We write this as G ∼ Γ(α, τ,H). Under this parametrization, we have that G(A) ∼ Gamma(αH(A), τ).\nEach atomXk is a choice item, with its masswk > 0 corresponding to the desirability parameter. The Thurstonian view described in the finite model can be easily extended to the nonparametric one, where a partial ranking (Xρ`1 . . . Xρ`m) can be generated as the first m items to arrive in a race. In particular, for each atom Xk let z`k ∼ Exp(wk) be the time of arrival of Xk and Xρ`i the ith item to arrive. The first m items to arrive (Xρ`1 . . . Xρ`m) then constitutes our top-m list, with probability as given in (2). Again reparametrizing using inter-arrival durations, let Z`i = zρ`i − zρ`i−1 for i = 1, 2, . . . (with zρ0 = 0). Then the joint probability is:\nP ((Xρ`i) m i=1, (Z`i) m i=1|G) = P ((zρ`1 . . . zρ`m), and z`k > zρ`m for all k 6∈ {ρ`1, . . . , ρ`m}) (7)\n= ( m∏ i=1 wρ`ie −wρ`izρ`i )( ∏ k 6∈{ρ`i}mi=1 e−wkzρ`m ) = m∏ i=1 wρ`i exp ( −Z`i ( ∞∑ k=1 wk − i−1∑ j=1 wρ`j )) Marginalizing out (Z`i)mi=1 gives the probability of (Xρ`i) m i=1 in (2). Further, conditional on ρ` it is seen that the inter-arrival durations Z`1 . . . Z`m are mutually independent and exponentially distributed:\nZ`i|(Xρ`i)mi=1, G ∼ Exp ( ∞∑ k=1 wk − i−1∑ j=1 wρ`j ) (8)\nThe above construction is depicted on Figure 1(left). We visualize on right some top-m lists generated from the model, with τ = 1 and different values of α."
    }, {
      "heading" : "2.3 Posterior characterization",
      "text" : "Consider a number L of partial rankings, with the `th list denoted Y` = (Y`1 . . . Y`m`) , for ` ∈ [L]. While previously our top-m list (Xρ1 . . . Xρm) consists of an ordered list of the atoms in G. Here G is unobserved and (Y`1 . . . Y`m`) is simply a list of observed choice items, which is why they were not expressed as an ordered list of atoms in G. The task here is then to characterize the posterior law of G under a gamma process prior and supposing that the observed partial rankings were drawn iid from the nonparametric Plackett-Luce model given G. Re-expressing the conditional distribution (2) of Y` given G, we have:\nP (Y`|G) = m∏̀ i=1 G({Y`i}) G(X\\{Y`1 . . . Y` i−1})\n(9)\nRR n° 8140\nBayesian nonparametric models for ranked data 6\nu ρ 1u ρ\n2 u ρ\n3\nE\nAs before, for each `, we will also introduce a set of auxiliary variables Z` = (Z`1 . . . Z`m`) (the interarrival times) that are conditionally mutually independent given G and Y`, with:\nZ`i|Y`, G ∼ Exp(G(X\\{Y`1, . . . , Y`i−1})) (10)\nThe joint probability of the item lists and auxiliary variables is then (c.f. (7)):\nP ((Y`, Z`) L `=1|G) = L∏ `=1 m∏̀ i=1 G({Y`i}) exp(−Z`iG(X\\{Y`1, . . . , Y` i−1})) (11)\nNote that under the generative process described in Section 2.2, there is positive probability that an item appearing in a list Y` appears in another list Y`′ with `′ 6= `. Denote the unique items among all L lists by X∗1 . . . X ∗ K , and for each k = 1, . . . ,K let nk be the number of occurrences of X ∗ k among the item lists. Finally define occurrence indicators\nδ`ik = { 0 if ∃j < i with Y`j = X∗k ; 1 otherwise.\n(12)\ni.e. δ`ik is the indicator of the occurence that item X∗k does not appear at a rank lower than i in the `th list. Then the joint probability under the nonparametric Plackett-Luce model is:\nP ((Y`, Z`) L `=1|G) = K∏ k=1 G({X∗k})nk × L∏ `=1 m∏̀ i=1 exp(−Z`iG(X\\{Y`1, . . . , Y` i−1}))\n= exp ( −G(X)\n∑ `i Z`i ) K∏ k=1 G({X∗k})nk exp ( −G({X∗k}) ∑ `i (δ`ik − 1)Z`i ) (13)\nTaking expectation of (13) with respect to G using the Palm formula gives:\nTheorem 1 The marginal probability of the L partial rankings and auxiliary variables is:\nP ((Y`, Z`) L `=1) = e\n−ψ( ∑ `i Z`i) K∏ k=1 h(X∗k)κ ( nk, ∑ `i δ`ikZ`i ) (14)\nRR n° 8140\nBayesian nonparametric models for ranked data 7\nwhere ψ(z) is the Laplace transform of λ,\nψ(z) = − logE [ e−zG(X) ] = ∫ R+ λ(w)(1− e−zw)dw = α log ( 1 + z τ ) (15)\nand κ(n, z) is the nth moment of the exponentially tilted Lévy intensity λ(w)e−zw:\nκ(n, z) = ∫ R+ λ(w)wne−zwdw =\nα\n(z + τ)n Γ(n) (16)\nDetails are given in the appendix. Another application of the Palm formula now allows us to derive a posterior characterisation of G:\nTheorem 2 Given the observations and associated auxiliary variables (Y`, Z`)L`=1, the posterior law of G is also a gamma process, but with atoms with both fixed and random locations. Specifically,\nG|(Y`, Z`)L`=1 = G∗ + K∑ k=1 w∗kδX∗k (17)\nwhere G∗ and w∗1 , . . . , w ∗ K are mutually independent. The law of G ∗ is still a gamma process,\nG∗|(X`, Z`)L`=1 ∼ Γ(α, τ∗, h) τ∗ = τ + ∑ `i Z`i (18)\nwhile the masses have distributions, w∗k|(Y`, Z`)L`=1 ∼ Gamma ( nk, τ + ∑ `i δ`ikZ`i ) (19)"
    }, {
      "heading" : "2.4 Gibbs sampling",
      "text" : "Given the results of the previous section, a simple Gibbs sampler can now be derived, where all the conditionals are of known analytic form. In particular, we will integrate out all of G∗ except for its total mass w∗∗ = G\n∗(X). This leaves the latent variables to consist of the masses w∗∗ , (w∗k) and the auxiliary variables (Z`i). The update for Z`i is given by (10), while those for the masses are given in Theorem 2:\nGibbs update for Z`i: Z`i|rest ∼ Exp ( w∗∗ + ∑ k δ`ikw ∗ k ) (20) Gibbs update for w∗k: w ∗ k|rest ∼ Gamma ( nk, τ + ∑ `i δ`ikZ`i ) (21) Gibbs update for w∗∗: w ∗ ∗|rest ∼ Gamma ( α, τ + ∑ `i Z`i ) (22)\nNote that the auxiliary variables are conditionally independent given the masses and vice versa. Hyperparameters of the gamma process can be simply derived from the joint distribution in Theorem 1. Since the marginal probability of the partial rankings is invariant to rescaling of the masses, it is sufficient to keep τ fixed at 1. As for α, if a Gamma(a, b) prior is placed on it, its conditional distribution is still gamma:\nGibbs update for α: α|rest ∼ Gamma ( a+K, b+ log ( 1 + ∑ `i Z`i τ )) (23)\nNote that this update was derived with w∗∗ marginalized out, so after an update to α it is necessary to immediately update w∗∗ via (22) before proceeding to update other variables.\nRR n° 8140\nBayesian nonparametric models for ranked data 8"
    }, {
      "heading" : "3 Dynamic Bayesian nonparametric ranking models",
      "text" : "In this section we develop an extension of the Bayesian nonparametric Plackett-Luce model to model time-varying rankings, where the rating parameters of items may change smoothly over time and reflected in a changing series of rankings. Given a series of times indexed by t = 1, 2, . . ., we may model the rankings at time t using a gamma process distributed random measure Gt as in Section 2.2, with Markov dependence among the sequence of measures (Gt) enabling dependence among the rankings over time."
    }, {
      "heading" : "3.1 Pitt-Walker dependence model",
      "text" : "We will construct a dependent sequence (Gt) which marginally follow a gamma process Γ(α, τ,H) using the construction of [13]. Suppose Gt ∼ Γ(α, τ,H). Since Gt is atomic, we can write it in the form:\nGt = ∞∑ k=1 wtkδXtk (24)\nDefine a random measure Ct with conditional law:\nCt|Gt = ∞∑ k=1 ctkδXtk ctk|Gt ∼ Poisson(φtwtk) (25)\nwhere φt > 0 is a dependence parameter. Using the same method as in Section 2.3, we can show:\nProposition 3 Suppose the law of Gt is Γ(α, τ,H). The conditional law of Gt given Ct is then:\nGt = G ∗ t + ∞∑ k=1 w∗tkδXtk (26)\nwhere G∗t and (w ∗ tk) ∞ k=1 are all mutually independent. The law of G ∗ t is given by a gamma process, while the masses are conditionally gamma,\nG∗t |Ct ∼ Γ(α, τ + φt, H) w∗tk|Ct ∼ Gamma(ctk, τ + φt) (27)\nThe idea of [13] is to define the conditional law of Gt+1 given Gt and Ct to coincide with the conditional law of Gt given Ct as in Proposition 3. In other words, define\nGt+1 = G ∗ t+1 + ∞∑ k=1 wt+1,kδXtk (28)\nwhere G∗t+1 ∼ Γ(α, τ + φt, H) and wt+1,k ∼ Gamma(ctk, τ + φt) are mutually independent. If the prior law of Gt is Γ(α, τ,H), the marginal law of Gt+1 will be Γ(α, τ,H) as well when both Gt and Ct are marginalized out, thus maintaining a form of stationarity. Further, although we have described the process in order of increasing t, the joint law of Gt, Ct, Gt+1 can equivalently be described in the reverse order with the same conditional laws as above. Note that if ctk = 0, the conditional distribution of wt+1,k will be degenerate at 0. Hence Gt+1 has an atom at Xtk if and only if Ct has an atom at Xtk, that is, if ctk > 0. In addition, it also has atoms (those in G∗t+1) where Ct does not (nor does Gt). Finally, the parameter φt can be interpreted as controlling the strength of dependence between Gt+1 and Gt. Indeed it can be shown that\nE[Gt+1|Gt] = φt\nφt + τ Gt +\nτ\nφt + τ H. (29)\nRR n° 8140\nBayesian nonparametric models for ranked data 9\nAnother measure of dependence can be gleaned by examining the “lifetime” of an atom. Suppose X is an atom in G1 with mass w > 0. The probability that X is an atom in C2 with positive mass is 1 − exp(−φ1w), in which case it has positive mass in G2 as well. Conversely, once it is not an atom, it will never be an atom in the future since the base distribution H is non-atomic. The lifetime of the atom is then the smallest t such that it is no longer an atom. We can show by induction that: (details in appendix)\nProposition 4 The probability that an atom X in G1 with mass w > 0 is dead at time t is given by\nP (Gt({X}) = 0|w) = exp(−yt|1w)\nwhere yt|1 can be obtained by the recurrence yt|t−1 = φt−1 and yt|s−1 = yt|sφs−1\nφs−1+τ+yt|s ."
    }, {
      "heading" : "3.2 Posterior characterization and Gibbs sampling",
      "text" : "Assume for simplicity that at each time step t = 1, . . . , T we observe one top-m list Yt = (Yt1, . . . , Ytm) (it trivially extends to multiple partial rankings of differing sizes). We extend the results of the previous section in characterizing the posterior and developing a Gibbs sampler for the dynamical model.\nSince each observed item at time t has to be an atom in its corresponding random measure Gt, and atoms in Gt can propagate to neighboring random measures via the Pitt-Walker dependence model, we conclude that the set of all observed items (through all times) has to include all fixed atoms in the posterior of Gt. Thus let X∗ = (X∗k), k = 1, . . . ,K be the set of unique items observed in Y1, . . . , YT , let ntk ∈ {0, 1} be the number of times the item X∗k appears at time t, and let ρt be defined as Yt = (X∗ρ1 , . . . , X ∗ ρm). We write the masses of the fixed atoms as wtk = Gt({X ∗ k}), while the total mass of all other random atoms is denoted wt∗ = Gt(X\\X∗). Note that wtk has to be positive on a random contiguous interval of time that includes all observations of X∗k—it’s lifetime—but is zero outside of the interval. We also write ctk = Ct({X∗k}) and ct∗ = Ct(X\\X∗). As before, we introduce, for t = 1, . . . , T and i = 1, . . . ,m, latent variables\nZti ∼ Exp ( wt∗ + K∑ k=1 wtk − i−1∑ j=1 wtρj ) (30)\nEach iteration of the Gibbs sampler then proceeds as follows (details in appendix). The latent variables (Zti) are updated as above. Conditioned on the latent variables (Zti), (ctk) and (ct∗), we update the masses (wtk), which are independent and gamma distributed since all likelihoods are of gamma form. Note that the total masses (Gt(X)) are not likelihood identifiable, so we introduce an extra step to improve mixing by sampling them from the prior (integrating out (ctk), (ct∗)), scaling all masses along with it. Directly after this step we update (ctk), (ct∗). We update α along with the random masses (wt∗) and (ct∗) efficiently using a forward-backward recursion. Finally, the dependence parameters (φt) are updated."
    }, {
      "heading" : "3.3 Continuous time formulation using superprocesses",
      "text" : "The dynamic model described in the previous section is formulated for discrete time data. When the time interval between ranking observations is not constant, it is desirable to work with dynamic models evolving over continuous-time instead, with the underlying random measures (Gt) defined over all t ∈ R, but with observations at a discrete set of times t1 < t2 < · · · . Here we propose a continuous-time model based on the Dawson-Watanabe superprocess [14, 15] (see also [16, 17, 18, 19]). This is a diffusion on the space of measures with the gamma process Γ(α, τ,H) as its equilibrium distribution. It is defined by a generator\nL = ξ (∫ G(dX) ∂2\n∂G(X)2 + α\n∫ H(dX) ∂\n∂G(X) − τ\n∫ G(dX) ∂\n∂G(X) ) RR n° 8140\nBayesian nonparametric models for ranked data 10\nwith ξ parametrizing the rate of evolution. Figure 2 gives a sample path, where we see that it is continuous but non-differentiable. For efficient inference, it is desirable to be able to integrate out all Gt’s except those Gt1 , Gt2 , . . . at observation times. An advantage to using the Dawson-Watanabe superprocess is that, the conditional distribution of Gts given Gts−1 is remarkably simple [20]. In particular it is simply given by the discrete-time process of the previous section with dependence parameter φts|ts−1 = τ\neτξ(ts−ts−1)−1 . Thus the inference algorithm developed previously is directly applicable to\nthe continuous-time model too."
    }, {
      "heading" : "4 Experiments",
      "text" : "We apply the discrete-time dynamic Plackett-Luce model to the New York Times bestsellers data. These consist of the weekly top-20 best-sellers list from June 2008 to April 2012 in various categories. We consider here the categories paperback nonfiction (PN) and hardcover fiction (HF), for which respectively 249 and 916 books appear at least once in the top-20 lists over the 200 weeks. We consider that the correlation parameter φt = φ is constant over time, and assign flat improper priors p(α) ∝ 1/α and p(φ) ∝ 1/φ. In order to take into account the publication date of a book, we do not consider books in the likelihood before their first appearance in a list. We run the Gibbs sampler with 10000 burn-in iterations followed by 10000 samples. Mean normalized weights for the more popular books in both categories are shown in Figure 3.\nThe model is able to estimate the weights associated to each book that appeared at least once, as well as the total weight associated to all other books, i.e. the probability that a new book enters at the first rank in the list, represented by the black curve. Moreover, the Bayesian approach enables us to have a measure of the uncertainty on the weights. The hardcover fiction category is characterized by rapid changes in successive lists, compared to the paperback nonfiction. This is quantified by the estimated value of the parameter φ, which are respectively 85 ± 20 and 140 ± 40 for PN and HF. The estimated values of the shape parameter α are 7± 1.5 and 2± 1 respectively."
    }, {
      "heading" : "5 Discussion",
      "text" : "We have proposed a Bayesian nonparametric Plackett-Luce model for ranked data. Our approach is based on the theory of atomic random measures, where we showed that the Plackett-Luce generative model corresponds exactly to a size-biased permutation of the atoms in the random measure. We characterized the posterior distribution, and derived a simple MCMC sampling algorithm for posterior simulation. Our approach can be see as a multi-stage generalization of posterior inference in normalized random measures [21, 22, 23], and can be easily extended from gamma processes to general completely random measures.\nWe also proposed dynamical extensions of our model for both discrete and continuous time data, and applied it to modeling the bestsellers’ lists on the New York Times. Our dynamic extension may be useful\nRR n° 8140\nBayesian nonparametric models for ranked data 11\nfor modeling time varying densities or clusterings as well. In our experiments we found that our model is insufficient to capture the empirical observation that bestsellers often start off high on the lists and tail off afterwards, since our model has continuous sample paths. We adjusted for this by simply not including books in the model prior to their publication date. It may be possible to model this better using models with discontinuous sample paths, for example, the Orstein-Uhlenbeck approach of [24] where the process evolves via a series of discrete jump events instead of continuously."
    }, {
      "heading" : "Acknowledgements",
      "text" : "YWT thanks the Gatsby Charitable Foundation for generous funding.\nRR n° 8140\nBayesian nonparametric models for ranked data 12"
    }, {
      "heading" : "A Proof of Theorem 1",
      "text" : "The marginal probability (14) is obtained by taking the expectation of (13) with respect to G. Note however that (13) is a density, so to be totally precise here we need to work with the probability of infinitesimal neighborhoods around the observations instead, which introduces significant notational complexity. To keep the notation simple, we will work with densities, leaving it to the careful reader to verify that the calculations indeed carry over to the case of probabilities.\nP ((Y`, Z`) L `=1) =E [ P ((Y`, Z`) L `=1|G) ] =E [ e−G(X) ∑ `i Z`i\nK∏ k=1 G({X∗k})nke−G({X ∗ k}) ∑ `i(δ`ik−1)Z`i\n]\nThe gamma prior on G = ∑∞ j=1 wjδXj is equivalent to a Poisson process prior on N = ∑∞ j=1 δ(wj ,Xj) defined over the space R+ × X with mean intensity λ(w)h(x). Then,\n=E e− ∫ wN(dw,dx)∑`i Z`i K∏ k=1 ∞∑ j=1 wnkj 1(Xj = X ∗ k)e −wj ∑ `i(δ`ik−1)Z`i  Applying the Palm formula for Poisson processes to pull the k = 1 term out of the expectation,\n= ∫ E e− ∫ w(N+δw∗1 ,x∗1 )(dw,dx)∑`i Z`i K∏ k=2 ∞∑ j=1 wnkj 1(Xj = X ∗ k)e −wj ∑ `i(δ`ik−1)Z`i  × (w∗1)nkh(X∗1 )e−w ∗ 1 ∑ `i(δ`i1−1)Z`iλ(w∗1)dw ∗ 1\n=E e− ∫ wN(dw,dx)∑`i Z`i K∏ k=2 ∞∑ j=1 wnkj 1(Xj = X ∗ k)e −wj ∑ `i(δ`ik−1)Z`i  × h(X∗1 ) ∫ (w∗1) nke−w ∗ 1 ∑ `i δ`i1Z`iλ(w∗1)dw ∗ 1\nRR n° 8140\nBayesian nonparametric models for ranked data 14\nNow iteratively pull out terms k = 2, . . . ,K using the same idea, and we get:\n=E [ e−G(X) ∑ `i Z`i ] K∏ k=1 h(X∗k) ∫ (w∗k) nke−w ∗ k ∑ `i δ`ikZ`iλ(w∗k)dw ∗ k =e−ψ( ∑ `i Z`i)\nK∏ k=1 h(X∗k)κ ( nk, ∑ `i δ`ikZ`i ) (31)\nThis completes the proof of Theorem 1."
    }, {
      "heading" : "B Proof of Theorem 2",
      "text" : "Let f : X→ R be measurable with respect to H . Then the characteristic functional of the posterior G is given by:\nE[e− ∫ f(x)G(dx)|(Y`, Z`)L`=1] =\nE[e− ∫ f(x)G(dx)P ((Y`, Z`) L `=1|G)]\nE[P ((Y`, Z`)L`=1|G)] (32)\nThe proof is essentially obtained by calculating the numerator and denominator of (32). The denominator is already given in Theorem 1. The numerator is obtained using the same technique with the inclusion of the term e ∫ f(x)G(dx), which gives:\nE [ e− ∫ f(x)G(dx)P ((Y`, Z`) L `=1|G) ] =E [ e− ∫ (f(x)+ ∑ `i Z`i)G(dx)\n] K∏ k=1 h(X∗k) ∫ (w∗k) nke−w ∗ k(f(X ∗ k)+ ∑ `i δ`ikZ`i)λ(w∗k)dw ∗ k\nBy the Lévy-Khintchine Theorem (using the fact that G has a Poisson process representation N ),\n= exp ( − ∫ (1− e−w(f(x)+ ∑ `i Z`i))λ(w)h(x)dwdx ) ×\nK∏ k=1 h(X∗k) ∫ (w∗k) nke−w ∗ k(f(X ∗ k)+ ∑ `i δ`ikZ`i)λ(w∗k)dw ∗ k (33)\nDividing the numerator (31) by the denominator (33), the characteristic functional of the posterior G is: E [ e− ∫ f(x)G(dx)|(Y`, Z`)L`=1 ] = exp ( − ∫ (1− e−wf(x))e− ∑ `i Z`iλ(w)h(x)dwdx\n) ×\nK∏ k=1 h(X∗k)\n∫ e−f(X\n∗ k)(w∗k) nke−w ∗ k ∑ `i δ`ikZ`iλ(w∗k)dw ∗ k∫\n(w∗k) nke−w ∗ k ∑ `i δ`ikZ`iλ(w∗k)dw ∗ k\n(34)\nSince the characteristic functional is the product of K + 1 terms, we see that the posterior G consists of K + 1 independent components, one corresponding to the first term above (G∗), and the others corresponding to the K terms in the product over k. Substituting the Lévy measure λ(w) for a gamma process, we note that the first term shows that G∗ is a gamma process with updated inverse scale τ∗. The kth term in the product shows that the corresponding component is an atom located at X∗k with density (w∗k) nke−w ∗ k ∑ `i δ`ikZ`iλ(w∗k); this is the density of the gamma distribution over w ∗ k in Theorem 2. This completes the proof.\nRR n° 8140\nBayesian nonparametric models for ranked data 15"
    }, {
      "heading" : "C Proof of Proposition 4",
      "text" : "We have\nP (Gt(X1k) = 0|wt−1,,k) = exp(−φt−1wt−1,k)\nAssume that P (Gt(X1k) = 0|wsk) = exp(−yt|swsk)\nthen P (Gt(X1k) = 0|ws−1,k) = ∫ exp(−yt|swsk)p(wsk|ws−1,k)dwsk\n= ∑ cs−1,k ∫ exp(−yt|swsk)p(wsk|cs−1,k)p(cs−1,k|ws−1,k)dwsk\n= ∑ cs−1,k exp [ −cs−1,k log ( 1 +\nyt|s\nφs−1 + τ\n)] p(cs−1,k|ws−1,k)\n= exp ( −yt|sφs−1 φs−1 + τ + yt|s ws−1,k )"
    }, {
      "heading" : "D Gibbs sampler for the dynamic nonparametric Plackett-Luce model",
      "text" : "For ease of presentation, we assume that φt takes the same value φ at each time step. The Gibbs sampler will iterate between the following steps\n1. a. For t = 1, . . . , T , update Gt(X) given (Gt−1(X), α, φ) b. For t = 1, . . . , T , update (ct, ct∗) given (wt, wt∗, wt+1, wt+1∗, φ, α)\n2. a. Update α given (Z, φ)\nb. For t = 1, . . . , T\nUpdate wt∗ given (ct−1∗, Z, φ, α)\nUpdate ct∗ given (wt∗, Z, φ, α)\n3. For t = 1, . . . , T , update (wt, wt∗) given (ct−1, ct−1∗, ct, ct∗, Zt, α, φ)\n4. For t = 1, . . . , T , update Zt given (wt, wt∗)\n5. Update φ given w,w∗, α, φ\nThe steps are now fully described.\n1.a) Sample (Gt(X)) given (α, φ)\nWe have G1(X)|α ∼ Gamma(α, τ)\nand for t = 1, . . . , T − 1 Gt+1(X) ∼ Gamma(α+Mt, τ + φ)\nwhere Mt ∼Poisson(φGt(X)). The weights (wt, wt∗) are then appropriately rescaled.\nRR n° 8140\nBayesian nonparametric models for ranked data 16\n1.b) Sample (c, c∗) given (w,w∗, φ, α)\nConsider first the sampling of c1:T . We have, for t = 1, . . . , T and k = 1, . . . ,K\np(ctk|wtk, wt+1,k) ∝ p(ctk|wtk)p(wt+1,k|ctk)\nwhere p(ctk|wtk) = Poisson(ctk;φwtk)\nand\np(wt+1,k|ctk) = { δ0(wt+1,k) if wtk = 0 Gamma(wt+1,k; ctk, τ + φ) if wtk > 0\nHence we can have the following MH update. If wt+1,k > 0, then we necessarily have ctk > 0. We sample c∗tk ∼zPoisson(φwtk) where zPoisson(φwtk) denotes the zero-truncated Poisson distribution and accept c∗tk w.p.\nmin ( 1,\nGamma(wt+1,k; c∗tk, τ + φ) Gamma(wt+1,k; ctk, τ + φ) ) If wt+1,k = 0, we only have two possible moves: ctk = 0 or ctk = 1, given by the following\nprobabilities\nP (ctk = 0|wt+1,k = 0, wtk) = exp(−φwtk)\nexp(−φwtk) + φwtk exp(−φwtk)(τ + φ) =\n1\n1 + φwtk(τ + φ)\nP (ctk = 1|wt+1,k = 0, wtk) = φwtk exp(−φwtk)(τ + φ)\nexp(−φwtk) + φwtk exp(−φwtk)(τ + φ) =\nφwtk(τ + φ)\n1 + φwtk(τ + φ)\nNote that the above Markov chain is not irreducible, as the probability is zero to go from a state (ctk > 0, wt+1,k > 0) to a state (ctk = 0, wt+1,k = 0), even though the posterior probability of this event is non zero in the case item k does not appear after time t. We can resolve that by the following procedure, that uses a backward forward recursion.\nAssume that item k does not appear after time step τ+k (the same procedure applies if item k does not appear before time step τ−k ). Then we can sample jointly the whole sequence (wk,t, ck,t)t=τk+1,...,T using the following backward forward recursion.\nLet\nxT = m∑ k=1 ZTk (35)\nand for t = T − 1, . . . , τ+k\nxt = m∑ k=1 Ztk + φxt+1 1 + φ+ xt+1\nWe have, for k = 1, . . . ,K and t = τ+k\nctk|(Z, φ,wtk) ∼ Poisson ( 1 + φ\n1 + φ+ xt φwtk\n) (36)\nwt+1,k|ctk, Z ∼ Gamma (ck,t, τ + φ+ xt+1) (37)\nRR n° 8140\nBayesian nonparametric models for ranked data 17\n2.a) Sample α given (Z, φ)\nWe can sample from the full conditional which is given by\nα|(Z, γ, φ) ∼ Gamma (a+K, b+ y1 + log(1 + x1)) (38)\nwhere x1 and y1 are obtained with the following recursion\nxT = m∑ k=1 ZTk (39)\nyT = 0 (40)\nand for t = T − 1, . . . , 1\nxt = m∑ k=1 Ztk + φxt+1 1 + φ+ xt+1\nyt = yt+1 − log (\n1 + φ\n1 + φ+ xt+1 ) .\n2.b) Sample (c∗, w∗) given (Z, φ, α)\nWe can sample from the full conditional which is given by\nw1∗|(Z, φ, α) ∼ Gamma (α, τ + x1) (41)\nwhere x1 is defined above. Then for t = 2, . . . , T , let ct−1∗|(Z, φ, α,wt−1∗) ∼ Poisson ( 1 + φ\n1 + φ+ xt φwt−1∗ ) wt∗|ct−1∗, Z, α ∼ Gamma (α+ ct−1∗, τ + φ+ xt)\n3) Sample (w,w∗) given (Z,α, c, c∗, φ)\nFor each time step t = 1, . . . , T\n• For each item k = 1, . . . ,K, sample\nwtk|ct−1,k, ctk, Zt ∼ Gamma ( ntk + ct−1,k + ctk, τ + 2φ+\nm∑ i=1 δtikZti\n) (42)\nif ctk + ct−1,k + ntk > 0, otherwise, set wtk = 0. The occurence indicator δtik is defined as\nδtik = { 0 if ∃j < i with Ytj = X∗k ; 1 otherwise.\n(43)\nRR n° 8140\nBayesian nonparametric models for ranked data 18\n• Sample the total mass\nwt∗|ct∗, ct−1∗, Zt, α ∼ Gamma ( α+ ct∗ + ct−1∗, τ + 2φ+\nm∑ i=1 Zti\n) (44)\n4) Sample Z given (w,w∗)\nFor t = 1, . . . , T and i = 1, . . .m, sample\nZti|w,w∗ ∼ Exp ( wt∗ +\nK∑ k=1 δtikwtk\n) (45)\n5) Sample φ given w,w∗, α, φ\nWe sample φ using a MH step. Propose φ̃ = φ exp(σε) where σ > 0 and ε ∼ N (0, 1). And accept it with probability\nmin ( 1, p(φ̃)\np(φ)\nφ̃\nφ T−1∏ t=1 [ p(wt+1∗|φ̃, wt∗) p(wt+1∗|φ,wt∗) K∏ k=1 p(wt+1,k|φ̃, wtk) p(wt+1,k|φ,wtk) ]) (46)\nRR n° 8140\nRESEARCH CENTRE BORDEAUX – SUD-OUEST\n351, Cours de la Libération Bâtiment A 29 33405 Talence Cedex\nPublisher Inria Domaine de Voluceau - Rocquencourt BP 105 - 78153 Le Chesnay Cedex inria.fr\nISSN 0249-6399"
    } ],
    "references" : [ ],
    "referenceMentions" : [ ],
    "year" : 2012,
    "abstractText" : "We develop a Bayesian nonparametric extension of the popular Plackett-Luce choice model that<lb>can handle an infinite number of choice items. Our framework is based on the theory of random atomic<lb>measures, with the prior specified by a gamma process. We derive a posterior characterization and a simple<lb>and effective Gibbs sampler for posterior simulation. We develop a time-varying extension of our model,<lb>and apply it to the New York Times lists of weekly bestselling books.<lb>Key-words: choice models, generalized Bradley-Terry model, Plackett-Luce model, gamma process,<lb>Markov Chain Monte Carlo ∗ INRIA Bordeaux Sud-Ouest, Institut de Mathématiques de Bordeaux, University of Bordeaux, France<lb>† Department of Statistics, Oxford University, United Kingdom Modèles bayésiens non paramétriques pour les données de rang<lb>Résumé : On s’intéresse dans ce rapport à une extension bayésienne non paramétrique du modèle<lb>de Plackett-Luce pour les données de rang, pouvant traiter un nombre potentiellement infini d’éléments.<lb>Notre cadre se base sur la théorie des mesures complètement aléatoires, avec comme a priori un processus<lb>de gamma. Nous dérivons une caractérisation de la loi a posteriori et un échantillonneur de Gibbs simple<lb>pour approcher la loi a posteriori. Nous développons également une version dynamique de notre modèle,<lb>et l’appliquons aux listes hebdomadaires des 20 meilleures ventes du New York Times.<lb>Mots-clés : Modèles de choix, modèle de Bradley-Terry généralisé, modèle de Plackett-Luce, processus<lb>de gamma, méthodes de Monte Carlo par chaı̂ne de Markov Bayesian nonparametric models for ranked data<lb>3",
    "creator" : "LaTeX with hyperref package"
  }
}