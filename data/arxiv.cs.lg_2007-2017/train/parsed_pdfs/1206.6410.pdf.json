{
  "name" : "1206.6410.pdf",
  "metadata" : {
    "source" : "META",
    "title" : "On the Partition Function and Random Maximum A-Posteriori Perturbations",
    "authors" : [ "Tamir Hazan", "Tommi Jaakkola" ],
    "emails" : [ "tamir@ttic.edu", "tommi@csail.mit.edu" ],
    "sections" : [ {
      "heading" : "1. Introduction",
      "text" : "Learning and inference in complex models drives much of the research in machine learning applications, from computer vision, natural language processing, to computational biology. Examples include object detection (Felzenszwalb et al., 2009), stereo vision (Szeliski et al., 2007), parsing (Koo et al., 2010), or protein design (Sontag et al., 2008). The inference problem in such cases involves assessing the likelihood of possible structures, whether objects, parsers, or molecular structures. The structures are specified by assignments of random variables that need to be maximized or summed over. However, it is often feasible to only find the most likely or maximum a-posteriori (MAP) assignment rather than considering all possible assignments. Indeed, substantial effort has gone into developing algorithms for recovering MAP assignments, either based on specific structural restrictions such as super-modularity (Kolmogorov, 2006) or by devising approximate methods based on linear programming relaxations (Sontag et al., 2008; Werner, 2008).\nMAP inference is limited when there are other likely assignments. For example, in pose estimation the re-\nAppearing in Proceedings of the 29 th International Conference on Machine Learning, Edinburgh, Scotland, UK, 2012. Copyright 2012 by the author(s)/owner(s).\ncovery of the 3D joint positions from 2D images is often inherently ambiguous. Similarly, in parsing there might be equally likely parse trees for the same sentence. In a fully probabilistic treatment, all possible alternative assignments are considered. This requires summing over the assignments with their respective weights – evaluating the partition function – which is considerably harder. In fact, any algorithm for computing the partition function would be able to approximate the MAP value arbitrarily well via a temperature argument (Landau & Lifshitz, 1980). In contrast, MAP inference (maximization) can be tractable even when the problem of evaluating the partition function (weighted counting) is not.\nThe main surprising result of our work is that MAP inference can be used to approximate the partition function. In other words, given an algorithm for computing the MAP value, we can approximate or bound the partition function. The MAP values in our case arise from randomly perturbed models. While models based on random perturbations have been considered recently (Papandreou & Yuille, 2011; Keshet et al., 2011; Tarlow et al., 2012), their relation to the partition function has not. Specifically, we relate the partition function to the expected MAP value of perturbations. This result enables us for the first time to directly use efficient MAP solvers such as graph-cuts or MPLP in calculating the partition function. The approach excels in regimes where there are several but not exponentially many prominent assignments. For example, this happens in cases where observations carry strong signals (local evidence) but are also guided by strong consistency constraints (couplings).\nWe begin by introducing the notation and the counting and maximization problems of interest. We subsequently relate the partition function to the maxstatistics of random variables, and introduce new approximations and bounds on the partition function based on random MAP perturbations. Finally, we describe how to use this method in the context of conditional random fields and demonstrate the effectiveness of the approach."
    }, {
      "heading" : "2. Background",
      "text" : "Here we briefly define the counting and maximization problems of interest. Throughout the paper we assume real valued potentials φ(y) = φ(y1, ..., yn) <∞ defined over a discrete product space Y = Y1 × · · · × Yn. The domain is implicitly defined through φ(y) via exclusions φ(y) = −∞ whenever y 6∈ dom(φ).\nThe Gibbs distribution maps the real valued potential functions to the probability scale\np(y1, ..., yn) = 1\nZ exp(φ(y1, ..., yn)) (1) Z = ∑\ny1,...,yn\nexp(φ(y1, ..., yn)). (2)\nwhere the normalization constant Z is also known as the partition function. The feasibility of using such a distribution for inference and learning is inherently tied to the ability to evaluate the partition function. In the special case, where φ(y) ∈ {−∞, 0} the partition function reduces to counting the number of allowed configurations, namely |dom(φ)|. In general, counting problems are considered very hard, many belonging to the complexity class #P (Valiant, 1979).\nWe can also express the maximum a-posteriori (MAP) inference problem in the same notation as\n(MAP) max y1,...,yn φ(y1, ..., yn). (3)\nwhere, again, the domain of φ(y) is implicitly considered since the maximization avoids all configurations outside the domain. Although the MAP problem is NP-hard in general (Shimony, 1994), it is easier than computing the partition function. It can be solved efficiently in many cases of practical interest, e.g. when φ(y) is a super-modular function. A number of algorithms based on linear programming relaxations have recently been developed for solving MAP problems. Although the run-time of these solvers can be exponential, they are often surprisingly effective in practice."
    }, {
      "heading" : "3. Max-Statistics",
      "text" : "In the following we describe the basis of our framework. We show how to realize the partition function as the expected value of random MAP perturbations. Analytic expressions for the statistics of a random MAP perturbation can be derived for general discrete sets, whenever independent and identically distributed random perturbations are applied for every assignment y ∈ Y . Let {γ(y)}y∈Y be a collection of random variables. Assume these random\nvariables are independent and identically distributed with F (t) as their cumulative distribution function, i.e. F (t) = P [γ(y) ≤ t] for each y ∈ Y . The independence of γ(y) across y ∈ Y implies that the cumulative distribution function of the random MAP perturbation maxy∈Y {φ(y)+γ(y)} is the product of cumulative distribution functions of the individual perturbations φ(y) + γ(y). Therefore P [maxy∈Y {φ(y) + γ(y)} ≤ t] equals to ∏ y∈Y F (t − φ(y)). Below we describe the max-stability of the Gumbel distribution and its expect value.\nLemma 1. Let {γ(y)}y∈Y be a collection of independent random variables γ(y) indexed by y ∈ Y , each following the Gumbel distribution whose cumulative distribution function is F (t) = exp(− exp(−(t + c))), where c is the Euler constant. Then the random variable maxy∈Y {φ(y) + γ(y)} is distributed according to the Gumbel distribution and its expected value is the logarithm of the partition function:\nlogZ = Eγ [ max y∈Y {φ(y) + γ(y)} ] . (4)\nProof: The Gumbel cumulative distribution function is closed under multiplication, namely∏\ny∈Y F (t− φ(y)) = exp(− ∑ y∈Y exp(−(t− φ(y) + c))) = exp(− exp(−(t+ c))Z) = F (t− logZ).\nTherefore the random variable maxy∈Y {φ(y) + γ(y)} has the Gumbel distribution whose expected value is the logarithm of the partition function.\nIn general each y = (y1, ..., yn) represents an assignment to n variables. In this case the theorem suggests introducing an independent perturbation γ(y) for each such n−dimensional assignment y ∈ Y . The complexity of evaluating the log-partition function in this manner would be exponential in n. In the following we use lower dimensional random MAP perturbations as the main tool for approximating and bounding the partition function."
    }, {
      "heading" : "4. Low Dimensional Perturbations",
      "text" : "In this section, we develop efficient approximations and bounds for the partition function based on low dimensional random MAP perturbations. We commence with rewriting the previous result by exploiting the structure of the product space.\nTheorem 1. Let {γi(yi)}yi∈Yi,i=1,...,n, be a collection of independent and identically distributed (i.i.d.) random variables following the Gumbel distribution with\nF (t) = exp(− exp(−(t+ c))) where c is the Euler constant. Define γi = {γi(yi)}yi∈Yi . Then\nlogZ = Eγ1 max y1 · · ·Eγn max yn {φ(y) + n∑ i=1 γi(yi)}.\nProof: The result follows from applying equation (4) iteratively. Intuitively, Z = ∑ y1 · · · ∑ yn\nexp(φ(y)) and equation (4) encodes the correspondence between summation and expectation-maximization, namely∑ yi ↔ Eγi(yi) maxyi . More formally, consider the recursion φi−1(y1, ..., yi−1) = Eγi maxyi{φi(y1, . . . , yi) + γi(yi)}, where φn(y1, . . . , yn) = φ(y1, . . . , yn). Equation (4) implies that for each i, φi−1(y1, ..., yi−1) = log ∑ yi\nexp(φi(y1, ..., yi)). The rest of the proof now follows by induction.\nThe computational complexity of the alternating procedure is still exponential in n. For example, the inner iteration Eγn maxyn{φ(y1, .., yn) + γn(yn)} needs to be estimated exponentially many times, i.e., for every y1, ..., yn−1. Thus from computational perspective the alternating formulation in Theorem 1 is just as inefficient as the formulation in equation (4). We show next how Theorem 1 can be used to derive effective bounds and approximations."
    }, {
      "heading" : "4.1. Upper Bounds on the Partition Function",
      "text" : "Theorem 1 directly provides easily computable upper bounds on the log-partition function. Intuitively, these bounds correspond to moving expectations outside the maximization operations, each move resulting in an additional bound but also reducing the computational effort needed for the evaluation. For example,\nlogZ ≤ Eγ max y {φ(y) + ∑ i γi(yi)} (5)\nfollows immediately from moving all the expectations in front. In this case the bound is a simple average of MAP values corresponding to models with only single node perturbations {γi(yi)}yi∈Yi,i=1,...,n. If the maximization over φ(y) is feasible (e.g., due to supermodularity), it will typically be feasible after such perturbations as well. The upper bound can thus be evaluated efficiently as a sample average. We generalize this basic result further below.\nCorollary 1. Consider a family of subsets α ∈ A such that ∪α∈Aα = {1, ..., n}, and let yα be a set of variables {yi}i∈α restricted to the indexes in α. Assume that the random variables γα(yα) are i.i.d. according to the Gumbel distribution, for every α, yα. Then\nlogZ ≤ Eγ [\nmax y1,...,yn\n{ φ(y) + ∑ α∈A γα(yα) }] .\nProof: If the subsets α are disjoint, then {yα}α∈A simply defines a partition of the variables in the model. We can therefore use equation (5) over these grouped variables. In the general case, α, α′ ∈ A may overlap. We lift the variables y1, . . . , yn to a larger set y′ = {y′α}α∈A where an independent set of variables is introduced for each α ∈ A. We lift the potentials to φ′(y′) by including consistency constraints among the lifted variables\nφ′(y′) = { φ(y1, ..., yn) if ∀α, i ∈ α : y′α,i = yi −∞ otherwise\nThus, logZ = ∑ y′ exp(φ\n′(y′)) since inconsistent settings receive zero weight. Moreover, maxy′{φ′(y′) +∑ α γα(y ′ α)} equals maxy{φ(y) + ∑ α γα(yα)} for each realization of the perturbation. This equality holds after expectation over γ as well. Now, given that the perturbations are independent for each lifted coordinate, the basic result in equation (5), guarantees that Eγ [ maxy′ { φ′(y′) + ∑ α γα(y ′ α) }]\nupper bounds logZ. This completes the proof.\nThe structure of α ⊂ {1, ..., n} determines the statistical quality and algorithmic efficiency of the method. For example, using a single set α = {1, ..., n} the upper bound turns to be the exact characterization in equation (4), but it requires exponentially many independent random variables."
    }, {
      "heading" : "4.2. Approximating the Partition Function",
      "text" : "We can also use Theorem 1 to derive sampling based approximation schemes for the partition function that also utilize efficient MAP solvers. As a simple step, we could just replace the expectations in Theorem 1 with sampled estimates. The main subtlety lies in how these samples are reused as part of the outer loop maximization steps.\nLet’s begin by considering the n-th dimension alone. For any given setting of y1, ..., yn−1, we toss random values γn(yn), for every yn ∈ Yn, to estimate log ∑ yn\nexp(φ(y1, ..., yn)). Since the operation has to be repeated for each different setting of y1, . . . , yn−1, we need m · |Y | random variables γn,j(y1, ..., yn−1, yn), for every j = 1, ...,m, to ensure that\n1\nm m∑ j=1 max yn {φ(y1, ..., yn) + γn,j(y1, ..., yn)}.\napproximates log ∑ yn\nexp(φ(y1, ..., yn)) across all y1, . . . , yn−1. We can rewrite this expression in terms of a single maximization problem over an extended set of variables. Specifically, we introduce copies yn,j for\neach sample index j = 1, . . . ,m, and pull the maximizations outside the average:\nmax yn,1,...,yn,m\n1\nm m∑ j=1 (φ(y1, ..., yn,j) + γn,j(y1, ..., yn,j)).\nThis result is an approximation to the last expectationmaximization step in Theorem 1. We can now repeat the procedure for dimension n−1. Formally, we are using the fact that the partition function is self-reducible, i.e., logZ = log ∑ y1,...,yn−1 exp(log ∑ yn\nexp(φ(y))). After repeating this step for all the dimensions, we write the resulting approximation as a single but very large MAP program:\nlogZ ≈ max y\n1\nmn m∑ j1,...,jn=1 φ(y1,j1 , ..., yn,jn) +\nn∑ i=1 1 mi m∑ j1,...,ji=1 γi,ji(y1,j1 , ..., yi,ji).\nIn this expression, the maximization is over an inflated set of variables where there are m copies of each variable, e.g., yi is expanded into {yi,ji}ji=1,...,m. The problem is that this program uses exponentially many independent random variables γi,ji(y1,i1 , ..., yi,ji) and thus suffers from the same computational problem as equation (4). However, due to averaging, we expect that most MAP perturbations are now concentrated around the logarithm of the partition function.\nFor computational efficiency we suggest reusing the perturbations, collapsing independent random variables γi,ji(y1,i1 , ..., yi,ji) to far fewer random variables γi,ji(yi,ji). This results in the following approximation for the log-partition function:\nmax y1,j1 ,...,yn,jn\n1\nmn ∑ j1,...,jn φ(y1,j1 , ..., yn,jn) + ∑ i,ji γi,ji(yi,ji)\nThis approximation is effective whenever the dominant configurations of variables {yi,ji} were already correlated (few modes) so that the randomness in γi,ji(y1,i1 , ..., yi,ji) could be compressed with little loss in accuracy. This behavior is typical in models with strong couplings."
    }, {
      "heading" : "4.3. Lower Bounds on the Partition Function",
      "text" : "For completeness, we also provide a lower bound on the partition function based on randomized MAP computations. Unlike the upper bound discussed earlier, however, the lower bound does not directly exploit Theorem 1.\nTheorem 2. Consider any collection of subsets α ⊂ {1, ..., n} and let {γα(yα)} be independent random variables for each setting of α, yα. Let Kα,yα(λ) = logE[exp(λγα(yα))]. Then logZ ≥\nsup λ≥0\n{ logEγ [ exp(maxy{φ(y) + λ ∑ α γα(yα)}) ] −maxy ∑ αKα,yα(λ) }\nThe proof appears in the supplementary material. The lower bound is somewhat weaker than the upper bound in Corollary 1. For example, unlike the upper bound, in case of a single α = {1, ..., n}, the lower bound is not tight for every φ(y). The parameter λ governs the tradeoff between the perturbed MAP value and the cumulant generating function Kα,yα(λ). For λ = 0 the cumulant generating function is zero and the lower bound reduces to a trivial bound based on the MAP value. However, we cannot choose arbitrarily large λ since Kα,yα(λ) can be unbounded depending on the distributions used for perturbations."
    }, {
      "heading" : "5. Conditional Random Fields",
      "text" : "In a supervised learning problem, we assume training data S of objects x ∈ X and labels y ∈ Y such as images and their segmentations. Given a feature vector Φ(x, y) < ∞ for each object x ∈ X and label y ∈ Y , the learning task is to estimate parameters θ that maximize the log likelihood of the data under the conditional random field model px(y; θ) = exp(θTΦ(x, y))/Zx(θ). This task can be equivalently stated as a loss minimization problem\nmin θ ∑ (x,y)∈S ( logZx(θ)− θ>Φ(x, y) ) .\nThe formulation emphasizes the computational cost of using conditional random fields due to the partition function. In the following we make use of a surrogate partition function arising from random MAP perturbations.\nConsider a family of subsets α ⊂ {1, ..., n} that cover {1, . . . , n}, and let {γα(yα)}α,yα be i.i.d. random variables with continuous densities. We use the following surrogate criterion for estimating θ: J(θ) =∑ (x,y)∈S ( Eγ [max ŷ {θ>Φ(x, y) + ∑ α γα(yα)}]−θ>Φ(x, y) )\nThe theorem below establishes some basic properties of this criterion.\nTheorem 3. Under the above assumptions, J(θ) is convex and smooth, and its gradient enforces the mo-\nment matching constraints\n∂\n∂θ J(θ) = ∑ (x,y)∈S (∑ y′ p̂x(y ′)Φ(x, y′)− Φ(x, y) ) where\np̂x(y ′) def = P [ y′ ∈ argmax\nŷ1,...,ŷn {θ>Φ(x, ŷ) + ∑ α γα(ŷα)} ] ."
    }, {
      "heading" : "In particular, if γα(yα) have the Gumbel distribution, J(θ) upper bounds the conditional random field loss.",
      "text" : "Proof: The loss function is convex in θ, cf. (Rockafellar, 1974) Theorem 3. Corollary 1 implies that the surrogate loss upper bounds the partition-loss. To compute the gradient we use Theorem 23 in (Rockafellar, 1974) to differentiate under the integral. The subgradient of the max-function is the indicator function over the maximum argument, cf. Proposition 4.5.1 in (Bertsekas et al., 2003). Since the expectation over the indicator function results in a probability distribution, the surrogate loss is smooth and the gradient takes the above form.\nThe structure of α ⊂ {1, ..., n} determines the statistical quality and algorithmic efficiency of the approximation. For example, if we use a single set α = {1, ..., n}, this formulation is an exact characterization of the conditional random fields, and its gradient describes the standard moment matching condition."
    }, {
      "heading" : "6. Empirical Evaluation",
      "text" : "We evaluated our approach on spin glass models φ(y1, ..., yn) = ∑ i∈V φi(yi) + ∑ (i,j)∈E φi,j(yi, yj).\nwhere yi ∈ {−1, 1}. Each spin has a local field parameter φi(yi) = θiyi and interacts in a grid shaped graphical structure with couplings φi,j(yi, yj) = θi,jyiyj . Whenever the coupling parameters are positive the model is called attractive as adjacent variables give higher values to positively correlated configurations. We used low dimensional random perturbations γi(yi) since such perturbations do not affect the complexity of the MAP solver.\nEvaluating the partition function is challenging when considering strong local field potentials and coupling strengths. The corresponding energy landscape is ragged, and characterized by a relatively small set of dominating configurations. The energy and probability landscapes are presented in the supplementary material. In the following, we show that the random MAP\nperturbations approach performs better than previous approaches in this setting.\nWe evaluated the performance of our method on 10×10 spin glass. The local field parameters θi were drawn uniformly at random from [−f, f ], where f ∈ {0.1, 1} to reflect weak and strong potentials. The parameters θi,j were drawn uniformly from [0, c] or [−c, c] to obtain attractive or mixed coupling potentials. The following algorithms were used to estimate the partition function:\n• The random MAP perturbation approximation, described in Section 4.2, was executed by inflating the graphical model to 1000×1000 grid. When dealing with attractive potentials this was efficiently evaluated using graph-cuts (Boykov et al., 2001). This approximation method could not be applied to mixed potentials.\n• The random MAP perturbation upper bound, described in Section 4.1, with perturbations γi(yi). The expectation was computed using 100 random MAP perturbations, although very similar results were attained after only 10 perturbations. The MAP was computed in the attractive case using graph-cuts and in the mixed case using MPLP (Sontag et al., 2008).\n• The sum-product form of tree re-weighted belief propagation with uniform distribution over the spanning trees (Wainwright et al., 2005).\n• Sum-product belief propagation. Whenever the algorithm did not converge we extracted its partition function approximation from its messages.\nWe computed the absolute error in estimating the logarithm of the partition function, averaged over 100 spin glass models, see Fig. 1. One can see that the random MAP perturbation approximation works very well and gives a very accurate estimation using a single MAP value, when considering strong coupling potentials. Also, the random MAP perturbation upper bound is better than the tree re-weighted upper bound in the strong signal domain. Considering the attractive case, the random MAP perturbation approximation and upper bound used the graph-cuts algorithm, therefore were considerably faster than the belief propagation variants. The sum-product belief propagation performs well on the average, but from the plots one can observe its variance. This demonstrates the typical behavior of belief propagation, as it minimizes the non-convex Bethe free energy, thus works well on some instances and does not converge or attain bad local minima on others.\nWe note that the lower bounds of random MAP perturbations, described in Section 4.3, are qualitatively the same as the MAP value, and are outperformed by standard techniques such as the mean-field. We omitted these experiments.\nWe also demonstrated the effectiveness of random MAP perturbations in supervised learning. The training data was composed of ten 100× 70 binary images, consisting of a man silhouette and a random binary noise, described in Fig. 2. Each image x is described by binary local features φi(x, yi) which encodes if the i-th pixel is foreground or background, and pairwise features φi,j(yi, yi) which encourages adjacent features to have the same label. The goal is to estimate the parameters θi, θi,j to de-noise the images. Since we are considering 100×70 images, there are about 20, 000 parameters to estimate. Conditional random fields cannot be evaluated on this problem, as the partition function cannot be computed to general graphs with many cycles. However, the MAP can be efficiently estimated using MPLP, thus we applied our approximate conditional random fields described in Section 5. Using the estimated parameters, the pixel based error on the test set was 1.8%. As mentioned before, this approach cannot be compared with conditional random fields. However, without perturbations this program relates to structured-SVM (cf. (Tsochantaridis et al., 2006)) and can be evaluated through MAP solvers. For this case, the pixel based error on the test set was 8.2%."
    }, {
      "heading" : "7. Related Work",
      "text" : "Throughout this work, we estimate the partition function while computing the max-statistics of collections of random variables. We refer the interested reader to (Kotz & Nadarajah, 2000) for more comprehensive introduction to extreme value statistics.\nTo the best of our knowledge the expected value of\nRandom MAP perturbations over discrete product spaces has not been extensively studied. Talagrand ((Talagrand, 1994), Proposition 4.3) was the first to use random MAP perturbations in discrete settings. However, their approach differs from ours in that their goal was to upper bound the size of dom(φ) ⊆ {0, 1}n using random variables with the Laplace distribution. The proof technique is based on a compression argument, and does not extend to the partition function. Restricting to φ(y) ∈ {−∞, 0}, Corollary 1 presents an alternative technique with weighted assignments. Another upper bound for dom(φ) ⊆ {0, 1}n was described in ((Barvinok & Samorodnitsky, 2007), Theorem 3.1). Their approach used the induction method of (Talagrand, 1995) to prove an upper bound using the logistic distribution. Our Corollary 1 provides an alternative technique for this result. They also extend their upper bound to functions of the form∑ y∈dom(φ) ∏ i: yi=1 qi, where qi are rational numbers.\nIn this work we also consider parameter estimation using approximate conditional random fields. While computing the gradient we obtained the known result that the Gibbs distribution can be described by the maximal argument of random MAP perturbation. This result is widely used in economics, providing a probabilistic interpretation for choices made by people among a finite set of alternatives. Specifically, the probability of choosing an alternative P [ŷ ∈ argmaxy{φ(y) + γ(y)}] follows the Gibbs distribution whenever γ(y) are independent and distributed according to the Gumbel distribution (McFadden, 1974). This approach is computationally intractable when dealing with discrete product spaces, as it considers n-dimensional independent perturbations. This motivated efficient ways to approximately sample from the Gibbs distribution, through a probability distribution of the form: P [ŷ ∈ argmaxy{φ(y) + ∑ α γα(yα)}], (Papandreou & Yuille, 2011). In particular, the gradient suggested in Theorem 3 was described in (Papandreou & Yuille, 2011). For a more general class of probabilistic models that exploit efficient optimization we refer to (Tarlow et al., 2012). Whenever the perturbations occur in the feature space, random MAP perturbation models relate to PAC-Bayes generalization bounds (Keshet et al., 2011). Other surrogate probability models using computational structures appears in (Papandreou & Yuille, 2010; Kulesza & Taskar, 2010).\nMore broadly, methods for estimating the partition function were subject to extensive research over the past decades. Gibbs sampling, Annealed Importance Sampling and MCMC are typically used for estimating the partition function (cf. (Koller & Friedman, 2009)\nand references therein). These methods are slow when considering ragged energy landscapes, and their mixing time is typically exponential in n. In contrast, perturbed MAP operations are unaffected by ragged energy landscapes provided that the MAP is feasible.\nVariational approaches have been extensively developed to efficiently estimate the partition function in large-scale problems. These are often inner-bound methods where a simpler distribution is optimized as an approximation to the posterior in a KL-divergence sense. The difficulty comes from non-convexity of the set of feasible distributions (e.g., mean field) (Jordan et al., 1999). Variational upper bounds on the other hand are convex, usually derived by replacing the entropy term with a simpler surrogate function and relaxing constraints on sufficient statistics (see, e.g., (Wainwright et al., 2005))."
    }, {
      "heading" : "8. Discussion",
      "text" : "Evaluating the partition function and computing MAP assignments of variables are key sub-problems in machine learning. While it is well-known that the ability to compute the partition function also leads to a viable MAP algorithm, the reverse is not. We showed here that a randomly perturbed MAP solver can approximate and bound the partition function. The result enables us to take advantage of efficient MAP solvers. Moreover, we demonstrated the effectiveness of our approach in the ”high-signal high-coupling” regime which dominates machine learning applications and is traditionally hard for current methods. We also applied our approximation to conditional random fields, describing the objective function to the moment matching algorithm of (Papandreou & Yuille, 2011).\nThe bounds we presented hold with expectation. In practice we compute the empirical mean, and standard techniques in measure concentration, e.g. Chebyshev’s inequality, describe how the sampled mean relates to the expected value.\nThe results here can be taken in a number of different directions. The surrogate probability model, emerging from Theorem 3, is based on the maximal argument of perturbed MAP program. This surrogate probability model directly measures the robustness of prediction. Our approach also suggests a new entropy approximation, which can be derived as the conjugate-dual of the surrogate log-partition function. This entropy approximation is used with a valid set of probability distributions induced by perturbations. This is in contrast to current approximations, e.g. based on Bethe entropies, defined over the local marginal polytope."
    } ],
    "references" : [ {
      "title" : "Random weighting, asymptotic counting, and inverse isoperimetry",
      "author" : [ "A. Barvinok", "A. Samorodnitsky" ],
      "venue" : "Israel Journal of Mathematics,",
      "citeRegEx" : "Barvinok and Samorodnitsky,? \\Q2007\\E",
      "shortCiteRegEx" : "Barvinok and Samorodnitsky",
      "year" : 2007
    }, {
      "title" : "Fast approximate energy minimization via graph cuts",
      "author" : [ "Y. Boykov", "O. Veksler", "R. Zabih" ],
      "venue" : null,
      "citeRegEx" : "Boykov et al\\.,? \\Q2001\\E",
      "shortCiteRegEx" : "Boykov et al\\.",
      "year" : 2001
    }, {
      "title" : "Object detection with discriminatively trained part-based models",
      "author" : [ "P.F. Felzenszwalb", "R.B. Girshick", "D. McAllester", "D. Ramanan" ],
      "venue" : "IEEE Transactions on Pattern Analysis and Machine Intelligence,",
      "citeRegEx" : "Felzenszwalb et al\\.,? \\Q2009\\E",
      "shortCiteRegEx" : "Felzenszwalb et al\\.",
      "year" : 2009
    }, {
      "title" : "An introduction to variational methods for graphical models",
      "author" : [ "M.I. Jordan", "Z. Ghahramani", "T.S. Jaakkola", "L.K. Saul" ],
      "venue" : "Machine learning,",
      "citeRegEx" : "Jordan et al\\.,? \\Q1999\\E",
      "shortCiteRegEx" : "Jordan et al\\.",
      "year" : 1999
    }, {
      "title" : "Pacbayesian approach for minimization of phoneme error rate",
      "author" : [ "J. Keshet", "D. McAllester", "T. Hazan" ],
      "venue" : "In The International Conference on Acoustics, Speech, and Signal Processing (ICASSP),",
      "citeRegEx" : "Keshet et al\\.,? \\Q2011\\E",
      "shortCiteRegEx" : "Keshet et al\\.",
      "year" : 2011
    }, {
      "title" : "Probabilistic graphical models",
      "author" : [ "D. Koller", "N. Friedman" ],
      "venue" : "MIT press,",
      "citeRegEx" : "Koller and Friedman,? \\Q2009\\E",
      "shortCiteRegEx" : "Koller and Friedman",
      "year" : 2009
    }, {
      "title" : "Convergent tree-reweighted message passing for energy minimization",
      "author" : [ "V. Kolmogorov" ],
      "venue" : null,
      "citeRegEx" : "Kolmogorov,? \\Q2006\\E",
      "shortCiteRegEx" : "Kolmogorov",
      "year" : 2006
    }, {
      "title" : "Dual decomposition for parsing with non-projective head automata",
      "author" : [ "T. Koo", "A.M. Rush", "M. Collins", "T. Jaakkola", "D. Sontag" ],
      "venue" : "In EMNLP,",
      "citeRegEx" : "Koo et al\\.,? \\Q2010\\E",
      "shortCiteRegEx" : "Koo et al\\.",
      "year" : 2010
    }, {
      "title" : "Extreme value distributions: theory and applications",
      "author" : [ "S. Kotz", "S. Nadarajah" ],
      "venue" : "World Scientific Publishing Company,",
      "citeRegEx" : "Kotz and Nadarajah,? \\Q2000\\E",
      "shortCiteRegEx" : "Kotz and Nadarajah",
      "year" : 2000
    }, {
      "title" : "Structured determinantal point processes",
      "author" : [ "A. Kulesza", "B. Taskar" ],
      "venue" : "In Proc. Neural Information Processing Systems,",
      "citeRegEx" : "Kulesza and Taskar,? \\Q2010\\E",
      "shortCiteRegEx" : "Kulesza and Taskar",
      "year" : 2010
    }, {
      "title" : "Statistical physics: Course of theoretical physics, vol",
      "author" : [ "L.D. Landau", "Lifshitz", "EM" ],
      "venue" : null,
      "citeRegEx" : "Landau et al\\.,? \\Q1980\\E",
      "shortCiteRegEx" : "Landau et al\\.",
      "year" : 1980
    }, {
      "title" : "Conditional logit analysis of qualitative choice behavior, volume 1, pp. 105–142",
      "author" : [ "D. McFadden" ],
      "venue" : null,
      "citeRegEx" : "McFadden,? \\Q1974\\E",
      "shortCiteRegEx" : "McFadden",
      "year" : 1974
    }, {
      "title" : "Gaussian sampling by local perturbations",
      "author" : [ "G. Papandreou", "A. Yuille" ],
      "venue" : "In Proc. Int. Conf. on Neural Information Processing Systems (NIPS),",
      "citeRegEx" : "Papandreou and Yuille,? \\Q2010\\E",
      "shortCiteRegEx" : "Papandreou and Yuille",
      "year" : 2010
    }, {
      "title" : "Perturb-and-map random fields: Using discrete optimization to learn and sample from energy models",
      "author" : [ "G. Papandreou", "A. Yuille" ],
      "venue" : "In Proc. IEEE Int. Conf. on Computer Vision (ICCV),",
      "citeRegEx" : "Papandreou and Yuille,? \\Q2011\\E",
      "shortCiteRegEx" : "Papandreou and Yuille",
      "year" : 2011
    }, {
      "title" : "Conjugate duality and optimization",
      "author" : [ "R.T. Rockafellar" ],
      "venue" : "Society for Industrial Mathematics,",
      "citeRegEx" : "Rockafellar,? \\Q1974\\E",
      "shortCiteRegEx" : "Rockafellar",
      "year" : 1974
    }, {
      "title" : "Finding MAPs for belief networks is NP-hard",
      "author" : [ "S.E. Shimony" ],
      "venue" : "Artificial Intelligence,",
      "citeRegEx" : "Shimony,? \\Q1994\\E",
      "shortCiteRegEx" : "Shimony",
      "year" : 1994
    }, {
      "title" : "Tightening LP relaxations for MAP using message passing",
      "author" : [ "D. Sontag", "T. Meltzer", "A. Globerson", "T. Jaakkola", "Y. Weiss" ],
      "venue" : "In Conf. Uncertainty in Artificial Intelligence (UAI). Citeseer,",
      "citeRegEx" : "Sontag et al\\.,? \\Q2008\\E",
      "shortCiteRegEx" : "Sontag et al\\.",
      "year" : 2008
    }, {
      "title" : "A comparative study of energy minimization methods for markov random fields with smoothness-based priors",
      "author" : [ "R. Szeliski", "R. Zabih", "D. Scharstein", "O. Veksler", "V. Kolmogorov", "A. Agarwala", "M. Tappen", "C. Rother" ],
      "venue" : null,
      "citeRegEx" : "Szeliski et al\\.,? \\Q2007\\E",
      "shortCiteRegEx" : "Szeliski et al\\.",
      "year" : 2007
    }, {
      "title" : "The supremum of some canonical processes",
      "author" : [ "M. Talagrand" ],
      "venue" : "American Journal of Mathematics,",
      "citeRegEx" : "Talagrand,? \\Q1994\\E",
      "shortCiteRegEx" : "Talagrand",
      "year" : 1994
    }, {
      "title" : "Concentration of measure and isoperimetric inequalities in product spaces",
      "author" : [ "M. Talagrand" ],
      "venue" : "Publications Mathématiques de l’Institut des Hautes Études Scientifiques,",
      "citeRegEx" : "Talagrand,? \\Q1995\\E",
      "shortCiteRegEx" : "Talagrand",
      "year" : 1995
    }, {
      "title" : "Randomized Optimum Models for Structured Prediction",
      "author" : [ "D. Tarlow", "R.P. Adams", "R.S. Zemel" ],
      "venue" : "In AISTATS,",
      "citeRegEx" : "Tarlow et al\\.,? \\Q2012\\E",
      "shortCiteRegEx" : "Tarlow et al\\.",
      "year" : 2012
    }, {
      "title" : "Large margin methods for structured and interdependent output variables",
      "author" : [ "I. Tsochantaridis", "T. Joachims", "T. Hofmann", "Y. Altun" ],
      "venue" : "Journal of Machine Learning Research,",
      "citeRegEx" : "Tsochantaridis et al\\.,? \\Q2006\\E",
      "shortCiteRegEx" : "Tsochantaridis et al\\.",
      "year" : 2006
    }, {
      "title" : "The complexity of computing the permanent",
      "author" : [ "L.G. Valiant" ],
      "venue" : "Theoretical computer science,",
      "citeRegEx" : "Valiant,? \\Q1979\\E",
      "shortCiteRegEx" : "Valiant",
      "year" : 1979
    }, {
      "title" : "A new class of upper bounds on the log partition function",
      "author" : [ "M.J. Wainwright", "T.S. Jaakkola", "A.S. Willsky" ],
      "venue" : "Trans. on Information Theory,",
      "citeRegEx" : "Wainwright et al\\.,? \\Q2005\\E",
      "shortCiteRegEx" : "Wainwright et al\\.",
      "year" : 2005
    }, {
      "title" : "High-arity interactions, polyhedral relaxations, and cutting plane algorithm for soft constraint optimisation (map-mrf)",
      "author" : [ "T. Werner" ],
      "venue" : "In Computer Vision and Pattern Recognition,",
      "citeRegEx" : "Werner,? \\Q2008\\E",
      "shortCiteRegEx" : "Werner",
      "year" : 2008
    } ],
    "referenceMentions" : [ {
      "referenceID" : 2,
      "context" : "Examples include object detection (Felzenszwalb et al., 2009), stereo vision (Szeliski et al.",
      "startOffset" : 34,
      "endOffset" : 61
    }, {
      "referenceID" : 17,
      "context" : ", 2009), stereo vision (Szeliski et al., 2007), parsing (Koo et al.",
      "startOffset" : 23,
      "endOffset" : 46
    }, {
      "referenceID" : 7,
      "context" : ", 2007), parsing (Koo et al., 2010), or protein design (Sontag et al.",
      "startOffset" : 17,
      "endOffset" : 35
    }, {
      "referenceID" : 16,
      "context" : ", 2010), or protein design (Sontag et al., 2008).",
      "startOffset" : 27,
      "endOffset" : 48
    }, {
      "referenceID" : 6,
      "context" : "Indeed, substantial effort has gone into developing algorithms for recovering MAP assignments, either based on specific structural restrictions such as super-modularity (Kolmogorov, 2006) or by devising approximate methods based on linear programming relaxations (Sontag et al.",
      "startOffset" : 169,
      "endOffset" : 187
    }, {
      "referenceID" : 16,
      "context" : "Indeed, substantial effort has gone into developing algorithms for recovering MAP assignments, either based on specific structural restrictions such as super-modularity (Kolmogorov, 2006) or by devising approximate methods based on linear programming relaxations (Sontag et al., 2008; Werner, 2008).",
      "startOffset" : 263,
      "endOffset" : 298
    }, {
      "referenceID" : 24,
      "context" : "Indeed, substantial effort has gone into developing algorithms for recovering MAP assignments, either based on specific structural restrictions such as super-modularity (Kolmogorov, 2006) or by devising approximate methods based on linear programming relaxations (Sontag et al., 2008; Werner, 2008).",
      "startOffset" : 263,
      "endOffset" : 298
    }, {
      "referenceID" : 4,
      "context" : "While models based on random perturbations have been considered recently (Papandreou & Yuille, 2011; Keshet et al., 2011; Tarlow et al., 2012), their relation to the partition function has not.",
      "startOffset" : 73,
      "endOffset" : 142
    }, {
      "referenceID" : 20,
      "context" : "While models based on random perturbations have been considered recently (Papandreou & Yuille, 2011; Keshet et al., 2011; Tarlow et al., 2012), their relation to the partition function has not.",
      "startOffset" : 73,
      "endOffset" : 142
    }, {
      "referenceID" : 22,
      "context" : "In general, counting problems are considered very hard, many belonging to the complexity class #P (Valiant, 1979).",
      "startOffset" : 98,
      "endOffset" : 113
    }, {
      "referenceID" : 15,
      "context" : "Although the MAP problem is NP-hard in general (Shimony, 1994), it is easier than computing the partition function.",
      "startOffset" : 47,
      "endOffset" : 62
    }, {
      "referenceID" : 14,
      "context" : "(Rockafellar, 1974) Theorem 3.",
      "startOffset" : 0,
      "endOffset" : 19
    }, {
      "referenceID" : 14,
      "context" : "To compute the gradient we use Theorem 23 in (Rockafellar, 1974) to differentiate under the integral.",
      "startOffset" : 45,
      "endOffset" : 64
    }, {
      "referenceID" : 1,
      "context" : "When dealing with attractive potentials this was efficiently evaluated using graph-cuts (Boykov et al., 2001).",
      "startOffset" : 88,
      "endOffset" : 109
    }, {
      "referenceID" : 16,
      "context" : "The MAP was computed in the attractive case using graph-cuts and in the mixed case using MPLP (Sontag et al., 2008).",
      "startOffset" : 94,
      "endOffset" : 115
    }, {
      "referenceID" : 23,
      "context" : "• The sum-product form of tree re-weighted belief propagation with uniform distribution over the spanning trees (Wainwright et al., 2005).",
      "startOffset" : 112,
      "endOffset" : 137
    }, {
      "referenceID" : 21,
      "context" : "(Tsochantaridis et al., 2006)) and can be evaluated through MAP solvers.",
      "startOffset" : 0,
      "endOffset" : 29
    }, {
      "referenceID" : 18,
      "context" : "Talagrand ((Talagrand, 1994), Proposition 4.",
      "startOffset" : 11,
      "endOffset" : 28
    }, {
      "referenceID" : 19,
      "context" : "Their approach used the induction method of (Talagrand, 1995) to prove an upper bound using the logistic distribution.",
      "startOffset" : 44,
      "endOffset" : 61
    }, {
      "referenceID" : 11,
      "context" : "Specifically, the probability of choosing an alternative P [ŷ ∈ argmaxy{φ(y) + γ(y)}] follows the Gibbs distribution whenever γ(y) are independent and distributed according to the Gumbel distribution (McFadden, 1974).",
      "startOffset" : 200,
      "endOffset" : 216
    }, {
      "referenceID" : 20,
      "context" : "For a more general class of probabilistic models that exploit efficient optimization we refer to (Tarlow et al., 2012).",
      "startOffset" : 97,
      "endOffset" : 118
    }, {
      "referenceID" : 4,
      "context" : "Whenever the perturbations occur in the feature space, random MAP perturbation models relate to PAC-Bayes generalization bounds (Keshet et al., 2011).",
      "startOffset" : 128,
      "endOffset" : 149
    }, {
      "referenceID" : 3,
      "context" : ", mean field) (Jordan et al., 1999).",
      "startOffset" : 14,
      "endOffset" : 35
    }, {
      "referenceID" : 23,
      "context" : ", (Wainwright et al., 2005)).",
      "startOffset" : 2,
      "endOffset" : 27
    } ],
    "year" : 2012,
    "abstractText" : "In this paper we relate the partition function to the max-statistics of random variables. In particular, we provide a novel framework for approximating and bounding the partition function using MAP inference on randomly perturbed models. As a result, we can use efficient MAP solvers such as graph-cuts to evaluate the corresponding partition function. We show that our method excels in the typical “high signal high coupling” regime that results in ragged energy landscapes difficult for alternative approaches.",
    "creator" : "LaTeX with hyperref package"
  }
}