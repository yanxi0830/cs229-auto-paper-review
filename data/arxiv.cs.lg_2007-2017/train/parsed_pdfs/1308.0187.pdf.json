{
  "name" : "1308.0187.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "Fast Product Format",
    "authors" : [ "Stephen Pasteris" ],
    "emails" : [ "s.pasteris@cs.ucl.ac.uk" ],
    "sections" : [ {
      "heading" : null,
      "text" : "ar X\niv :1\n30 8.\n01 87\nv1 [\ncs .A\nI] 3\n1 Ju\nupsweep and downsweep take a time of O ( ∑\nΓ∈J deg(Γ)2 |Γ|\n)\n. The use\nof Inclusion Exclusion Format (IEF) (Smith, Gogate: “The InclusionExculsion Rule and its Application to the Junction Tree Algorithm”) allows the downsweep (which involves calculating possibly a large number of marginals of a potential at each internal vertex of J ) to be done in a time of O ( ∑\nΓ∈J |Γ|2 |Γ|\n)\n, which, in many cases, is a very large saving\nin complexity. Upsweep (which involves taking the product of possibly a large number of potentials at each internal vertex of J ), however, still takes a time of O ( ∑\nΓ∈J deg(Γ)2 |Γ|\n)\n(so the use of IEF alone does not\nreduce the time complexity of the full batch junction tree algorithm). In this paper we introduce the Fast Product Format (FPF) which allows the upsweep, also, to be done in a time of O ( ∑\nΓ∈J |Γ|2 |Γ|\n)\n(hence, by using\nboth IEF and FPF we can do the full batch junction tree algorithm in a time of O ( ∑\nΓ∈J |Γ|2 |Γ|\n)\n).\nPreliminaries: Given a set X we define P(X) to be the power set of X (that is, the set of subsets of X) and define |X | to be the cardinality of X (that is, the number of elements in X). A collection is a set that may contain duplicate elements (we use the subset symbol, S ⊆ X , to denote that every element in the collection S is also contained in the set X). This paper assumes we have a alebian group G who’s identity is denoted 1. Given an element a ∈ G we define a−1 to be the inverse element of a. Given elements a, b ∈ G we define ab to be the product of a and b in G. Given a finite collection S ⊆ G we define ∏\na∈S a to be the product of all elements of S (i.e. if S = {ai : i ∈ Nk}, we have ∏\na∈S a := a1a2a3...ak). Given an element a ∈ G we define a 0 := 1.\nFor i ∈ N \\ {0} we inductively define ai (resp. a−i) to be equal to aai−1 (resp. a−1a−i+1). We assume that the group product operation and the inverse operation both take a time of O(1).\nDefinition 1. A potential on a set X is a function from P(X) to G. Given a set X, the set of potentials on X is denoted T (X).\nNote that a potential on a set X represents a function from the set of all binary valued labelings of X into G.\nDefinition 2. Given a set X and a collection of potentials S ⊆ T (X), we define the product, ∏\nΨ∈S Ψ as the potential Ψ̃ ∈ T (X) that satisfies, for every Y ∈ P(X):\nΨ̃(Y ) := ∏\nΨ∈S\nΨ(Y ) (1)\nDefinition 3. Given a set X, a subset Y ∈ P(X) and a potential Ψ ∈ T (Y ), the extension, [Ψ, X ], of Ψ to X is the potential in T (X) that satisfies, for every Z ∈ P(X):\n[Ψ, X ](Z) = Ψ(Z ∩ Y ) (2)\nThe problem that this paper solves is as follows: We have a set X , a collection of subsets {Xi : i ∈ Nk} where each Xi is in P(X), and a collection of potentials {Ψi : i ∈ Nk} where each Ψi is in T (Xi). We wish to compute the product ∏k\ni=0[Ψi, X ]. The direct computation of this product would take a time of O(k2|X|). In this paper we introduce the fast product format of a potential, the use of which allows us to compute the product in a time of O ( |X |2|X| + ∑k\ni=0 |Xi|2 |Xi|\n)\n.\nHence, in the cases that k is much larger than |X | and the sets Xi are much smaller than X , using the fast product format greatly decreases the time complexity. The use of fast product format requires only linear space complexity.\nDefinition 4. Given a number i ∈ N and an element x ∈ G, we define E (i, x) to be equal to x if i is even and x−1 otherwise.\nDefinition 5. Given a set X and a potential Ψ ∈ T (X), the fast product format (FPF), Ψ′, of Ψ is the potential in T (X) that satisfies, for every Y ∈ P(X):\nΨ′(Y ) = ∏\nZ∈P(Y )\nE (|Z|,Ψ(Z)) (3)\nWe now show how an FPF can be recursively computed:\nTheorem 6. Suppose we have a set X and a potential Ψ ∈ T (X). Suppose we have some element v ∈ X. Let [Ψ−] be the potential in T (X \\ {v}) that satisfies, for all Y ∈ P(X \\ {v}), [Ψ−](Y ) := Ψ(Y ) and let [Ψ+] be the potential in T (X \\ {v}) that satisfies, for all Y ∈ P(X \\ {v}), [Ψ+](Y ) := Ψ(Y ∪ {v}). Then for all Y ∈ P(X \\ {v}) we have:\n1. Ψ′(Y ) = [Ψ−] ′ (Y )\n2. Ψ′(Y ∪ {v}) = [Ψ−] ′ (Y )[Ψ+] ′ (Y )\n−1\nProof. 1. We have:\nΨ′(Y ) = ∏\nZ∈P(Y )\nE (|Z|,Ψ(Z)) (4)\n= ∏\nZ∈P(Y )\nE (|Z|, [Ψ−](Z)) (5)\n= [Ψ−] ′ (Y ) (6)\n2. We have:\nΨ′(Y ∪ {v}) (7)\n= ∏\nZ∈P(Y ∪{v})\nE (|Z|,Ψ(Z)) (8)\n=\n\n\n∏\nZ∈P(Y )\nE (|Z|,Ψ(Z))\n\n\n\n\n∏\nZ∈P(Y )\nE (|Z ∪ {v}|,Ψ(Z + {v}))\n\n (9)\n=\n\n\n∏\nZ∈P(Y )\nE (|Z|,Ψ(Z))\n\n\n\n\n∏\nZ∈P(Y )\nE (|Z|+ 1,Ψ(Z + {v}))\n\n (10)\n=\n\n\n∏\nZ∈P(Y )\nE (|Z|,Ψ(Z))\n\n\n\n\n∏\nZ∈P(Y )\nE (|Z|,Ψ(Z + {v})) −1\n\n (11)\n=\n\n\n∏\nZ∈P(Y )\nE (|Z|,Ψ(Z))\n\n\n\n\n∏\nZ∈P(Y )\nE (|Z|,Ψ(Z + {v}))\n\n\n−1\n(12)\n=\n\n\n∏\nZ∈P(Y )\nE (|Z|, [Ψ−](Z))\n\n\n\n\n∏\nZ∈P(Y )\nE (|Z|, [Ψ+](Z))\n\n\n−1\n(13)\n= [Ψ−] ′ (Y )[Ψ+] ′ (Y ) −1 (14)\nwhere equation 10 comes from the fact that v /∈ Z for all Z ∈ P(Y ).\nWe now show how to recover a potential from its FPF:\nLemma 7. For m ∈ N \\ {0}:\nm ∑\ni=0\n(−1)i ( m\ni\n)\n= 0 (15)\nProof. Standard result\nTheorem 8. Given a set X and potential Ψ ∈ T (X) we have:\nΨ = [Ψ′] ′\n(16)\nProof. Suppose we have some Y ∈ P(X). For any U ∈ P(Y ) and i ∈ N|Y | let Υ(U, i) be equal to |{Z ∈ P(Y ) : U ⊆ Z and |Z| = i}|. We have:\n[Ψ′] ′ (Y ) =\n∏\nZ∈P(Y )\nE (|Z|,Ψ′(Z)) (17)\n= ∏\nZ∈P(Y )\nE\n\n|Z|, ∏\nU∈P(Z)\nE (|U |,Ψ(U))\n\n (18)\n= ∏\nZ∈P(Y )\n∏\nU∈P(Z)\nE (|Z|+ |U |,Ψ(U)) (19)\n= ∏\nU∈P(Y )\n∏\nZ∈P(Y ):U⊆Z\nE (|Z|+ |U |,Ψ(U)) (20)\n= ∏\nU∈P(Y )\n|Y | ∏\ni=0\n∏\nZ∈P(Y ):|Z|=i andU⊆Z\nE (|Z|+ |U |,Ψ(U)) (21)\n= ∏\nU∈P(Y )\n|Y | ∏\ni=0\n∏\nZ∈P(Y ):|Z|=i andU⊆Z\nE (i+ |U |,Ψ(U)) (22)\n= ∏\nU∈P(Y )\n|Y | ∏\ni=0\nE (i+ |U |,Ψ(U))Υ(U,i) (23)\n= ∏\nU∈P(Y )\n|Y | ∏\ni=0\nE (|U |,Ψ(U))(−1) iΥ(U,i) (24)\n= ∏\nU∈P(Y )\n|Y | ∏\ni=0\nE ( |U |,Ψ(U)(−1) iΥ(U,i) )\n(25)\n= ∏\nU∈P(Y )\nE\n\n|U |,\n|Y | ∏\ni=0\nΨ(U)(−1) iΥ(U,i)\n\n (26)\n= ∏\nU∈P(Y )\nE ( |U |,Ψ(U) ∑|Y | i=0 (−1)iΥ(U,i) )\n(27)\nSuppose we have some U ∈ P(Y ). If i < |U | then there exists no set Z ∈ P(Y ) with U ⊆ Z and |Z| = i (since such a Z must satisfy |Z| ≥ |U |.) so Υ(U, i) = 0.\nIf i ≥ |U | then we have:\nΥ(U, i) = |{Z ∈ P(Y ) : U ⊆ Z and |Z| = i}| (28)\n= |{U ∪ V : V ∈ P(Y \\ U) and |U ∪ V | = i}| (29)\n= |{V : V ∈ P(Y \\ U) and |U ∪ V | = i}| (30)\n= |{V : V ∈ P(Y \\ U) and |U |+ |V | = i}| (31)\n= |{V : V ∈ P(Y \\ U) and |V | = i− |U |}| (32)\n=\n(\n|Y | − |U |\ni− |U |\n)\n(33)\nHence we have:\n|Y | ∑\ni=0\n(−1)iΥ(U, i) =\n|Y | ∑\ni=|U|\n(−1)iΥ(U, i) (34)\n=\n|Y | ∑\ni=|U|\n(−1)i ( |Y | − |U |\ni− |U |\n)\n(35)\n= (−1)|U| |Y |−|U| ∑\nj=0\n(−1)j ( |Y | − |U |\nj\n)\n(36)\nwhere equation 34 comes from the fact that Υ(U, i) = 0 for i < |U |, equation 35 comes from equation 33 and equation 36 comes by setting j := i − |U |. Hence, if U 6= Y we have (since U ∈ P(Y )) |U | < |Y | so |Y | − |U | > 0 and hence by lemma 7 and equation 36 we have ∑|Y |\ni=0(−1) iΥ(U, i) = 0\nso E ( |U |,Ψ(U) ∑|Y | i=0 (−1)iΥ(U,i) ) = E ( |U |,Ψ(U)0 ) = E (|U |, 1) = 1. On the\nother hand, if U = Y then by equation 36 we have ∑|Y |\ni=0(−1) iΥ(U, i) =\n(−1)|Y |(−1)0 ( 0 0 )\n= (−1)|Y | so E ( |U |,Ψ(U) ∑|Y | i=0 (−1)iΥ(U,i) ) = E ( |Y |,Ψ(Y )(−1) |Y | ) =\nE (2|Y |,Ψ(Y )) = Ψ(Y ). Plugging these identities into equation 27 gives us [Ψ′] ′ (Y ) = Ψ(Y ). Since this holds for every Y ∈ P(X) we hence have Ψ = [Ψ′] ′ .\nWe now show how to derive the FPF of an extension (from the FPF of the original potential) and demonstrate its sparsity:\nLemma 9. Given a set X, a subset Y ∈ P(X) and a potential Ψ ∈ T (Y ), the FPF of the potential [Ψ, X ] satisfies, for every Z ∈ P(X):\n1. If Z ⊆ Y , [Ψ, X ] ′ (Z) = Ψ′(Z)\n2. If Z * Y , [Ψ, X ]′(Z) = 1\nProof. 1. If Z ⊆ Y then:\n[Ψ, X ] ′ (Z) =\n∏\nU∈P(Z)\nE (|U |, [Ψ, X ](U)) (37)\n= ∏\nU∈P(Z)\nE (|U |,Ψ(U ∩ Y )) (38)\n= ∏\nU∈P(Z)\nE (|U |,Ψ(U)) (39)\n= Ψ′(Z) (40)\nwhere equation 39 holds since each U is a subset of Y and equation 40 holds since Z is in P(Y ).\n2. If Z * Y then choose an element v ∈ Z that is not contained in Y . We have the following identities:\n[Ψ, X ] ′ (Z) =\n∏\nU∈P(Z)\nE (|U |, [Ψ, X ](U)) (41)\n= ∏\nU∈P(Z)\nE (|U |,Ψ(U ∩ Y )) (42)\n= ∏\nU∈P(Z\\{v})\nE (|U |,Ψ(U ∩ Y )) E (|U ∪ {v}|,Ψ((U ∪ {v}) ∩ Y ))\n(43)\n= ∏\nU∈P(Z\\{v})\nE (|U |,Ψ(U ∩ Y )) E (|U ∪ {v}|,Ψ(U ∩ Y )) (44)\n= ∏\nU∈P(Z\\{v})\nE (|U |,Ψ(U ∩ Y )) E (|U |+ 1,Ψ(U ∩ Y )) (45)\n= ∏\nU∈P(Z\\{v})\nE (|U |,Ψ(U ∩ Y )) E (|U |,Ψ(U ∩ Y )) −1\n(46)\n= ∏\nU∈P(Z\\{v})\n1 (47)\n= 1 (48)\nwhere equation 43 holds since P(Z) is the disjoint union of {U : U ∈ P(Z \\ {v})} and {U ∪ {v} : U ∈ P(Z \\ {v})}, equation 44 holds since v /∈ Y , and equation 45 holds since v /∈ U .\nWe now show that the product operator is preserved in FPF:\nLemma 10. Given a set X and a collection of potentials S ⊆ T (X), each of which is in T (X), we have:\n[\n∏\nΨ∈S\nΨ\n]′\n= ∏\nΨ∈S\nΨ′ (49)\nProof. Suppose we have some Y ∈ P(X). We have: [\n∏\nΨ∈S\nΨ\n]′\n(Y ) = ∏\nZ∈P(Y )\nE\n(\n|Z|,\n[\n∏\nΨ∈S\nΨ\n]\n(Z)\n)\n(50)\n= ∏\nZ∈P(Y )\nE\n(\n|Z|, ∏\nΨ∈S\nΨ(Z)\n)\n(51)\n= ∏\nZ∈P(Y )\n∏\nΨ∈S\nE (|Z|,Ψ(Z)) (52)\n= ∏\nΨ∈S\n∏\nZ∈P(Y )\nE (|Z|,Ψ(Z)) (53)\n= ∏\nΨ∈S\nΨ′(Y ) (54)\n=\n[\n∏\nΨ∈S\nΨ′\n]\n(Y ) (55)\nSince this holds for all Y ∈ P(X) we have the result.\nBy combining lemmas 9 and 10 we obtain the following theorem, which shows how to rapidly compute the product of extensions when working in FPF:\nTheorem 11. Suppose we have a set X, a collection of subsets {Xi : i ∈ Nk} where each Xi is in P(X), and a collection of potentials {Ψi : i ∈ Nk} where each Ψi is in T (Xi). Then given any Y ∈ P(X):\n[\nk ∏\ni=0\n[Ψi, X ]\n]′\n(Y ) = ∏\ni∈Nk:Y⊆Xi\nΨi ′(Y ) (56)\nProof. We have:\n[\nk ∏\ni=0\n[Ψi, X ]\n]′\n(Y ) =\n[\nk ∏\ni=0\n[Ψi, X ] ′\n]\n(Y ) (57)\n= k ∏\ni=0\n[Ψi, X ] ′(Y ) (58)\n=\n\n\n∏\ni∈Nk:Y⊆Xi\n[Ψi, X ] ′ (Y )\n\n\n\n\n∏\ni∈Nk:Y*Xi\n[Ψi, X ] ′ (Y )\n\n (59)\nwhere equation 57 comes from lemma 10. Suppose we have i ∈ Nk with Y ⊂ Xi. Then by lemma 9 we have [Ψi, X ] ′ (Y ) = Ψi ′(Y ). Hence we have:\n∏\ni∈Nk:Y⊆Xi\n[Ψi, X ] ′ (Y ) =\n∏\ni∈Nk:Y⊆Xi\nΨi ′(Y ) (60)\nOn the other hand suppose we have i ∈ Nk with Y * Xi. Then by lemma 9 we have [Ψi, X ] ′ (Y ) = 1. Hence we have:\n∏\ni∈Nk:Y*Xi\n[Ψi, X ] ′ (Y ) =\n∏\ni∈Nk:Y *Xi\n1 (61)\n= 1 (62)\nBy plugging equation 60 and 62 into equation 59 we obtain the result.\nWe now give the time complexities of two operations involving fast product formats (both algorithms rely on the input potentials being stored in full balanced binary trees. The output potentials are stored in the same structure. This structure also allows for fast computation of a marginal):\nAlgorithm 12. Given a set X and a potential Ψ ∈ T (X), if we have an input of Ψ, we can compute Ψ′ in a time of O ( |X |2|X| )\nProof. The algorithm, given in the full version of the paper, rests on theorem 6.\nAlgorithm 13. Given a set X, a collection of subsets {Xi : i ∈ Nk} where each Xi is in P(X), and a collection of potentials {Ψi : i ∈ Nk} where each Ψi is in T (Xi), if we have an input of {Ψ ′ i : i ∈ Nk} we can compute [ ∏k i=0[Ψi, X ] ]′ in a time of O ( 2|X| + ∑k\ni=0 2 |Xi|\n)\n.\nProof. The algorithm, given in the full version of the paper, rests on theorem 11.\nWe now turn to the problem given at the start of the paper. We first use algo-\nrithm 12 to convert each Ψi to Ψi ′, which takes a total time ofO\n(\n∑k\ni=0 |Xi|2 |Xi|\n)\n.\nWe next use algorithm 13 to compute [ ∏k i=0[Ψi, X ] ]′ , which takes a time of O ( 2|X| + ∑k\ni=0 2 |Xi|\n)\n. By theorem 8 we can then use algorithm 12 to convert [\n∏k i=0[Ψi, X ] ]′ to ∏k i=0[Ψi, X ], which takes a time of O ( |X |2|X| ) . This implies\nthe total time complexity of O ( |X |2|X| + ∑k\ni=0 |Xi|2 |Xi|\n)\n."
    } ],
    "references" : [ ],
    "referenceMentions" : [ ],
    "year" : 2017,
    "abstractText" : "Preliminaries: Given a set X we define P(X) to be the power set of X (that is, the set of subsets of X) and define |X | to be the cardinality of X (that is, the number of elements in X). A collection is a set that may contain duplicate elements (we use the subset symbol, S ⊆ X , to denote that every element in the collection S is also contained in the set X). This paper assumes we have a alebian group G who’s identity is denoted 1. Given an element a ∈ G we define a to be the inverse element of a. Given elements a, b ∈ G we define ab to be the product of a and b in G. Given a finite collection S ⊆ G we define ∏",
    "creator" : "LaTeX with hyperref package"
  }
}