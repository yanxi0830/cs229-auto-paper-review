{
  "name" : "1306.0940.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "(More) Efficient Reinforcement Learning via Posterior Sampling",
    "authors" : [ "Ian Osband", "Benjamin Van Roy" ],
    "emails" : [ "iosband@stanford.edu", "bvr@stanford.edu", "djrusso@stanford.edu" ],
    "sections" : [ {
      "heading" : null,
      "text" : "√ AT ) bound on expected regret,\nwhere T is time, τ is the episode length and S and A are the cardinalities of the state and action spaces. This bound is one of the first for an algorithm not based on optimism, and close to the state of the art for any reinforcement learning algorithm. We show through simulation that PSRL significantly outperforms existing algorithms with similar regret bounds."
    }, {
      "heading" : "1 Introduction",
      "text" : "We consider the classical reinforcement learning problem of an agent interacting with its environment while trying to maximize total reward accumulated over time [1, 2]. The agent’s environment is modeled as a Markov decision process (MDP), but the agent is uncertain about the true dynamics of the MDP. As the agent interacts with its environment, it observes the outcomes that result from previous states and actions, and learns about the system dynamics. This leads to a fundamental tradeoff: by exploring poorly-understood states and actions the agent can learn to improve future performance, but it may attain better short-run performance by exploiting its existing knowledge. Näıve optimization using point estimates for unknown variables overstates an agent’s knowledge, and can lead to premature and suboptimal exploitation. To offset this, the majority of provably efficient learning algorithms use a principle known as optimism in the face of uncertainty [3] to encourage exploration. In such an algorithm, each state and action is afforded some optimism bonus such that their value to the agent is modeled to be as high as is statistically plausible. The agent will then choose a policy that is optimal under this “optimistic” model of the environment. This incentivizes exploration since poorly-understood states and actions will receive a higher optimism bonus. As the agent resolves its uncertainty, the effect of optimism is reduced and the agent’s behavior approaches optimality. Many authors have provided strong theoretical guarantees for optimistic algorithms [4, 5, 6, 7, 8]. In fact, almost all reinforcement learning algorithms with polynomial bounds on sample complexity employ optimism to guide exploration.\nar X\niv :1\n30 6.\n09 40\nv5 [\nst at\n.M L\n] 2\n6 D\nec 2\nWe study an alternative approach to efficient exploration, posterior sampling, and provide finite time bounds on regret. We model the agent’s initial uncertainty over the environment through a prior distribution.1 At the start of each episode, the agent chooses a new policy, which it follows for the duration of the episode. Posterior sampling for reinforcement learning (PSRL) selects this policy through two simple steps. First, a single instance of the environment is sampled from the posterior distribution at the start of an episode. Then, PSRL solves for and executes the policy that is optimal under the sampled environment over the episode. PSRL randomly selects policies according to the probability they are optimal; exploration is guided by the variance of sampled policies as opposed to optimism. The idea of posterior sampling goes back to 1933 [9] and has been applied successfully to multi-armed bandits. In that literature, the algorithm is often referred to as Thompson sampling or as probability matching. Despite its long history, posterior sampling was largely neglected by the multi-armed bandit literature until empirical studies [10, 11] demonstrated that the algorithm could produce state of the art performance. This prompted a surge of interest, and a variety of strong theoretical guarantees are now available [12, 13, 14, 15]. Our results suggest this method has great potential in reinforcement learning as well. PSRL was originally introduced in the context of reinforcement learning by Strens [16] under the name “Bayesian Dynamic Programming”,2 where it appeared primarily as a heuristic method. In reference to PSRL and other “Bayesian RL” algorithms, Kolter and Ng [17] write “little is known about these algorithms from a theoretical perspective, and it is unclear, what (if any) formal guarantees can be made for such approaches.” Those Bayesian algorithms for which performance guarantees exist are guided by optimism. BOSS [18] introduces a more complicated version of PSRL that samples many MDPs, instead of just one, and then combines them into an optimistic environment to guide exploration. BEB [17] adds an exploration bonus to states and actions according to how infrequently they have been visited. We show it is not always necessary to introduce optimism via a complicated construction, and that the simple algorithm originally proposed by Strens [16] satisfies strong bounds itself. Our work is motivated by several advantages of posterior sampling relative to optimistic algorithms. First, since PSRL only requires solving for an optimal policy for a single sampled MDP, it is computationally efficient both relative to many optimistic methods, which require simultaneous optimization across a family of plausible environments [4, 5, 18], and to computationally intensive approaches that attempt to approximate the Bayes-optimal solutions directly [18, 19, 20]. Second, the presence of an explicit prior allows an agent to incorporate known environment structure in a natural way. This is crucial for most practical applications, as learning without prior knowledge requires exhaustive experimentation in each possible state. Finally, posterior sampling allows us to separate the algorithm from the analysis. In any optimistic algorithm, performance is greatly influenced by the manner in which optimism is implemented. Past works have designed algorithms, at least in part, to facilitate theoretical analysis for toy problems. Although our analysis of posterior sampling is closely related to the analysis in [4], this worst-case bound has no impact on the algorithm’s actual performance. In addition, PSRL is naturally suited to more complex settings where design of an efficiently optimistic algorithm might not be possible. We demonstrate through a computational study in Section 6 that PSRL outperforms the optimistic algorithm UCRL2 [4]: a competitor with similar regret bounds over some example MDPs."
    }, {
      "heading" : "2 Problem formulation",
      "text" : "We consider the problem of learning to optimize a random finite horizon MDP M = (S,A, RM , PM , τ, ρ) in repeated finite episodes of interaction. S is the state space, A is the action space, RMa (s) is a probability distribution over reward realized when selecting action a while in state s whose support is [0, 1], PMa (s′|s) is the probability of transitioning to state s′ if action a is selected while at state s, τ is the time horizon, and ρ the initial state distribution. We define the MDP and all other random variables we will consider with\n1For an MDP, this might be a prior over transition dynamics and reward distributions. 2We alter terminology since PSRL is neither Bayes-optimal, nor a direct approximation of this.\nrespect to a probability space (Ω,F ,P). We assume S, A, and τ are deterministic so the agent need not learn the state and action spaces or the time horizon. A deterministic policy µ is a function mapping each state s ∈ S and i = 1, . . . , τ to an action a ∈ A. For each MDP M = (S,A, RM , PM , τ, ρ) and policy µ, we define a value function\nVMµ,i(s) := EM,µ  τ∑ j=i R M aj (sj) ∣∣∣si = s  , where RMa (s) denotes the expected reward realized when action a is selected while in state s, and the subscripts of the expectation operator indicate that aj = µ(sj , j), and sj+1 ∼ PMaj (·|sj) for j = i, . . . , τ . A policy µ is said to be optimal for MDP M if V M µ,i(s) = maxµ′ VMµ′,i(s) for all s ∈ S and i = 1, . . . , τ . We will associate with each MDP M a policy µM that is optimal for M . The reinforcement learning agent interacts with the MDP over episodes that begin at times tk = (k − 1)τ + 1, k = 1, 2, . . .. At each time t, the agent selects an action at, observes a scalar reward rt, and then transitions to st+1. If an agent follows a policy µ then when in state s at time t during episode k, it selects an action at = µ(s, t − tk). Let Ht = (s1, a1, r1, . . . , st−1, at−1, rt−1) denote the history of observations made prior to time t. A reinforcement learning algorithm is a deterministic sequence {πk|k = 1, 2, . . .} of functions, each mapping Htk to a probability distribution πk(Htk ) over policies. At the start of the kth episode, the algorithm samples a policy µk from the distribution πk(Htk ). The algorithm then selects actions at = µk(st, t− tk) at times t during the kth episode. We define the regret incurred by a reinforcement learning algorithm π up to time T to be\nRegret(T, π) := dT/τe∑ k=1 ∆k,\nwhere ∆k denotes regret over the kth episode, defined with respect to the MDP M∗ by ∆k = ∑ s∈S ρ(s)(VM ∗ µ∗,1(s)− VM ∗ µk,1(s)), with µ∗ = µM∗ and µk ∼ πk(Htk ). Note that regret is not deterministic since it can depend on the random MDP M∗, the algorithm’s internal random sampling and, through the history Htk , on previous random transitions and random rewards. We will assess and compare algorithm performance in terms of regret and its expectation."
    }, {
      "heading" : "3 Posterior sampling for reinforcement learning",
      "text" : "The use of posterior sampling for reinforcement learning (PSRL) was first proposed by Strens [16]. PSRL begins with a prior distribution over MDPs with states S, actions A and horizon τ . At the start of each kth episode, PSRL samples an MDP Mk from the posterior distribution conditioned on the history Htk available at that time. PSRL then computes and follows the policy µk = µMk over episode k.\nAlgorithm: Posterior Sampling for Reinforcement Learning (PSRL)\nData: Prior distribution f , t=1 for episodes k = 1, 2, . . . do\nsample Mk ∼ f(·|Htk ) compute µk = µMk for timesteps j = 1, . . . , τ do\nsample and apply at = µk(st, j) observe rt and st+1 t = t+ 1\nend end\nWe show PSRL obeys performance guarantees intimately related to those for learning algorithms based upon OFU, as has been demonstrated for multi-armed bandit problems [15]. We believe that a posterior sampling approach offers some inherent advantages. Optimistic algorithms require explicit construction of the confidence bounds on VM∗µ,1 (s) based on observed data, which is a complicated statistical problem even for simple models. In addition, even if strong confidence bounds for VM∗µ,1 (s) were known, solving for the best optimistic policy may be computationally intractable. Algorithms such as UCRL2 [4] are computationally tractable, but must resort to separately bounding RMa (s) and PMa (s) with high probability for each s, a. These bounds allow a “worst-case” mis-estimation simultaneously in every state-action pair and consequently give rise to a confidence set which may be far too conservative. By contrast, PSRL always selects policies according to the probability they are optimal. Uncertainty about each policy is quantified in a statistically efficient way through the posterior distribution. The algorithm only requires a single sample from the posterior, which may be approximated through algorithms such as Metropolis-Hastings if no closed form exists. As such, we believe PSRL will be simpler to implement, computationally cheaper and statistically more efficient than existing optimistic methods."
    }, {
      "heading" : "3.1 Main results",
      "text" : "The following result establishes regret bounds for PSRL. The bounds have Õ(τS √ AT ) expected regret, and, to our knowledge, provide the first guarantees for an algorithm not based upon optimism: Theorem 1. If f is the distribution of M∗ then,\nE [ Regret(T, πPSτ ) ] = O ( τS √ AT log(SAT ) ) (1)\nThis result holds for any prior distribution on MDPs, and so applies to an immense class of models. To accommodate this generality, the result bounds expected regret under the prior distribution (sometimes called Bayes risk or Bayesian regret). We feel this is a natural measure of performance, but should emphasize that it is more common in the literature to bound regret under a worst-case MDP instance. The next result provides a link between these notions of regret. Applying Markov’s inequality to (1) gives convergence in probability. Corollary 1. If f is the distribution of M∗ then for any α > 12 ,\nRegret(T, πPSτ ) Tα → p 0.\nAs shown in the appendix, this also bounds the frequentist regret for any MDP with non-zero probability. State-of-the-art guarantees similar to Theorem 1 are satisfied by the algorithms UCRL2 [4] and REGAL [5] for the case of non-episodic RL. Here UCRL2 gives regret bounds Õ(DS √ AT ) where D = maxs′ 6=s minπ E[T (s′|M,π, s)] and T (s′|M,π, s) is the first time step where s′ is reached from s under the policy π. REGAL improves this result to Õ(ΨS √ AT ) where Ψ ≤ D is the span of the of the optimal value function. However, there is so far no computationally tractable implementation of this algorithm. In many practical applications we may be interested in episodic learning tasks where the constants D and Ψ could be improved to take advantage of the episode length τ . Simple modifications to both UCRL2 and REGAL will produce regret bounds of Õ(τS √ AT ), just as PSRL. This is close to the theoretical lower bounds of √ SAT -dependence."
    }, {
      "heading" : "4 True versus sampled MDP",
      "text" : "A simple observation, which is central to our analysis, is that, at the start of each kth episode, M∗ and Mk are identically distributed. This fact allows us to relate quantities that depend on the true, but unknown, MDP M∗, to those of the sampled MDP Mk, which is\nfully observed by the agent. We introduce σ(Htk ) as the σ-algebra generated by the history up to tk. Readers unfamiliar with measure theory can think of this as “all information known just before the start of period tk.” When we say that a random variable X is σ(Htk )- measurable, this intuitively means that although X is random, it is deterministically known given the information contained in Htk . The following lemma is an immediate consequence of this observation [15]. Lemma 1 (Posterior Sampling). If f is the distribution of M∗ then, for any σ(Htk )- measurable function g,\nE[g(M∗)|Htk ] = E[g(Mk)|Htk ]. (2)\nNote that taking the expectation of (2) shows E[g(M∗)] = E[g(Mk)] through the tower property. Recall, we have defined ∆k = ∑ s∈S ρ(s)(VM ∗ µ∗,1(s)−VM ∗\nµk,1(s)) to be the regret over period k. A significant hurdle in analyzing this equation is its dependence on the optimal policy µ∗, which we do not observe. For many reinforcement learning algorithms, there is no clean way to relate the unknown optimal policy to the states and actions the agent actually observes. The following result shows how we can avoid this issue using Lemma 1. First, define\n∆̃k = ∑ s∈S ρ(s)(VMkµk,1(s)− V M∗ µk,1(s)) (3)\nas the difference in expected value of the policy µk under the sampled MDP Mk, which is known, and its performance under the true MDP M∗, which is observed by the agent. Theorem 2 (Regret equivalence).\nE [ m∑ k=1 ∆k ] = E [ m∑ k=1 ∆̃k ] (4)\nand for any δ > 0 with probability at least 1− δ, Proof. Note, ∆k − ∆̃k = ∑ s∈S ρ(s)(VM ∗ µ∗,1(s) − V Mk µk,1(s)) ∈ [−τ, τ ]. By Lemma 1, E[∆k − ∆̃k|Htk ] = 0. Taking expectations of these sums therefore establishes the claim.\nThis result bounds the agent’s regret in epsiode k by the difference between the agent’s estimate VMkµk,1(stk ) of the expected reward inMk from the policy it chooses, and the expected reward VM∗µk,1(stk ) in M\n∗. If the agent has a poor estimate of the MDP M∗, we expect it to learn as the performance of following µk under M∗ differs from its expectation under Mk. As more information is gathered, its performance should improve. In the next section, we formalize these ideas and give a precise bound on the regret of posterior sampling."
    }, {
      "heading" : "5 Analysis",
      "text" : "An essential tool in our analysis will be the dynamic programming, or Bellman operator T Mµ , which for any MDP M = (S,A, RM , PM , τ, ρ), stationary policy µ : S → A and value function V : S → R, is defined by\nT Mµ V (s) := R M µ (s, µ) + ∑ s′∈S PMµ(s)(s′|s)V (s′).\nThis operation returns the expected value of state s where we follow the policy µ under the laws of M , for one time step. The following lemma gives a concise form for the dynamic programming paradigm in terms of the Bellman operator. Lemma 2 (Dynamic programming equation). For any MDP M = (S,A, RM , PM , τ, ρ) and policy µ : S × {1, . . . , τ} → A, the value functions VMµ satisfy\nVMµ,i = T Mµ(·,i)VMµ,i+1 (5)\nfor i = 1 . . . τ , with VMµ,τ+1 := 0.\nIn order to streamline our notation we will let V ∗µ,i := VM ∗ µ,i , V kµ,i(s) := V Mk µ,i (s), T kµ := T Mkµ , T ∗µ := T M ∗ µ and P ∗µ(·|s) := PM ∗ µ(s)(·|s)."
    }, {
      "heading" : "5.1 Rewriting regret in terms of Bellman error",
      "text" : "E [ ∆̃k ∣∣M∗,Mk] = E[ τ∑\ni=1\n[ (T kµk(·,i) − T ∗ µk(·,i))V k µk,i+1(stk+i) ] ∣∣∣∣M∗,Mk ]\n(6)\nTo see why (6) holds, simply apply the Dynamic programming equation inductively:\n(V kµk,1 − V ∗ µk,1)(stk+1) = (T k µk(·,1)V k µk,2 − T ∗ µk(·,1)V ∗ µk,2)(stk+1)\n= (T kµk(·,1) − T ∗ µk(·,1))V k µk,2(stk+1) + ∑ s′∈S {P ∗µk(·,1)(s ′|stk+1)(V ∗µk,2 − V k µk,2)(s ′)}\n= (T kµk(·,1) − T ∗ µk(·,1))V k µk,2(stk+1) + (V ∗ µk,2 − V k µk,2)(stk+1) + dtk+1 = . . .\n= τ∑ i=1 (T kµk(·,i) − T ∗ µk(·,i))V k µk,i+1(stk+i) + τ∑ i=1 dtk+i,\nwhere dtk+i := ∑ s′∈S{P ∗µk(·,i)(s ′|stk+i)(V ∗µk,i+1 − V k µk,i+1)(s ′)} − (V ∗µk,i+1 − V k µk,i+1)(stk+i).\nThis expresses the regret in terms two factors. The first factor is the one step Bellman error [ (T kµk(·,i) − T ∗ µk(·,i))V k µk,i+1(stk+i) ] under the sampled MDP Mk. Crucially, (6) depends only the Bellman error under the observed policy µk and the states s1, .., sT that are actually visited over the first T periods. We go on to show the posterior distribution of Mk concentrates around M∗ as these actions are sampled, and so this term tends to zero. The second term captures the randomness in the transitions of the true MDP M∗. In state st under policy µk, the expected value of (V ∗µk,i+1 − V k µk,i+1)(stk+i) is exactly∑\ns′∈S{P ∗µk(·,i)(s ′|stk+i)(V ∗µk,i+1 − V k µk,i+1)(s ′)}. Hence, conditioned on the true MDP M∗ and the sampled MDP Mk, the term ∑τ i=1 dtk+i has expectation zero."
    }, {
      "heading" : "5.2 Introducing confidence sets",
      "text" : "The last section reduced the algorithm’s regret to its expected Bellman error. We will proceed by arguing that the sampled Bellman operator T kµk(·,i) concentrates around the true Bellman operatior T ∗µk(·,i). To do this, we introduce high probability confidence sets similar to those used in [4] and [5]. Let P̂ ta(·|s) denote the emprical distribution up period t of transitions observed after sampling (s, a), and let R̂ta(s) denote the empirical average reward. Finally, define Ntk (s, a) = ∑tk−1 t=1 1{(st,at)=(s,a)} to be the number of times (s, a) was sampled prior to time tk. Define the confidence set for episode k:\nMk := { M : ∥∥∥P̂ ta(·|s)− PMa (·|s)∥∥∥1 ≤ βk(s, a) & |R̂ta(s)−RMa (s)| ≤ βk(s, a) ∀(s, a)} Where βk(s, a) := √ 14S log(2SAmtk) max{1,Ntk (s,a)} is chosen conservatively so that Mk contains both M∗ and Mk with high probability. It’s worth pointing out that we have not tried to optimize this confidence bound, and it can be improved, at least by a numerical factor, with more careful analysis. Now, using that ∆̃k ≤ τ we can decompose regret as follows:\nm∑ k=1 ∆̃k ≤ m∑ k=1 ∆̃k1{Mk,M∗∈Mk} + τ m∑ k=1 [1{Mk /∈Mk} + 1{M∗ /∈Mk}] (7)\nNow, since Mk is σ(Htk )-measureable, by Lemma 1, E[1{Mk /∈Mk}|Htk ] = E[1{M∗ /∈Mk}|Htk ]. Lemma 17 of [4] shows3 P(M∗ /∈Mk) ≤ 1/m for this choice of βk(s, a), which implies\nE [ m∑ k=1 ∆̃k ] ≤ E [ m∑ k=1 ∆̃k1{Mk,M∗∈Mk} ] + 2τ m∑ k=1 P{M∗ /∈Mk}.\n≤ E [ m∑ k=1 E [ ∆̃k|M∗,Mk ] 1{Mk,M∗∈Mk} ] + 2τ\n≤ E m∑ k=1 τ∑ i=1 |(T kµk(·,i) − T ∗ µk(·,i))V k µk,i+1(stk+i)|1{Mk,M∗∈Mk} + 2τ\n≤ τE m∑ k=1 τ∑ i=1 min{βk(stk+i, atk+i), 1}+ 2τ. (8)\nWe also have the worst–case bound ∑m k=1 ∆̃k ≤ T . In the technical appendix we go on\nto provide a worst case bound on min{τ ∑m k=1 ∑τ i=1 min{βk(stk+i, atk+i), 1}, T} of order\nτS √ AT log(SAT ), which completes our analysis."
    }, {
      "heading" : "6 Simulation results",
      "text" : "We compare performance of PSRL to UCRL2 [4]: an optimistic algorithm with similar regret bounds. We use the standard example of RiverSwim [21], as well as several randomly generated MDPs. We provide results in both the episodic case, where the state is reset every τ = 20 steps, as well as the setting without episodic reset.\nRiverSwim consists of six states arranged in a chain as shown in Figure 1. The agent begins at the far left state and at every time step has the choice to swim left or right. Swimming left (with the current) is always successful, but swimming right (against the current) often fails. The agent receives a small reward for reaching the leftmost state, but the optimal policy is to attempt to swim right and receive a much larger reward. This MDP is constructed so that efficient exploration is required in order to obtain the optimal policy. To generate the random MDPs, we sampled 10-state, 5-action environments according to the prior. We express our prior in terms of Dirichlet and normal-gamma distributions over the transitions and rewards respectively.4 In both environments we perform 20 Monte Carlo simulations and compute the total regret over 10,000 time steps. We implement UCRL2 with δ = 0.05 and optimize the algorithm to take account of finite episodes where appropriate. PSRL outperformed UCRL2 across every environment, as shown in Table 1. In Figure 2, we show regret through time across 50 Monte Carlo simulations to 100,000 time–steps in the RiverSwim environment: PSRL’s outperformance is quite extreme.\n3Our confidence sets are equivalent to those of [4] when the parameter δ = 1/m. 4These priors are conjugate to the multinomial and normal distribution. We used the values\nα = 1/S, µ = σ2 = 1 and pseudocount n = 1 for a diffuse uniform prior."
    }, {
      "heading" : "6.1 Learning in MDPs without episodic resets",
      "text" : "The majority of practical problems in reinforcement learning can be mapped to repeated episodic interactions for some length τ . Even in cases where there is no actual reset of episodes, one can show that PSRL’s regret is bounded against all policies which work over horizon τ or less [6]. Any setting with discount factor α can be learned for τ ∝ (1− α)−1. One appealing feature of UCRL2 [4] and REGAL [5] is that they learn this optimal timeframe τ . Instead of computing a new policy after a fixed number of periods, they begin a new episode when the total visits to any state-action pair is doubled. We can apply this same rule for episodes to PSRL in the ∞-horizon case, as shown in Figure 2. Using optimism with KL-divergence instead of L1 balls has also shown improved performance over UCRL2 [22], but its regret remains orders of magnitude more than PSRL on RiverSwim."
    }, {
      "heading" : "7 Conclusion",
      "text" : "We establish posterior sampling for reinforcement learning not just as a heuristic, but as a provably efficient learning algorithm. We present Õ(τS √ AT ) Bayesian regret bounds, which are some of the first for an algorithm not motivated by optimism and are close to state of the art for any reinforcement learning algorithm. These bounds hold in expectation irrespective of prior or model structure. PSRL is conceptually simple, computationally efficient and can easily incorporate prior knowledge. Compared to feasible optimistic algorithms we believe that PSRL is often more efficient statistically, simpler to implement and computationally cheaper. We demonstrate that PSRL performs well in simulation over several domains. We believe there is a strong case for the wider adoption of algorithms based upon posterior sampling in both theory and practice."
    }, {
      "heading" : "Acknowledgments",
      "text" : "Osband and Russo are supported by Stanford Graduate Fellowships courtesy of PACCAR inc., and Burt and Deedee McMurty, respectively. This work was supported in part by Award CMMI-0968707 from the National Science Foundation."
    }, {
      "heading" : "A Relating Bayesian to frequentist regret",
      "text" : "Let M be any family of MDPs with non-zero probability under the prior. Then, for any > 0, α > 12 :\nP\n( Regret(T, πPSτ ) Tα > ∣∣M∗ ∈M)→ 0\nThis provides regret bounds even if M∗ is not distributed according to f . As long as the true MDP is not impossible under the prior, we will have an asymptotic frequentist regret close to the theoretical lower bounds of in T -dependence of O( √ T ).\nProof. We have for any > 0: E[Regret(T, πPSτ )]\nTα ≥ E\n[ Regret(T, πPSτ )\nTα ∣∣M∗ ∈M]P (M∗ ∈M) ≥ P ( Regret(T, πPSτ )\nTα ∣∣M∗ ∈M)P (M∗ ∈M) Therefore via theorem (1), for any α > 12 :\nP\n( Regret(T, πPSτ )\nTα\n∣∣M∗ ∈M) ≤ ( 1 P (M∗ ∈M) ) E[Regret(T, πPSτ )] Tα → 0"
    }, {
      "heading" : "B Bounding the sum of confidence set widths",
      "text" : "We are interested in bounding min{τ ∑m\nk=1 ∑τ i=1 min{βkstk+i, atk+i), 1}, T} which we claim is\nO(τS √ AT log(SAT ) for βk(s, a) := √ 14S log(2SAmtk) max{1,Ntk (s,a)} .\nProof. In a manner similar to [4] we can say:\nm∑ k=1 τ∑ i=1 √ 14S log(2SAmtk) max{1, Ntk (s, a)} ≤ m∑ k=1 τ∑ i=1 1{Ntk≤τ} + m∑ k=1 τ∑ i=1 1{Ntk>τ} √ 14S log(2SAmtk) max{1, Ntk (s, a)}\nNow, the consider the event (st, at) = (s, a) and (Ntk (s, a) ≤ τ). This can happen fewer than 2τ times per state action pair. Therefore, ∑m k=1 ∑τ i=1 1(Ntk (s, a) ≤ τ) ≤ 2τSA.Now, suppose Ntk (s, a) > τ . Then for any t ∈ {tk, .., tk+1 − 1}, Nt(s, a) + 1 ≤ Ntk (s, a) + τ ≤ 2Ntk (s, a). Therefore:\nm∑ k=1 tk+1−1∑ t=tk √ 1(Ntk (st, at) > τ) Ntk (st, at) ≤ m∑ k=1 tk+1−1∑ t=tk √ 2 Nt(st, at) + 1 = √ 2 T∑ t=1 (Nt(st, at) + 1)−1/2\n≤ √ 2 ∑ s,a NT +1(s,a)∑ j=1 j−1/2 ≤ √ 2 ∑ s,a ∫ NT +1(s,a) x=0 x−1/2 dx\n≤ √ 2SA ∑ s,a NT+1(s, a) = √ 2SAT\nNote that since all rewards and transitions are absolutely constrained ∈ [0, 1] our regret min{τ m∑ k=1 τ∑ i=1 min{βk(stk+i, atk+i), 1}, T} ≤ min{2τ 2SA+ τ √ 28S2AT log(SAT ), T}\n≤ √ 2τ2SAT + τ √ 28S2AT log(SAT ) ≤ τS √ 30AT log(SAT )\nWhich is our required result."
    } ],
    "references" : [ {
      "title" : "Optimal adaptive policies for markov decision processes",
      "author" : [ "A.N. Burnetas", "M.N. Katehakis" ],
      "venue" : "Mathematics of Operations Research, 22(1):222–255",
      "citeRegEx" : "1",
      "shortCiteRegEx" : null,
      "year" : 1997
    }, {
      "title" : "Stochastic systems: estimation",
      "author" : [ "P.R. Kumar", "P. Varaiya" ],
      "venue" : "identification and adaptive control. Prentice-Hall, Inc.",
      "citeRegEx" : "2",
      "shortCiteRegEx" : null,
      "year" : 1986
    }, {
      "title" : "Asymptotically efficient adaptive allocation rules",
      "author" : [ "T.L. Lai", "H. Robbins" ],
      "venue" : "Advances in applied mathematics, 6(1):4–22",
      "citeRegEx" : "3",
      "shortCiteRegEx" : null,
      "year" : 1985
    }, {
      "title" : "Near-optimal regret bounds for reinforcement learning",
      "author" : [ "T. Jaksch", "R. Ortner", "P. Auer" ],
      "venue" : "The Journal of Machine Learning Research, 99:1563–1600",
      "citeRegEx" : "4",
      "shortCiteRegEx" : null,
      "year" : 2010
    }, {
      "title" : "Regal: A regularization based algorithm for reinforcement learning in weakly communicating mdps",
      "author" : [ "P.L. Bartlett", "A. Tewari" ],
      "venue" : "Proceedings of the Twenty-Fifth Conference on Uncertainty in Artificial Intelligence, pages 35–42. AUAI Press",
      "citeRegEx" : "5",
      "shortCiteRegEx" : null,
      "year" : 2009
    }, {
      "title" : "R-max-a general polynomial time algorithm for nearoptimal reinforcement learning",
      "author" : [ "R.I. Brafman", "M. Tennenholtz" ],
      "venue" : "The Journal of Machine Learning Research, 3:213–231",
      "citeRegEx" : "6",
      "shortCiteRegEx" : null,
      "year" : 2003
    }, {
      "title" : "On the sample complexity of reinforcement learning",
      "author" : [ "S.M. Kakade" ],
      "venue" : "PhD thesis, University of London",
      "citeRegEx" : "7",
      "shortCiteRegEx" : null,
      "year" : 2003
    }, {
      "title" : "Near-optimal reinforcement learning in polynomial time",
      "author" : [ "M. Kearns", "S. Singh" ],
      "venue" : "Machine Learning, 49(2-3):209–232",
      "citeRegEx" : "8",
      "shortCiteRegEx" : null,
      "year" : 2002
    }, {
      "title" : "On the likelihood that one unknown probability exceeds another in view of the evidence of two samples",
      "author" : [ "W.R. Thompson" ],
      "venue" : "Biometrika, 25(3/4):285–294",
      "citeRegEx" : "9",
      "shortCiteRegEx" : null,
      "year" : 1933
    }, {
      "title" : "An empirical evaluation of Thompson sampling",
      "author" : [ "O. Chapelle", "L. Li" ],
      "venue" : "Neural Information Processing Systems (NIPS)",
      "citeRegEx" : "10",
      "shortCiteRegEx" : null,
      "year" : 2011
    }, {
      "title" : "A modern Bayesian look at the multi-armed bandit",
      "author" : [ "S.L. Scott" ],
      "venue" : "Applied Stochastic Models in Business and Industry, 26(6):639–658",
      "citeRegEx" : "11",
      "shortCiteRegEx" : null,
      "year" : 2010
    }, {
      "title" : "Further optimal regret bounds for Thompson sampling",
      "author" : [ "S. Agrawal", "N. Goyal" ],
      "venue" : "arXiv preprint arXiv:1209.3353",
      "citeRegEx" : "12",
      "shortCiteRegEx" : null,
      "year" : 2012
    }, {
      "title" : "Thompson sampling for contextual bandits with linear payoffs",
      "author" : [ "S. Agrawal", "N. Goyal" ],
      "venue" : "arXiv preprint arXiv:1209.3352",
      "citeRegEx" : "13",
      "shortCiteRegEx" : null,
      "year" : 2012
    }, {
      "title" : "Thompson sampling: an asymptotically optimal finite time analysis",
      "author" : [ "E. Kauffmann", "N. Korda", "R. Munos" ],
      "venue" : "International Conference on Algorithmic Learning Theory",
      "citeRegEx" : "14",
      "shortCiteRegEx" : null,
      "year" : 2012
    }, {
      "title" : "Learning to optimize via posterior sampling",
      "author" : [ "D. Russo", "B. Van Roy" ],
      "venue" : "CoRR, abs/1301.2609",
      "citeRegEx" : "15",
      "shortCiteRegEx" : null,
      "year" : 2013
    }, {
      "title" : "A Bayesian framework for reinforcement learning",
      "author" : [ "M. Strens" ],
      "venue" : "Proceedings of the 17th International Conference on Machine Learning, pages 943–950",
      "citeRegEx" : "16",
      "shortCiteRegEx" : null,
      "year" : 2000
    }, {
      "title" : "Near-Bayesian exploration in polynomial time",
      "author" : [ "J.Z. Kolter", "A.Y. Ng" ],
      "venue" : "Proceedings of the 26th Annual International Conference on Machine Learning, pages 513–520. ACM",
      "citeRegEx" : "17",
      "shortCiteRegEx" : null,
      "year" : 2009
    }, {
      "title" : "Bayesian sparse sampling for on-line reward optimization",
      "author" : [ "T. Wang", "D. Lizotte", "M. Bowling", "D. Schuurmans" ],
      "venue" : "Proceedings of the 22nd international conference on Machine learning, pages 956–963. ACM",
      "citeRegEx" : "18",
      "shortCiteRegEx" : null,
      "year" : 2005
    }, {
      "title" : "Efficient bayes-adaptive reinforcement learning using samplebased search",
      "author" : [ "A. Guez", "D. Silver", "P. Dayan" ],
      "venue" : "arXiv preprint arXiv:1205.3109",
      "citeRegEx" : "19",
      "shortCiteRegEx" : null,
      "year" : 2012
    }, {
      "title" : "Approaching bayes-optimalilty using monte-carlo tree search",
      "author" : [ "J. Asmuth", "M.L. Littman" ],
      "venue" : "Proc. 21st Int. Conf. Automat. Plan. Sched., Freiburg, Germany",
      "citeRegEx" : "20",
      "shortCiteRegEx" : null,
      "year" : 2011
    }, {
      "title" : "An analysis of model-based interval estimation for markov decision processes",
      "author" : [ "A.L. Strehl", "M.L. Littman" ],
      "venue" : "Journal of Computer and System Sciences, 74(8):1309–1331",
      "citeRegEx" : "21",
      "shortCiteRegEx" : null,
      "year" : 2008
    }, {
      "title" : "Optimism in reinforcement learning based on kullbackleibler divergence",
      "author" : [ "S. Filippi", "O. Cappé", "A. Garivier" ],
      "venue" : "CoRR, abs/1004.5229",
      "citeRegEx" : "22",
      "shortCiteRegEx" : null,
      "year" : 2010
    } ],
    "referenceMentions" : [ {
      "referenceID" : 0,
      "context" : "We consider the classical reinforcement learning problem of an agent interacting with its environment while trying to maximize total reward accumulated over time [1, 2].",
      "startOffset" : 162,
      "endOffset" : 168
    }, {
      "referenceID" : 1,
      "context" : "We consider the classical reinforcement learning problem of an agent interacting with its environment while trying to maximize total reward accumulated over time [1, 2].",
      "startOffset" : 162,
      "endOffset" : 168
    }, {
      "referenceID" : 2,
      "context" : "To offset this, the majority of provably efficient learning algorithms use a principle known as optimism in the face of uncertainty [3] to encourage exploration.",
      "startOffset" : 132,
      "endOffset" : 135
    }, {
      "referenceID" : 3,
      "context" : "Many authors have provided strong theoretical guarantees for optimistic algorithms [4, 5, 6, 7, 8].",
      "startOffset" : 83,
      "endOffset" : 98
    }, {
      "referenceID" : 4,
      "context" : "Many authors have provided strong theoretical guarantees for optimistic algorithms [4, 5, 6, 7, 8].",
      "startOffset" : 83,
      "endOffset" : 98
    }, {
      "referenceID" : 5,
      "context" : "Many authors have provided strong theoretical guarantees for optimistic algorithms [4, 5, 6, 7, 8].",
      "startOffset" : 83,
      "endOffset" : 98
    }, {
      "referenceID" : 6,
      "context" : "Many authors have provided strong theoretical guarantees for optimistic algorithms [4, 5, 6, 7, 8].",
      "startOffset" : 83,
      "endOffset" : 98
    }, {
      "referenceID" : 7,
      "context" : "Many authors have provided strong theoretical guarantees for optimistic algorithms [4, 5, 6, 7, 8].",
      "startOffset" : 83,
      "endOffset" : 98
    }, {
      "referenceID" : 8,
      "context" : "The idea of posterior sampling goes back to 1933 [9] and has been applied successfully to multi-armed bandits.",
      "startOffset" : 49,
      "endOffset" : 52
    }, {
      "referenceID" : 9,
      "context" : "Despite its long history, posterior sampling was largely neglected by the multi-armed bandit literature until empirical studies [10, 11] demonstrated that the algorithm could produce state of the art performance.",
      "startOffset" : 128,
      "endOffset" : 136
    }, {
      "referenceID" : 10,
      "context" : "Despite its long history, posterior sampling was largely neglected by the multi-armed bandit literature until empirical studies [10, 11] demonstrated that the algorithm could produce state of the art performance.",
      "startOffset" : 128,
      "endOffset" : 136
    }, {
      "referenceID" : 11,
      "context" : "This prompted a surge of interest, and a variety of strong theoretical guarantees are now available [12, 13, 14, 15].",
      "startOffset" : 100,
      "endOffset" : 116
    }, {
      "referenceID" : 12,
      "context" : "This prompted a surge of interest, and a variety of strong theoretical guarantees are now available [12, 13, 14, 15].",
      "startOffset" : 100,
      "endOffset" : 116
    }, {
      "referenceID" : 13,
      "context" : "This prompted a surge of interest, and a variety of strong theoretical guarantees are now available [12, 13, 14, 15].",
      "startOffset" : 100,
      "endOffset" : 116
    }, {
      "referenceID" : 14,
      "context" : "This prompted a surge of interest, and a variety of strong theoretical guarantees are now available [12, 13, 14, 15].",
      "startOffset" : 100,
      "endOffset" : 116
    }, {
      "referenceID" : 15,
      "context" : "PSRL was originally introduced in the context of reinforcement learning by Strens [16] under the name “Bayesian Dynamic Programming”,2 where it appeared primarily as a heuristic method.",
      "startOffset" : 82,
      "endOffset" : 86
    }, {
      "referenceID" : 16,
      "context" : "In reference to PSRL and other “Bayesian RL” algorithms, Kolter and Ng [17] write “little is known about these algorithms from a theoretical perspective, and it is unclear, what (if any) formal guarantees can be made for such approaches.",
      "startOffset" : 71,
      "endOffset" : 75
    }, {
      "referenceID" : 17,
      "context" : "BOSS [18] introduces a more complicated version of PSRL that samples many MDPs, instead of just one, and then combines them into an optimistic environment to guide exploration.",
      "startOffset" : 5,
      "endOffset" : 9
    }, {
      "referenceID" : 16,
      "context" : "BEB [17] adds an exploration bonus to states and actions according to how infrequently they have been visited.",
      "startOffset" : 4,
      "endOffset" : 8
    }, {
      "referenceID" : 15,
      "context" : "We show it is not always necessary to introduce optimism via a complicated construction, and that the simple algorithm originally proposed by Strens [16] satisfies strong bounds itself.",
      "startOffset" : 149,
      "endOffset" : 153
    }, {
      "referenceID" : 3,
      "context" : "First, since PSRL only requires solving for an optimal policy for a single sampled MDP, it is computationally efficient both relative to many optimistic methods, which require simultaneous optimization across a family of plausible environments [4, 5, 18], and to computationally intensive approaches that attempt to approximate the Bayes-optimal solutions directly [18, 19, 20].",
      "startOffset" : 244,
      "endOffset" : 254
    }, {
      "referenceID" : 4,
      "context" : "First, since PSRL only requires solving for an optimal policy for a single sampled MDP, it is computationally efficient both relative to many optimistic methods, which require simultaneous optimization across a family of plausible environments [4, 5, 18], and to computationally intensive approaches that attempt to approximate the Bayes-optimal solutions directly [18, 19, 20].",
      "startOffset" : 244,
      "endOffset" : 254
    }, {
      "referenceID" : 17,
      "context" : "First, since PSRL only requires solving for an optimal policy for a single sampled MDP, it is computationally efficient both relative to many optimistic methods, which require simultaneous optimization across a family of plausible environments [4, 5, 18], and to computationally intensive approaches that attempt to approximate the Bayes-optimal solutions directly [18, 19, 20].",
      "startOffset" : 244,
      "endOffset" : 254
    }, {
      "referenceID" : 17,
      "context" : "First, since PSRL only requires solving for an optimal policy for a single sampled MDP, it is computationally efficient both relative to many optimistic methods, which require simultaneous optimization across a family of plausible environments [4, 5, 18], and to computationally intensive approaches that attempt to approximate the Bayes-optimal solutions directly [18, 19, 20].",
      "startOffset" : 365,
      "endOffset" : 377
    }, {
      "referenceID" : 18,
      "context" : "First, since PSRL only requires solving for an optimal policy for a single sampled MDP, it is computationally efficient both relative to many optimistic methods, which require simultaneous optimization across a family of plausible environments [4, 5, 18], and to computationally intensive approaches that attempt to approximate the Bayes-optimal solutions directly [18, 19, 20].",
      "startOffset" : 365,
      "endOffset" : 377
    }, {
      "referenceID" : 19,
      "context" : "First, since PSRL only requires solving for an optimal policy for a single sampled MDP, it is computationally efficient both relative to many optimistic methods, which require simultaneous optimization across a family of plausible environments [4, 5, 18], and to computationally intensive approaches that attempt to approximate the Bayes-optimal solutions directly [18, 19, 20].",
      "startOffset" : 365,
      "endOffset" : 377
    }, {
      "referenceID" : 3,
      "context" : "Although our analysis of posterior sampling is closely related to the analysis in [4], this worst-case bound has no impact on the algorithm’s actual performance.",
      "startOffset" : 82,
      "endOffset" : 85
    }, {
      "referenceID" : 3,
      "context" : "We demonstrate through a computational study in Section 6 that PSRL outperforms the optimistic algorithm UCRL2 [4]: a competitor with similar regret bounds over some example MDPs.",
      "startOffset" : 111,
      "endOffset" : 114
    }, {
      "referenceID" : 0,
      "context" : "S is the state space, A is the action space, R a (s) is a probability distribution over reward realized when selecting action a while in state s whose support is [0, 1], P a (s′|s) is the probability of transitioning to state s′ if action a is selected while at state s, τ is the time horizon, and ρ the initial state distribution.",
      "startOffset" : 162,
      "endOffset" : 168
    }, {
      "referenceID" : 15,
      "context" : "3 Posterior sampling for reinforcement learning The use of posterior sampling for reinforcement learning (PSRL) was first proposed by Strens [16].",
      "startOffset" : 141,
      "endOffset" : 145
    }, {
      "referenceID" : 14,
      "context" : "We show PSRL obeys performance guarantees intimately related to those for learning algorithms based upon OFU, as has been demonstrated for multi-armed bandit problems [15].",
      "startOffset" : 167,
      "endOffset" : 171
    }, {
      "referenceID" : 3,
      "context" : "Algorithms such as UCRL2 [4] are computationally tractable, but must resort to separately bounding RMa (s) and P a (s) with high probability for each s, a.",
      "startOffset" : 25,
      "endOffset" : 28
    }, {
      "referenceID" : 3,
      "context" : "State-of-the-art guarantees similar to Theorem 1 are satisfied by the algorithms UCRL2 [4] and REGAL [5] for the case of non-episodic RL.",
      "startOffset" : 87,
      "endOffset" : 90
    }, {
      "referenceID" : 4,
      "context" : "State-of-the-art guarantees similar to Theorem 1 are satisfied by the algorithms UCRL2 [4] and REGAL [5] for the case of non-episodic RL.",
      "startOffset" : 101,
      "endOffset" : 104
    }, {
      "referenceID" : 14,
      "context" : "The following lemma is an immediate consequence of this observation [15].",
      "startOffset" : 68,
      "endOffset" : 72
    }, {
      "referenceID" : 3,
      "context" : "To do this, we introduce high probability confidence sets similar to those used in [4] and [5].",
      "startOffset" : 83,
      "endOffset" : 86
    }, {
      "referenceID" : 4,
      "context" : "To do this, we introduce high probability confidence sets similar to those used in [4] and [5].",
      "startOffset" : 91,
      "endOffset" : 94
    }, {
      "referenceID" : 3,
      "context" : "Lemma 17 of [4] shows3 P(M∗ / ∈Mk) ≤ 1/m for this choice of βk(s, a), which implies",
      "startOffset" : 12,
      "endOffset" : 15
    }, {
      "referenceID" : 3,
      "context" : "We compare performance of PSRL to UCRL2 [4]: an optimistic algorithm with similar regret bounds.",
      "startOffset" : 40,
      "endOffset" : 43
    }, {
      "referenceID" : 20,
      "context" : "We use the standard example of RiverSwim [21], as well as several randomly generated MDPs.",
      "startOffset" : 41,
      "endOffset" : 45
    }, {
      "referenceID" : 3,
      "context" : "3Our confidence sets are equivalent to those of [4] when the parameter δ = 1/m.",
      "startOffset" : 48,
      "endOffset" : 51
    }, {
      "referenceID" : 5,
      "context" : "Even in cases where there is no actual reset of episodes, one can show that PSRL’s regret is bounded against all policies which work over horizon τ or less [6].",
      "startOffset" : 156,
      "endOffset" : 159
    }, {
      "referenceID" : 3,
      "context" : "One appealing feature of UCRL2 [4] and REGAL [5] is that they learn this optimal timeframe τ .",
      "startOffset" : 31,
      "endOffset" : 34
    }, {
      "referenceID" : 4,
      "context" : "One appealing feature of UCRL2 [4] and REGAL [5] is that they learn this optimal timeframe τ .",
      "startOffset" : 45,
      "endOffset" : 48
    }, {
      "referenceID" : 21,
      "context" : "Using optimism with KL-divergence instead of L1 balls has also shown improved performance over UCRL2 [22], but its regret remains orders of magnitude more than PSRL on RiverSwim.",
      "startOffset" : 101,
      "endOffset" : 105
    } ],
    "year" : 2013,
    "abstractText" : "Most provably-efficient reinforcement learning algorithms introduce optimism about poorly-understood states and actions to encourage exploration. We study an alternative approach for efficient exploration: posterior sampling for reinforcement learning (PSRL). This algorithm proceeds in repeated episodes of known duration. At the start of each episode, PSRL updates a prior distribution over Markov decision processes and takes one sample from this posterior. PSRL then follows the policy that is optimal for this sample during the episode. The algorithm is conceptually simple, computationally efficient and allows an agent to encode prior knowledge in a natural way. We establish an Õ(τS √ AT ) bound on expected regret, where T is time, τ is the episode length and S and A are the cardinalities of the state and action spaces. This bound is one of the first for an algorithm not based on optimism, and close to the state of the art for any reinforcement learning algorithm. We show through simulation that PSRL significantly outperforms existing algorithms with similar regret bounds.",
    "creator" : "LaTeX with hyperref package"
  }
}