{
  "name" : "1105.4272.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "Calibration with Changing Checking Rules and Its Application to Short-Term Trading",
    "authors" : [ "Vladimir Trunov" ],
    "emails" : [ "vyugin@iitp.ru" ],
    "sections" : [ {
      "heading" : "1 Introduction",
      "text" : "Predicting sequences is the key problem of machine learning and statistics. The learning process proceeds as follows: observing a finite-state sequence given online a forecaster assigns an subjective estimate to future states. The method of evaluation of these forecasts depends on an underlying learning approach.\nA minimal requirement for testing any prediction algorithm is that it should be calibrated (see Dawid [3]). Dawid gave an informal explanation of calibration for binary outcomes as follows. Let a binary sequence ω1, ω2, . . . , ωn−1 of outcomes be observed by a forecaster whose task is to give a probability pn of a future event ωn = 1. In a typical example, pn is interpreted as a probability that it will rain. Forecaster is said to be well-calibrated if it rains as often as he leads us to expect. It should rain about 80% of the days for which pn = 0.8, and so on.\nA more precise definition is as follows. Let I(p) denote the characteristic function of a subinterval I ⊆ [0, 1], i.e., I(p) = 1 if p ∈ I, and I(p) = 0, otherwise. An infinite sequence of forecasts p1, p2, . . . is calibrated for an infinite binary sequence of outcomes ω1ω2 . . . if for characteristic function I(p) of any subinterval of [0, 1] the calibration error tends to zero, i.e.,∑n\ni=1 I(pi)(ωi − pi)∑n i=1 I(pi) → 0\nas the denominator of the relation (1) tends to infinity. The indicator function I(pi) determines some “checking rule” which selects indices i where we compute the deviation between forecasts pi and outcomes ωi.\nar X\niv :1\n10 5.\n42 72\nv1 [\ncs .L\nG ]\n2 1\nM ay\nIf the weather acts adversatively, then Oakes [8] and Dawid [4] show that any deterministic forecasting algorithm will not always be calibrated.\nFoster and Vohra [5] show that calibration is almost surely guaranteed with a randomizing forecasting rule, i.e., where the forecasts pi are chosen using internal randomization and the forecasts are hidden from the weather until weather makes its decision whether to rain or not.\nThe origin of calibration algorithm is the Blackwell’s [1] approachability theorem but, as its drawback, the forecaster has to use linear programming to compute the forecasts. We modify a more computationally efficient method from Kakade and Foster [7], where “an almost deterministic” randomized rounding universal forecasting algorithm is presented. For any sequence of outcomes and for any precision of rounding ∆ > 0, an observer can simply randomly round the deterministic forecast pi up to ∆ in order to calibrate for this sequence with probability one :\nlim sup n→∞\n1\nn n∑ i=1 I(p̃i)(ωi − p̃i) ≤ ∆, (1)\nwhere p̃i is a random forecast. This algorithm can be easily extended such that the calibration error tends to zero as n→∞.\nThe goal of this paper is to extend Kakade and Foster’s algorithm to arbitrary real valued outcomes and to a more general notion of calibration with changing parameterized checking rules. We present also convergence bounds for calibration depending on the number of parameters.\nA closely related approach for weak calibration is presented in Vovk [10]. We apply this algorithm to technical analysis in finance. We consider real valued outcomes (for example, prices of a stock). In this case, predictions could be interpreted as mean values of future outcomes under some unknown for us probability distributions. We need not any form of such distribution – we should predict only future means.\nWe provide a natural learning process in which a financial trader (speculator for a rise or for a decline) without a risk of complete ruin receives a gain if the market is inefficient. In this process, the trader rationally choose his gambles using a prediction made by a randomized calibrated algorithm.\nThe learning process is the most traditional one. At each step Forecaster makes a prediction of future price of a stock and Speculator takes the best response to this prediction. He chooses a strategy: dealing for a rise or for a fall, or pass the step. Forecaster uses some randomized algorithm for computing calibrated forecasts.\nLet us give a more precise formulation. Consider a game between Speculator and Stock Market. Let S1, S2, . . . – be a sequence of prices of a stock. We suppose that prices are bounded and rescaled such that 0 ≤ Si ≤ 1 for all t and S1 = S0.\nThe protocol of a game is described as follows. Let k is a positive integer number. The initial capital of Speculator is K0 = 0. FOR i = 1, 2 . . . At the beginning of the step i Speculator and Forecaster observe past prices\nS1, . . . , Si−1 of a financial instrument (a stock) and some side information. Forecaster announces a random forecast of a stock future price – random variable p̃i ∈ [0, 1]. Speculator bets by buying or selling a number Mi of shares of the stock by Si−1 each. 1 Stock Market announces a price Si of a stock. Speculator receives his total gain (or suffer loss) at the end of step i : Ki = Ki−1 +Mi(Si − Si−1). ENDFOR\nIn that follows we consider only playing for a rise and will buy only one share of a stock, so Mi = 0 or Mi = 1.\nLet > 0 be a threshold for entering the game. A decision rule for entering will be the following: at step i enter the game (buy Mi = 1 of shares) if p̃i > S̃i−1 + ; pass the step otherwise (get Mi = 0), where S̃i−1 is randomized past price. Thereby, we need changing checking rules depending on past outcomes :\nI(pi > Si−1 + ) = { 1, if pi > Si−1 + , 0, otherwise.\nIt will follow from Theorem 1 (Section 2) that there exists a randomized algorithm computing forecasts calibrated almost surely in a modified sense :\nlim n→∞\n1\nn n∑ i=1 I(p̃i > S̃i−1 + )(Si − p̃i) = 0,\nwhere p̃i is a random forecast, S̃i−1 is a randomized past price of a stock, and > 0 is a threshold for entering a game.\nIn Section 3 we construct trading strategies based on calibrated forecasts."
    }, {
      "heading" : "2 Computing calibrated forecasts",
      "text" : "Let y1, y2, . . . be an infinite sequence of real numbers. An infinite sequence of random variables ỹ1, ỹ2, . . . is called a randomization of y1, y2, . . . if En(ỹn) = yn for all n, where En is the symbol of mathematical expectation.\nWe specify a side information – we add to the protocol of the game signals x̄1, x̄2, . . . given online: for any n, a k-dimensional vector x̄n ∈ [0, 1]k is given to Forecaster before he announces a forecast p̃n. We consider checking rules of general type:\nI(p, x̄) = { 1, (p, x̄) ∈ S, 0, otherwise,\nwhere S ⊆ [0, 1]k+1 and x̄ ∈ [0, 1]k is a signal. In Section 3 we use a set S = {(p, x) : p > x + }, where p, x ∈ [0, 1] and > 0. At any step i we check (p̃i, x̃i) ∈ S, where xi = Si−1 and p̃i, x̃i are randomization of pi, xi. 1 In case Mi > 0 Speculator playing for a rise, in case Mi < 0 Speculator playing for\na fall, Speculator pass the step if Mi = 0. We suppose that Speculator can borrow money for buying Mi shares of a stock and return them after selling.\nThe following theorem on calibration is the main tool for technical analysis presented in Section 3.\nTheorem 1. Given k an algorithm f for computing forecasts and a method of randomization can be constructed such that for any sequence of real numbers S1, S2, . . . and for any sequence of k-dimensional signals x̄1, x̄2, . . . the event\nlim n→∞\n1\nn n∑ i=1 I(p̃i, x̃i)(Si − p̃i) = 0, (2)\nhas Pr-probability 1, where Pr is a probability distribution generated by a sequence of tuples (p̃i, x̃i) of random variables, i = 1, 2, . . ., and I is the characteristic function of an arbitrary subset S ⊆ [0, 1]k+1. Here p̃i is the randomization of a forecast pi computed by the forecasting algorithm f and x̃i is obtained by independent randomization of each coordinate xi,j of the vector x̄i, j = 1, . . . k. Also Varn(p̃n)→ 0 and Varn(x̃i,j)→ 0 as to n→∞ for all i and j. 2\nProof. We modify a weak calibration algorithm of Kakade and Foster [7] using also ideas from Vovk [10].\nAt first, we construct an ∆-calibrated forecasting algorithm, and after that we apply some double trick argument for it.\nLemma 1. Given k an algorithm for computing forecasts and a method of randomization can be constructed such that for any sequence of real numbers S1, S2, . . . and for any sequence of signals x̄1, x̄2, . . . the event\nlim sup n→∞\n1\nn n∑ i=1 I(p̃i, x̃i)(Si − p̃i) ≤ ∆\nhas Pr-probability 1, where Pr and I as in Theorem 1. Also Varn(p̃n) ≤ ∆ and Varn(x̃i,j) ≤ ∆ for all n, for all i and j. Proof. At first we define a deterministic forecast and after that we randomize it.\nDivide the interval [0, 1] on subintervals of length ∆ = 1/K with rational endpoints vi = i∆, where i = 0, 1, . . . ,K. Let V denotes the set of these points.\nAny number p ∈ [0, 1] can be represented as a linear combination of two neighboring endpoints of V defining subinterval containing p : p = ∑ v∈V wv(p)v = wvi−1(p)vi−1 +wvi(p)vi, where p ∈ [vi−1, vi], i = bp1/∆+1c, wvi−1(p) = 1− (p− vi−1)/∆, and wvi(p) = 1− (vi − p)/∆. Define wv(p) = 0 for all other v ∈ V .\nIn that follows we round some deterministic forecast pn to vi−1 with probability wvi−1(pn) and to vi with probability wvi(pn). We also round the each coordinate xn,s, s = 1, . . . k, of a signal x̄n to vjs−1 with probability wvjs−1(xn,s) and to vjs with probability wvjs (xn,s), where xn,s ∈ [vjs−1, vjs ].\nLet also Wv(Qn) = wv1(pn)wv2(x̄n), where v = (v 1, v2), v1 ∈ V , v2 =\n(v21 , . . . v 2 k) ∈ V k, wv2(x̄n) = ∏k s=1 wv2s (xn,s), and Qn = (pn, x̄n). For any Qn, Wv(Qn) is a probability distribution in V k+1 :\n∑ v∈V k+1 Wv(Qn) = 1.\n2 Varn(p̃n) = En(p̃n − pn)2.\nIn that follows we define a deterministic forecast pn. Let the forecasts p1, . . . , pn−1 already defined (put p1 = 1/2). Let us define for v = (v 1, v2) and Qi = (pi, x̄i)\nµn−1(v) = n−1∑ i=1 Wv(Qi)(Si − pi).\nWe have\n(µn(v)) 2 = (µn−1(v)) 2 +\n+2Wv(Qn)µn−1(v)(Sn − pn) + (Wv(Qn))2(Sn − p1n)2. (3)\nSumming (3) by v ∈ V k+1, we obtain:∑ v∈V k+1 (µn(v)) 2 = ∑ v∈V k+1 (µn−1(v)) 2 +\n+2(Sn − pn) ∑\nv∈V k+1 Wv(Qn)µn−1(v) + ∑ v∈V k+1 (Wv(Qn)) 2(Sn − pn)2. (4)\nChange the order of summation:\n∑ v∈V k+1 Wv(Qn)µn−1(v) = ∑ v∈V k+1 Wv(Qn) n−1∑ i=1 Wv(Qi)(Si − pi) =\n= n−1∑ i=1 ( ∑ v∈V k+1 Wv(Qn)Wv(Qi))(Si − pi) =\n= n−1∑ i=1 (W̄ (Qn) · W̄ (Qi))(Si − pi) = n−1∑ i=1 K(Qn, Qi)(Si − pi),\nwhere W̄ (Qn) = (Wv(Qn) : v ∈ V k+1), W̄ (Qn) = (Wv(Qn) : v ∈ V k+1) be vectors of probabilities of rounding. The dot product of corresponding vectors defines the kernel\nK(Qn, Qi) = K(pn, x̄n, pi, x̄i) = (W̄ (Qn) · W̄ (Qi)). (5)\nLet pn be equal to the root of the equation\nSn(pn) = ∑ v∈V Wv(pn, x̄n)µn−1(v) = n−1∑ i=1 K(pn, x̄n, pi, x̄i)(Si − pi) = 0, (6)\nif a solution exists. Otherwise, if the left hand-side of the equation (6) (which is a continuous by pn function) strictly positive for all pn define pn = 1, define pn = 0 if it is strictly negative. Announce pn as a deterministic forecast.\nThe third term of (4) is upper bounded by 1. Indeed, since |Si − pi| ≤ 1 for all i, ∑\nv∈V k+1 (Wv(Qn))\n2(Si − pn)2 ≤ ∑\nv∈V k+1 Wv(Qn) = 1.\nThen by (4), ∑\nv∈V k+1 (µn(v))\n2 ≤ n. Recall that for any v ∈ V k+1\nµn(v) = n∑ i=1 Wv(Qi)(Si − pi). (7)\nInsert the term I(v) in the sum (7), where I is the characteristic function of an arbitrary set S ⊆ [0, 1]k+1, sum by v ∈ V k+1, and exchange the order of summation. Using Cauchy–Schwartz inequality for vectors (I(v) : v ∈ V k+1), (µn(v) : v ∈ V k+1) and Euclidian norm, we obtain∣∣∣∣∣∣ n∑ i=1 ∑ v∈V k+1 Wv(Qi)I(v)(Si − pi)\n∣∣∣∣∣∣ = = ∣∣∣∣∣∣ ∑ v∈V k+1 I(v) n∑ i=1 Wv(Qi)(Si − pi)\n∣∣∣∣∣∣ ≤ ≤ √ ∑ v∈V k+1 I(v) √ ∑ v∈V k+1 (µn(v))2 ≤ √ |V k+1|n (8)\nfor all n, where |V k+1| = 1/∆k+1 – is the cardinality of the partition. Let p̃i be a random variable taking values v ∈ V with probabilities wv(pi) (only two of them are nonzero). Recall that x̃i is a random variable taking values v ∈ V k with probabilities wv(x̄i).\nLet S ⊆ [0, 1]k and I be its indicator function. For any i the mathematical expectation of a random variable I(p̃i, x̃i)(Si − p̃i) is equal to\nE(I(p̃i, x̃i)(Si − p̃i)) = ∑\nv∈V k+1 Wv(Qi)I(v)(Si − v1), (9)\nwhere v = (v1, v2). By the strong law of large numbers, for some µn = o(n) (as n → ∞), Prprobability of the event∣∣∣∣∣ n∑ i=1 I(p̃i, x̃i)(Si − p̃i)− n∑ i=1 E(I(p̃i, x̃i)(Si − p̃i))\n∣∣∣∣∣ ≤ µn (10) tends to 1 as n→∞. A form of of µn will be specified later.\nBy definition of deterministic forecast∣∣∣∣∣∣ ∑ v∈V k+1 Wv(Qi)I(v)(Si − pi)− ∑ v∈V k+1 Wv(Qi)I(v)(Si − v1) ∣∣∣∣∣∣ < ∆ for all i, where v = (v1, v2). Summing (9) by i = 1, . . . , n and using the inequality (8), we obtain ∣∣∣∣∣ n∑ i=1 E(I(p̃i, x̃i)(Si − p̃i)) ∣∣∣∣∣ =\n= ∣∣∣∣∣∣ n∑ i=1 ∑ v∈V k+1 Wv(Qi)I(v)(Si − v1) ∣∣∣∣∣∣ < ∆n+ √ |V k+1|n (11)\nfor all n, where |V k+1| = 1/∆k+1 is the cardinality of the partition. By (11) and (10) we obtain that Pr-probability of the event∣∣∣∣∣ n∑ i=1 I(p̃i, x̃i)(Si − p̃i) ∣∣∣∣∣ ≤ ∆n+ µn + √ n/∆k+1 (12)\ntends to 1 as n→∞. In particular, Pr-probability of the event\nlim sup n→∞ ∣∣∣∣∣ 1n n∑ i=1 I(p̃i, x̃i)(Si − p̃i) ∣∣∣∣∣ ≤ ∆ is equal to 1. Lemma is proved.\nTo prove that (2) holds almost surely choose a monotonic sequence of rational numbers ∆1 > ∆2 > . . . such that ∆s → 0 as s → ∞. We also define an increasing sequence of natural numbers n1 < n2 < . . . For any s, we use on steps ns ≤ n < ns+1 the partition of [0, 1] on subintervals of length ∆s.\nWe choose ns such that ns ≥ ( k+2 2 )2 ∆ −(k+3) s for all s. 3 Put n0 = 0 and\n∆0 = 1. Also, define the numbers n1, n2, . . . such that the inequality∣∣∣∣∣ n∑ i=1 E(I(p̃i, x̃i)(Si − p̃i)) ∣∣∣∣∣ ≤ 4(s+ 1)∆sn (13) holds for all ns ≤ n ≤ ns+1 and for all s.\nWe define this sequence by mathematical induction on s. Suppose that ns (s ≥ 1) is defined such that the inequality∣∣∣∣∣ n∑ i=1 E(I(p̃i, x̃i)(Si − p̃i))\n∣∣∣∣∣ ≤ 4s∆s−1n (14) holds for all ns−1 ≤ n ≤ ns, and the inequality∣∣∣∣∣ ns∑ i=1 E(I(p̃i, x̃i)(Si − p̃i))\n∣∣∣∣∣ ≤ 4s∆sns (15) also holds. Let us define ns+1. Consider all forecasts p̃i defined by the algorithm given above for discretization ∆ = ∆s+1. We do not use first ns of these forecasts (more correctly we will use them only in bounds (16) and (17); denote these forecasts p̂1, . . . , p̂ns). We add the forecasts p̃i for i > ns to the forecasts defined\n3 This is the minimum point of (11).\nbefore this step of induction (for ns). Let ns+1 be such that the inequality∣∣∣∣∣ ns+1∑ i=1 E(I(p̃i, x̃i)(Si − p̃i)) ∣∣∣∣∣ ≤ ∣∣∣∣∣ ns∑ i=1 E(I(p̃i, x̃i)(Si − p̃i)) ∣∣∣∣∣+ +\n∣∣∣∣∣ ns+1∑ i=ns+1 E(I(p̃i, x̃i)(Si − p̃i)) + ns∑ i=1 E(I(p̂i, x̃i)(Si − p̂i)) ∣∣∣∣∣+ +\n∣∣∣∣∣ ns∑ i=1 E(I(p̂i, x̃i)(Si − p̂i)) ∣∣∣∣∣ ≤ 4(s+ 1)∆s+1ns+1 (16) holds. Here the first sum of the right-hand side of the inequality (16) is bounded by 4s∆sns – by the induction hypothesis (15). The second and third sums are bounded by 2∆s+1ns+1 and by 2∆s+1ns, respectively. This follows from (11) and by choice of ns. The induction hypothesis (15) is valid for\nns+1 ≥ 2s∆s +∆s+1 ∆s+1(2s+ 1) ns.\nAnalogously,∣∣∣∣∣ n∑ i=1 E(I(p̃i, x̃i)(Si − p̃i)) ∣∣∣∣∣ ≤ ∣∣∣∣∣ ns∑ i=1 E(I(p̃i, x̃i)(Si − p̃i)) ∣∣∣∣∣+ + ∣∣∣∣∣ n∑\ni=ns+1\nE(I(p̃i, x̃i)(Si − p̃i)) + ns∑ i=1 E(I(p̂i, x̃i)(Si − p̂i)) ∣∣∣∣∣+ +\n∣∣∣∣∣ ns∑ i=1 E(I(p̂i, x̃i)(Si − p̂i)) ∣∣∣∣∣ ≤ 4(s+ 1)∆sn (17) for ns < n ≤ ns+1. Here the first sum of the right-hand inequality (16) is also bounded by 4s∆sns ≤ 4s∆sn – by the induction hypothesis (15). The second and the third sums are bounded by 2∆s+1n ≤ 2∆sn and by 2∆s+1ns ≤ 2∆sn, respectively. This follows from (11) and from choice of ∆s. The induction hypothesis (14) is valid.\nBy (13) for any s∣∣∣∣∣ n∑ i=1 E(I(p̃i, x̃i)(Si − p̃i)) ∣∣∣∣∣ ≤ 4(s+ 1)∆sn (18) for all n ≥ ns if ∆s satisfies the condition ∆s+1 ≤ ∆s(1− 1s+2 ) for all s.\nBy the law of large numbers (31), the relation (10) can be specified:\nPr { sup n≥ns ∣∣∣∣∣ 1n n∑ i=1 Vi ∣∣∣∣∣ > ∆s } ≤ (∆s)−2e−2ns∆ 2 s (19)\nfor all s, where Vi = I(p̃i, x̃i)(Si − p̃i) − E(I(p̃i, x̃i)(Si − p̃i)) is a sequence of martingale–differences.\nCombining (18) with (19), we obtain\nPr { sup n≥ns ∣∣∣∣∣ 1n n∑ i=1 I(p̃i, x̃i)(Si − p̃i) ∣∣∣∣∣ ≥ (4s+ 5)∆s } ≤ (∆s)−2e−2ns∆ 2 s (20)\nfor all s. The series ∑∞ s=1(∆s) −2e−2ns∆ 2 s is convergent if ns satisfies\nns ≥ ln s+ 2 ln ln s− 2 ln(∆s)\n2∆2s\nfor all s. Let also ∆s = o(1/s) as s → ∞. Then Borel–Cantelli Lemma implies convergence of (2) almost surely.\nIt is easy to verify that the sequences ns and ∆s satisfying all the conditions above exist."
    }, {
      "heading" : "3 Applications to technical analysis",
      "text" : ""
    }, {
      "heading" : "3.1 Simple trading for a rise",
      "text" : "Let S1, S2, . . . be a sequence of a stock prices. At any step i we use one-dimensional signals xi = Si−1, i = 1, 2 . . ., and an indicator function I(pi > xi + ), where is a parameter. 4\nAt the end of the trading period Speculator receives a gain or suffer loss ∆SI = Si − Si−1 for one share of the stock. The total gain or loss is equal to\nKn = n∑ i=1 I(p̃i > S̃i−1 + )∆Si,\nwhere p̃i and S̃i−1 are randomized forecast and past price of the stock respectively. Let us specify details of rounding. The expression ∆n+ √ n/∆k+1 from (12) takes its minimal value for ∆ = (k+12 ) 2 k+3n− 1 k+3 . In this case, the right-hand side\nof the inequality (11) is equal to ∆n+ √ n/∆k+1 = 2∆n = 2(k+12 ) 2 k+3n1− 1 k+3 .\nWe have k = 1, and hence, we use at any step n the rounding ∆s = n −1/4 s , where s is such that ns < n ≤ ns+1. We write A ∼ B if positive constants c1 and c2 exist such that c1B ≤ A ≤ c2B for all values of parameters from the expressions A and B. Define ns = s M and ∆s = s −M/4, where M is a positive integer number. Then s ∼ n1/Ms (the constants c1 and c2 depend on M). Easy to verify that all requirements for ns and ∆s given in Section 2 are valid. By (20) we can define µn = (4s+5)∆sn, where s is such that ns < n ≤ ns+1. For ns < n ≤ ns+1 it holds n ∼ ns, hence, µn ∼ n3/4+1/M . 4 In other approach we can consider a sequence of signals 1, 2, . . ..\nWe represent the total gain by n steps in a form\nKn = ∑\np̃i>S̃i−1+\n∆Si = n∑ i=1 I(p̃i > S̃i−1 + )(Si − p̃i) +\n+ n∑ i=1 I(p̃i > S̃i−1 + )(S̃i−1 − Si−1) +\n+ n∑ i=1 I(p̃i > S̃i−1 + )(p̃i − S̃i−1). (21)\nBy (12) the probability that the first addend of the sum (21) is more than −(∆sn+µn+2 √ n/∆2s) tends to 1 as n→∞, where s is such that ns < n ≤ ns+1.\nAccording to Section A.1 the probability that the second addend of the sum (21) is more than −∆sn tends to 1 as n → ∞. By definition the third addend of the sum (21) is more than\nn∑ i=1 I(p̃i > S̃i−1 + ) for all n.\nThen the probability that that the average income per one gamble kn satisfies\nkn = Kn n∑ i=1 I(p̃i > S̃i−1 + ) ≥\n − 2∆sn+ µn + 2 √ n/∆2s\nn∑ i=1 I(p̃i > S̃i−1 + )\n ∼\n∼  − 3n3/4 + n3/4+1/Mn∑ i=1 I(p̃i > S̃i−1 + )  (22) tends to 1 as n → ∞. Using inequalities of Section A.1 and definition of ∆s and µn, one can check that the corresponding convergence rate is e −c √ n, where c > 0. We summarize this result in the following proposition.\nProposition 1. A randomized trading strategy exists such that given 0 < < 1 and 0 < γ < 1 with (internal) probability 1− e−c′ √ n if\nn∑ i=1 I(p̃i > S̃i−1 + ) ≥ cn3/4+ν γ , (23)\nthen kn ≥ (1− γ) , where ν = 1/M , c′ and c are positive constants."
    }, {
      "heading" : "3.2 Trading with a limited risk",
      "text" : "The most important requirement for a trading strategy is guarantee conditions. We present a defensive strategy for Speculator in sense of Shafer and Vovk’s book [9]. This means that starting with some initial capital Speculator never goes\nto debt and receives a gain when a sufficiently long subsequence of forecasts like (23) exists.\nWe modify the strategy given in Section 3.1 to a defensive strategy. Let K0 > 0 be a starting capital of Speculator. Define Mi = δKi−1, where Ki−1 is the capital of Speculator at step i − 1 and δ is a parameter such that 0 ≤ δ ≤ 1. As usual, we suppose that all prices a scaled such that 0 ≤ Si−1 ≤ 1 S1 = S0.\nSpeculator’s capital after ith step is equal to\nKi = Ki−1 + δKi−1∆Si. (24)\nAt any step n the logarithm of the capital is equal to\nlnKn = lnK0 + n∑ i=1 I(p̃i > S̃i−1 + ) ln(1 + δ∆Si) ≥\n≥ lnK0 + δ n∑ i=1 I(p̃i > S̃i−1 + )∆Si −\n−δ2 n∑ i=1 I(p̃i > S̃i−1 + )(∆Si) 2. (25)\nHere we have used the inequality ln(1 + x) ≥ x− x2 for |x| ≤ 1. Let L̃n = n∑ i=1 I(p̃i > S̃i−1 + ). Since |∆Si−1| ≤ 1, a bound\nn∑ i=1 I(pi > S̃i−1 + )(∆Si) 2 ≤ L̃n (26)\nis valid for all n. By (22) probability of the event\nn∑ i=1 I(pi > S̃i−1 + )∆Si ≥ L̃n − cn3/4+1/M (27)\ntends to 1 as n→∞, where c is a positive constant. Denote\nVarn(S) = 1\nL̃n n∑ i=1 I(p̃i > S̃i−1 + )(∆Si) 2.\nFor practical applications, where Varn(S) 1, we can replace in (26) L̃n on L̃nVarn(S). Then by (25) and (27) probability of the event\nlnKn ≥ lnK0 + δ( L̃n − cn3/4+1/M )− δ2Varn(S)L̃n (28)\ntends to 1 as n→∞. Therefore, probability of the event Kn ≥ K0 exp ( δ ( L̃n( − δVarn(S))− cn3/4+1/M )) (29)\nFig.1 Calibrated forecasts of prices of LKOH stock\ntends to 1 as n→∞. We summarize the result of this section in the following proposition.\nProposition 2. A randomized trading strategy exists such that given 0 < < 1 and 0 < δ < 1 with (internal) probability 1 − e−c′ √ n the capital Kn of Speculator has a lower bound (29), where c′ and c are positive constants. The capital increases if\nn∑ i=1 I(p̃i > S̃i−1 + ) ≥ cn3/4+ν ( − δVarn(S)) ,\nwhere ν = 1/M . Also, Kn > 0 for all n."
    }, {
      "heading" : "4 Conclusion",
      "text" : "Calibration is an intensively developing area of recent research where several algorithms for computing calibrated forecasts were developed. It is attractive to find some practical applications of these results. Using calibrated forecasts for constructing short-term trading strategies in Stock Market looks very natural.\nIn this paper, we construct such strategies and perform numerical experiments. These experiments show a positive return for six main Russian stocks, and for two stocks we receive a gain even when transaction costs are subtracted.\nTo construct trading strategies we develop a more general notion of calibration and prove convergence results for it. We also present some sufficient conditions under which our trading strategies receive a gain.\nFig.2 Capitals of speculators playing for a rise on six Russian stocks (with no transaction costs – on the left figure, with transaction costs 0.01% – on the right\nfigure)"
    }, {
      "heading" : "A Appendix",
      "text" : "A.1 Large deviation inequality for martingales\nA sequence V1, V2, . . . is called martingale-difference with respect to a sequence of random variables X1, X2, . . . if for any i > 1 the random variable Vi is a function of X1, . . . , Xi and E(Vi+1|X1, . . . , Xi) = 0 almost surely. The following inequalities are consequences of Hoffding-Azuma inequality [2]:\nLet V1, V2, . . . be a martingale–difference with respect to X1, X2, . . ., and Vi ∈ [Ai, Ai + 1] for some random variable Ai measurable with respect to X1, . . . , Xi. Let Sn =\nn∑ i=1 Vi. Then for any t > 0\nP {∣∣∣∣Snn ∣∣∣∣ > t} ≤ 2e−2nt2 (30)\nfor all n. A strong law of large numbers is also holds: for any t\nP { sup k≥n ∣∣∣∣Skk ∣∣∣∣ > t} ≤ t−2e−2nt2 (31)\nfor all n. Since the series of the exponents from the right-hand side of the inequality (30) convergent, by Borel–Cantelli Lemma we obtain the martingale strong law of large numbers\nP { lim n→∞ Sn n = 0 } = 1.\nFig.3 Capital of the weighted average of 12 strategies (two strategies for each stock – calibration strategy and “buy and hold” (B&H) strategy\nA.2 Numerical experiments\nIn the numerical experiments, we have used historical data in form of per minute time series of prices of six main stocks of Russian Stock Market in 2010 (From 2010-03-26T10:31 to 2010-09-16T12:15). downloaded from FINAM site: www .finam.ru. Number of trading points in each game is 6 · 104 min. In our experiments, we dealing only for a rise starting with the same initial capital K0.\nWe have used the threshold = ′σ, where σ is the standard deviation of a price calculating using some sliding window, 0 < ′ < 1. A kernel K(p, p′) = cos(π(p− p′)) was used as a smooth approximation of (5).\nResults of numerical experiments are shown in Table 1. In the first column, ticker symbols of six stocks from Russian Stock Market are shown. The second column contains the frequencies of steps i where pi > Si−1 + . In the third column, the average duration of a gamble is shown. We sell all shares of a stock at step i in case p̃i ≤ Si−1 + or Si ≤ Si−1. In fourth and in fifth columns, a relative return (in percentage wise on initial capital) for six main stocks from Russian Stock Market in 2010. We have used a transaction cost at the rate 0.01%. In the sixth column, a return of “buy and hold” strategy is shown. By this strategy, we buy a holdings of shares for K0 and sell them at the end of the trading period.\nOn Fig.1 the evolution of LKOH prices and their predictions are shown. On Fig. 2 the relative returns of calibration strategies for all six stocks are shown (without and with transaction costs). On Fig.3 a relative return of shortterm trading for six stocks are shown including calibration and buy and hold strategy for each stock. The extra bold line represents a relative return of some averaging strategy AGGR. This strategy is similar to the Freund and Shapire [6] exponential weighting algorithm, where one-day steps are used (see also the last line of Table 1)."
    } ],
    "references" : [ {
      "title" : "Asymptotic calibratio",
      "author" : [ "D.P.Foster", "R. Vohra" ],
      "venue" : "Biometrika. 85,",
      "citeRegEx" : "5",
      "shortCiteRegEx" : "5",
      "year" : 1998
    }, {
      "title" : "A decision-theoretic generalization of online learning and an application to boosting",
      "author" : [ "Y Freund", "R.E. Schapire" ],
      "venue" : "Journal of Computer and System Sciences,",
      "citeRegEx" : "6",
      "shortCiteRegEx" : "6",
      "year" : 1997
    }, {
      "title" : "Probability and Finance. It’s Only a Game",
      "author" : [ "G. Shafer", "V. Vovk" ],
      "venue" : "New York: Wiley,",
      "citeRegEx" : "9",
      "shortCiteRegEx" : "9",
      "year" : 2001
    } ],
    "referenceMentions" : [ {
      "referenceID" : 0,
      "context" : "Foster and Vohra [5] show that calibration is almost surely guaranteed with a randomizing forecasting rule, i.",
      "startOffset" : 17,
      "endOffset" : 20
    }, {
      "referenceID" : 2,
      "context" : "We present a defensive strategy for Speculator in sense of Shafer and Vovk’s book [9].",
      "startOffset" : 82,
      "endOffset" : 85
    }, {
      "referenceID" : 1,
      "context" : "This strategy is similar to the Freund and Shapire [6] exponential weighting algorithm, where one-day steps are used (see also the last line of Table 1).",
      "startOffset" : 51,
      "endOffset" : 54
    } ],
    "year" : 2013,
    "abstractText" : "We provide a natural learning process in which a financial trader without a risk receives a gain in case when Stock Market is inefficient. In this process, the trader rationally choose his gambles using a prediction made by a randomized calibrated algorithm. Our strategy is based on Dawid’s notion of calibration with more general changing checking rules and on some modification of Kakade and Foster’s randomized algorithm for computing calibrated forecasts.",
    "creator" : "TeX"
  }
}