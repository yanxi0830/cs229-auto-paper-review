{
  "name" : "1507.06738.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "Linear Contextual Bandits with Knapsacks",
    "authors" : [ "Shipra Agrawal", "Nikhil R. Devanur" ],
    "emails" : [ ],
    "sections" : [ {
      "heading" : null,
      "text" : "ar X\niv :1\n50 7.\n06 73\n8v 2\n[ cs\n.L G\n] 9\nJ ul\n2 01\n6"
    }, {
      "heading" : "1 Introduction",
      "text" : "In the contextual bandit problem [7, 13, 21, 2], the decision maker observes a sequence of contexts (or features). In every round she needs to pull one out of K arms, after observing the context for that round. The outcome of pulling an arm may be used along with the contexts to decide future arms. Contextual bandit problems have found many useful applications such as online recommendation systems, online advertising, and clinical trials, where the decision in every round needs to be customized to the features of the user being served. The linear contextual bandit problem [1, 7, 16] is a special case of the contextual bandit problem, where the outcome is linear in the feature vector encoding the context. As pointed by [2], contextual bandit problems represent a natural half-way point between supervised learning and reinforcement learning: the use of features to encode contexts and the models for the relation between these feature vectors and the outcome are often inherited from supervised learning, while managing the exploration-exploitation tradeoff is necessary to ensure good performance in reinforcement learning. The linear contextual bandit problem can thus be thought of as a midway between the linear regression model of supervised learning, and reinforcement learning.\nRecently, there has been a significant interest in introducing multiple “global constraints” in the standard bandit setting [10, 3, 11, 5]. Such constraints are crucial for many important real-world applications. For example, in clinical trials, the treatment plans may be constrained by the total availability of medical facilities, drugs and other resources. In online advertising, there are budget constraints that restrict the number of times an ad is shown. Other applications include dynamic pricing, dynamic procurement, crowdsourcing, etc.; see [10, 3] for many such examples.\nIn this paper, we consider linear contextual bandit with knapsacks (henceforth, linCBwK) problem. In this problem, the context vectors are generated i.i.d. in every round from some unknown distribution, and on picking an arm, a reward and a consumption vector is observed, which depend linearly on the context vector. The aim of the decision maker is to maximize a total reward while ensuring the the total consumption of every resource remains withing a given budget. Below, we give a more precise definition of this problem.\n∗Columbia University. sa3305@columbia.edu. †Microsoft Research. nikdev@microsoft.com.\nWe use the following notational convention throughout: vectors are denoted by bold face lower case letters, while matrices are denoted by regular face upper case letters. Other quantities such as sets, scalars, etc. may be of either case, but never bold faced. All vectors are column vectors, i.e., a vector in n dimensions is treated as an n× 1 matrix. The transpose of matrix A is A⊤.\nDefinition 1 (linCBwK). There are K “arms”, which we identify with the set [K]. The algorithm is initially given as input a budget B ∈ R+. In every round t, the algorithm first observes context xt(a) ∈ [0, 1]m for every arm a, and then chooses an arm at ∈ [K], and finally observes a reward rt(at) ∈ [0, 1] and a ddimensional consumption vector vt(at) ∈ [0, 1]d. The algorithm has a “no-op” option, which is to pick none of the arms and get 0 reward and 0 consumption. The goal of the algorithm is to pick arms such that the total reward\n∑T t=1 rt(at) is maximized, while ensuring that the total consumption does not exceed budget, i.e.,\n∑\nt vt(at) ≤ B1. We make the following stochastic assumption for context, reward, consumption vectors. In every round t, the tuple {xt(a), rt(a),vt(a)}Ka=1 is generated from an unknown distribution D, independent of everything in previous rounds. Also, there exists an unknown vector µ∗ ∈ [0, 1]m and matrix W∗ ∈ [0, 1]m×d such that for every arm a, given contexts xt(a), and history Ht−1 before time t,\nE[rt(a)|xt(a), Ht−1] = µ⊤∗ xt(a), E[vt(a)|xt(a), Ht−1] = W⊤∗ xt(a). (1)\nFor succinctness, we will denote the tuple of contexts for K arms at time t as matrix Xt ∈ [0, 1]m×K, with xt(a) being the a\nth column of this matrix. Similarly, rewards are represented as vector rt ∈ [0, 1]K, and consumption vectors are represented as matrix Vt ∈ [0, 1]d×K.\nAs we discuss later in the text, the assumption in equation (1) forms the primary distinction between our linear contextual bandit setting and the general contextual bandit setting considered in [5]. Exploiting this linearity assumption will allow us to generate regret bounds which do not depend on number of arms K, rendering it to be especially useful when number of arms is large. Some examples include recommendation systems with large number of products (e.g., retail products, travel packages, ad creatives, sponsored facebook posts). Another advantage over using general contextual bandit setting of [5] is that we don’t need an oracle access to a certain optimization problem, which is required to solve an NP-Hard problem in this case. (See Section 1.1 for a more detailed discusssion.)\nWe compare the performance of an algorithm to that of the optimal adaptive policy that knows the distribution D and the parameters (µ∗,W∗), and can take into account the history upto that point as well as the current context to decide (possibly with randomization) which arm to pull at time t. However, it is easier to work with an upper bound on this, which is the optimal expected reward of a static policy that is required to satisfy the constraints only in expectation. This technique has been used in several related problems and is standard by now [19, 10].\nDefinition 2 (Optimal Static Policy). Consider any policy that is context dependent but non-adaptive: for a policy π, let π(X) ∈ ∆K+1 (the unit simplex) denote the probability distribution over arms played (plus no-op) when the context is X ∈ X . Define r(π) and v(π) to be the expected reward and consumption vector of policy π, respectively, i.e.\nr(π) := E(X,r,V )∼D[rπ(X)] = EX∼D[µ ⊤ ∗ Xπ(X)]. (2) v(π) := E(X,r,V )∼D[V π(X)] = EX∼D[W ⊤ ∗ Xπ(X)]. (3)\nLet π∗ := argmaxπ T r(π) such that T v(π) ≤ B1 (4)\nbe the optimal static policy. Note that since no-op is allowed, a feasible policy always exists. We denote the value of this optimal static policy by OPT := T r(π∗).\nFollowing lemma proves that OPT upper bounds the value of optimal adaptive policy. The proof is in Appendix B.\nLemma 1. Let OPT denote the value of optimal adaptive policy that knows the distribution D and parameters µ∗,W∗, We show that there exists a static policy π ∗ such that T r(π∗) ≥ OPT, and Tv(π∗) ≤ B.\nDefinition 3 (Regret). Let at be the arm played at time t by the algorithm. Then, regret is defined as\nregret(T ) := OPT− T ∑\nt=1\nrt(at)"
    }, {
      "heading" : "1.1 Main results",
      "text" : "Our main result is an algorithm with near-optimal regret bound for linCBwK .\nTheorem 1. There is an algorithm for linCBwK such that if B > mT 3/4, then with probability at least 1− δ,\nregret(T ) = O ( (OPTB + 1)m √ ln(dT/δ) ln(T )T ) .\nRelation to general contextual bandits. There have been recent papers [5, 11] that solve problems similar to linCBwK but for general contextual bandits. Here the relation between contexts and outcome vectors is arbitrary and the algorithms compete with an arbitrary fixed set of context dependent policies Π accessible via an optimization oracle, with regret bounds being O (\n(OPTB + 1) √\nKT log(dT |Π|/δ) ) . These\napproaches could potentially be applied to the linear setting using a set Π of linear context dependent policies. Comparing their bounds with ours, in our results, essentially a √\nK log(|Π|) factor is replaced by a factor of m. Most importantly, we have no dependence on K,1 which enables us to consider problems with large action spaces. In any case, both K and log(|Π|) are at least m, so their bounds are no smaller.\nFurther, suppose that we want to use their result with the set of linear policies, i.e., policies of the form\narg max a∈[K]\n{xt(a)⊤θ},\nfor some fixed θ ∈ ℜm. Then, their algorithms would require access to an “Arg-Max Oracle” that can find the best such policy (maximizing total reward) for a given set of contexts and rewards (no resource consumption). We show that infact the optimization problem underlying such an “Arg-Max Oracle” problem is NP-Hard, making such an approach computationally expensive. (Proof is in Appendix C.)\nThe only downside to our results is that we need the budget B to be Ω(mT 3/4). Getting similar bounds for budgets as small as B = Θ(m √ T ) is an interesting open problem. (This also indicates that this is indeed a harder problem than all the special cases.) Near-optimality of regret bounds. In [17], it was shown that for the linear contextual bandits problem, no online algorithm can achieve a regret bound better than Ω(m √ T ). In fact, they prove this lower bound for linear contextual bandits with static contexts. Since that problem is a special case of the linCBwK problem with d = 1, this shows that the dependence on m and T in the above regret bound is optimal upto log factors. For general contextual bandits with resource constraints, the bounds of [5, 11] are near optimal.\nRelation to BwK [3] and OSPP [4]. It is easy to see that the linCBwK problem is a generalization of the linear contextual bandits problem [1, 7, 16]. There, the outcome is scalar and the goal is to simply maximize the sum of these. Remarkably, the linCBwK problem also turns out to be a common generalization of bandits with knapsacks (BwK) problem considered in [10, 3], and the online stochastic packing problem (OSPP) studied by [18, 6, 22, 19, 4]. In both BwK and OSPP, the outcome of every round t is a reward rt and a vector vt and the goal of the algorithm is to maximize ∑T t=1 rt while ensuring that ∑T t=1 vt ≤ B1. The problems differ in how these rewards and vectors are picked. In the OSPP problem, in every round t, the algorithm may pick any reward,vector pair from a given set At of d + 1-dimensional vectors. The set\n1Similar to the regret bounds for linear contextual bandits [1, 7, 16].\nAt is drawn i.i.d. from an unknown distribution over sets of vectors. This corresponds to the special case of linCBwK , where m = d + 1 and the context xt(a) itself is equal to (rt(a),vt(a). In the BwK problem, there is a fixed set of arms, and for each arm there is an unknown distribution over reward,vector pairs. The algorithm picks an arm and a reward,vector pair is drawn from the corresponding distribution for that arm. This corresponds to the special case of linCBwK , where m = K and the context Xt = I, the identity matrix, for all t.\nWe use techniques from all three special cases: our algorithms follow the primal-dual paradigm using an online learning algorithm to search the dual space, that was established in [3]. In order to deal with linear contexts, we use techniques from [1, 7, 16] to estimate the weight matrix W∗, and define “optimistic estimates” of W∗. We also use the technique of combining the objective and the constraints using a certain tradeoff parameter and that was introduced in [4]. Further new difficulties arise, such as in estimating the optimum value from the first few rounds, a task that follows from standard techniques in each of the special cases but is very challenging here. We develop a new way of exploration that uses the linear structure, so that one can evaluate all possible choices that could have led to an optimum solution on the historic sample. This technique might be of independent interest in estimating optimum values. One can see that the problem is indeed more than the sum of its parts, from the fact that we get the optimal bound for linCBwK only when B ≥ Ω̃(mT 3/4), unlike either special case for which the optimal bound holds for all B (but is meaningful only for B = Ω̃(m √ T )).\nThe approach in [3] (for BwK) extends to the case of “static” contexts,2 where each arm has a context that doesn’t change over time. The OSPP of [4] is not a special case of linCBwK with static contexts; this is one indication of the additional difficulty of dynamic over static contexts.\nOther related work. Budget constraints in a bandit setting has recieved considerable attention, but most of the early work focussed on special cases such as a single budget constraint in the regular (non-contextual) setting [20, 23, 26, 29, 35, 36]. Recently, [38] showed an O( √ T ) regret in the linear contextual setting with a single budget constraint, when costs depend only on contexts and not arms. Budget constraints that arise in particular applications such as online advertising [14, 31], dynamic pricing [8, 12] and crowdsourcing [9, 33, 34] have also been considered. There has also been a long line of work studying special cases of the OSCP problem [18, 19, 22, 6, 28, 24, 37, 30, 27, 15].\nDue to space constraints, we have eliminated many proofs from the main text. All the missing proofs are in the appendix."
    }, {
      "heading" : "2 Preliminaries",
      "text" : ""
    }, {
      "heading" : "2.1 Confidence Ellipsoid",
      "text" : "Consider a stochastic process which in each round t, generates a pair of observations (rt,yt), such that rt is an unknown linear function of yt plus some 0-mean bounded noise, i.e., rt = µ ⊤ ∗ yt + ηt, where yt,µ∗ ∈ Rm, |ηt| ≤ 2R, and E[ηt|y1, r1, . . . ,yt−1, rt−1,yt] = 0. At any time t, a high confidence estimate of the unknown vector µ∗ can be obtained by building a\n“Confidence Ellipsoid” around the ℓ2-regularized least-square estimate µ̂t constructed from the observations made so far. This technique is common in prior work on linear contextual bandits (e.g., in [7, 16, 1]). For any regularization parameter λ > 0, let\nMt := λI + ∑t−1 i=1 yiy ⊤ i , and µ̂t := M −1 t ∑t−1 i=1 yiri.\nThe following result from [1] shows that µ∗ lies with high probability in an ellipsoid with center µ̂t. For any positive semi-definite (PSD) matrix M, define the M -norm as ‖µ‖M := √\nµ⊤Mµ. The confidence ellipsoid at time t is defined as\nCt := { µ ∈ Rm : ‖µ− µ̂t‖Mt ≤ R √ m ln ((1+tm/λ)/δ) + √ λm } .\n2It was incorrectly claimed in [3] that the approach can be extended to dynamic contexts without much modifications.\nLemma 2 (Theorem 2 of [1]). If ∀ t, ‖µ∗‖2 ≤ √ m and ‖yt‖2 ≤ √ m, then with prob. 1− δ, µ∗ ∈ Ct.\nAnother useful observation about this construction is stated below. It first appeared as Lemma 11 of [7], and was also proved as Lemma 3 in [16].\nLemma 3 (Lemma 11 of [7]). ∑T t=1 ‖yt‖M−1t ≤ √ mT ln(T ).\nAs a corollary of the above two lemmas, we obtain a bound on the total error in the estimate provided by “any point” from the confidence ellipsoid. (Proof is in Appendix D.)\nCorollary 1. For t = 1, . . . , T , let µ̃t ∈ Ct be a point in the confidence ellipsoid, with λ = 1, 2R = 1. Then, with probability 1− δ,\n∑T t=1 |µ̃⊤t yt − µ⊤∗ yt| ≤ 2m √ T ln ((1+Tm)/δ) ln(T )."
    }, {
      "heading" : "2.2 Online Learning",
      "text" : "The online convex optimization (OCO ) problem considers a T round game played between a learner and an adversary, where in round t, the learner chooses a θt ∈ Ω, and then the adversary picks a concave function gt(θt) : Ω → R. The learner’s choice θt may only depend on learner’s and adversary’s choices in previous rounds. The goal of the learner is to minimize regret defined as the difference between the learner’s objective value and the value of the best single choice on hindsight:\nR(T ) := maxθ∈Ω ∑T t=1 gt(θ)− ∑T t=1 gt(θt).\nIn particular, we will use linear reward functions with values in [−1, 1], and domain Ω is the unit simplex in d+ 1 dimensions. The algorithm online mirror descent (OMD ) has very fast per step update rules, and provides the following regret guarantees for this setting.\nLemma 4. [32] The online mirror-descent algorithm for the OCO problem achieves regret\nR(T ) = O( √ log(d)T ).\nWe actually need the domain to be\nΩ = {θ : ‖θ‖1 ≤ 1, θ ≥ 0} .\nThis is a special case of a unit simplex in d+ 1 dimensions, by letting the rewards on one of the dimensions always be zero. For the rest of the paper, we assume that the OMD algorithm is using this domain."
    }, {
      "heading" : "3 Algorithm",
      "text" : ""
    }, {
      "heading" : "3.1 Optimistic estimates of unknown parameters",
      "text" : "Let at denote the arm played by the algorithm at time t. In the beginning of every round, we use the outcomes and contexts from previous rounds to construct a confidence ellipsoid for µ∗ and every column of W∗. The construction of confidence ellipsoid for µ∗ follows directly from the techniques in Section 2.1 with yt = xt(at) and rt being reward at time t. To construct a confidence ellipsoid for a column j of W∗, we use the techniques in Section 2.1 while substituting yt = xt(at) and rt = vt(at)j for every j.\nAs in Section 2.1, let Mt := I + ∑t−1 i=1 xi(ai)xi(ai) ⊤, and construct the regularized least squares estimate\nfor µ∗,W∗, respectively, as\nµ̂t := M −1 t ∑t−1 i=1 xi(ai)ri(ai) ⊤ (5)\nŴt := M −1 t ∑t−1 i=1 xi(ai)vi(ai) ⊤. (6)\nDefine confidence ellipsoid for parameter µ∗ as\nCt,0 := { µ ∈ Rm : ‖µ− µ̂‖Mt ≤ √ m ln ((d+tmd)/δ) + √ m } ,\nand optimistic estimate of µ∗ for every arm a as:\nµ̃t(a) := argmaxµ∈Ct,0 xt(a) ⊤µ. (7)\nLet wj denote the j th column of a matrix W . We define a confidence ellipsoid for each column j, as\nCt,j := { w ∈ Rm : ‖w− ŵtj‖Mt ≤ √ m ln ((d+tmd)/δ) + √ m } ,\nand denote by Gt, the Cartesian product of all these ellipsoids: Gt := {W ∈ Rm×d : wj ∈ Ct,j}. Note that Lemma 2 implies W∗ ∈ Gt with probability 1 − δ. Now, given a vector θt ∈ Rd, we define the optimistic estimate of weight matrix at time t w.r.t. θt, for every arm a ∈ [K], as :\nW̃t(a) := argminW∈Gt xt(a) ⊤Wθt. (8)\nIntuitively, for reward we want an upper confidence bound and for consumption we want a lower confidence bound as an optimistic estimate. This intuition aligns with the above definitions, where the maximizer was used in case of reward and a minimizer was used for consumption. The utility and precise meaning of θt will become clearer when we describe the algorithm and present regret analysis.\nUsing the definition of µ̃t, W̃t, along with the results in Lemma 2 and Corollary 1 about confidence ellipsoids, the following can be derived.\nCorollary 2. With probability 1− δ, for any sequence of θ1, θ2, . . . , θT , 1. xt(a) ⊤µ̃t(a) ≥ xt(a)⊤µ̃, for all arms a ∈ [K], for all time t.\n2. xt(a) ⊤W̃t(a)θt ≤ xt(a)⊤W∗θt, for all arms a ∈ [K], for all time t.\n3. |∑Tt=1(µ̃t(at)− µ∗)⊤xt(at)| ≤ ( 2m √ T ln ((1+tm)/δ) ln(T ) ) .\n4. ‖∑Tt=1(W̃t(at)−W∗)⊤xt(at)‖ ≤ ‖1d‖ ( 2m √ T ln ((d+tmd)/δ) ln(T ) ) .\nEssentially, the first two claims ensure that we have optimistic estimates, and the last two claims ensure that the estimates quickly converge to the true parameters."
    }, {
      "heading" : "3.2 The core algorithm",
      "text" : "In this section, we present an algorithm, and analysis, under the assumption that a certain parameter Z is given. Later, we show how to use the first T0 rounds to estimate Z, and also bound the additional regret due to these T0 rounds. We define Z now.\nAssumption 1. Assume we are given Z such that OPTB ≤ Z ≤ O(OPTB + 1).\nThe algorithm constructs estimates µ̂t and Ŵt as in Section 3.1. It also runs the OMD algorithm for an instance of the online learning problem, over the unit simplex. The vector played by the online learning algorithm in time step t is θt. After observing the context, the optimistic estimates for each arm are then constructed using θt, as defined in (7) and (8). Intuitively, θt is used here as a multiplier to combine different columns of the weight matrix, to get an optimistic weight vector for every arm. An adjusted estimated reward for arm a is then defined by using Z to combine optimistic estimate of reward with optimistic estimate of consumption, as (xt(a)\n⊤µ̃t(a))−Z(xt(a)⊤W̃t(a)θt). The algorithm chooses the arm which appears to be the best according to adjusted estimated reward. After observing the resulting reward and consumption vectors, the estimates are updated. The online learning algorithm is advanced by one step, by defining the profit vector to be vt(at)− BT 1. The algorithm ends either after T time steps or as soon as the total consumption exceeds the budget along some dimension.\nAlgorithm 1 Algorithm for linCBwK , with given Z\nInitialize θ1 as per the OCO algorithm. Initialize Z such that OPTB ≤ Z ≤ O(OPTB + 1). for all t = 1, ..., T do Observe Xt. For every a ∈ [K], compute µ̃t(a) and W̃t(a) as per (7) and (8) respectively. Play the arm at := argmaxa∈[K] xt(a)\n⊤(µ̃t(a)− ZW̃t(a)θt). Observe rt(at) and vt(at). If for some j = 1..d, ∑\nt′≤t vt′(at′) · ej ≥ B then EXIT. Use xt(at), rt(at) and vt(at) to obtain µ̂t+1, Ŵt+1 and Gt+1. Update θt+1 as per the OCO algorithm with gt(θt) := θt · ( vt(at)− BT 1 )\n. end for\nTheorem 2. Given a Z as per Assumption 1, Algorithm 1 achieves the following bounds, given that R(T ) is the regret of the OCO algorithm, with probability 1− δ:\nregret(T ) ≤ O ( (OPTB + 1)m √ T ln(dT/δ) ln(T ) ) .\n(Proof Sketch) We provide a sketch of the proof here, with the full proof in Appendix E. Let τ be the stopping time of the algorithm. The proof is in 3 steps:\nStep 1: Since E[vt(at)|Xt, at, Ht−1] = W⊤∗ xt(at), we apply Azuma-Hoeffding to get that with high probability ∥ ∥\n∑τ t=1 vt(at)−W⊤∗ xt(at)\n∥ ∥ ∞ is small. Similarly, a lower bound on the sum of µ ⊤ ∗ xt(at) is sufficient.\nStep 2: From Corollary 2, with high probability, we can bound ∥ ∥\n∥ ∑T t=1(W∗ − W̃t(at))⊤xt(at)\n∥ ∥ ∥\n∞ . It is\ntherefore sufficient to work with the sum of the vectors W̃t(at) ⊤xt(at), and similarly µ̃t(at) ⊤xt(at).\nStep 3: The proof is completed by showing the desired bound on OPT− ∑τ t=1 µ̃t(at) ⊤xt(at). This part is similar to the online stochastic packing problem; if the actual reward and consumption vectors were µ̃t(at)\n⊤xt(at) and W̃t(at)⊤xt(at), then it would be exactly like that problem. We adapt techniques from [4]: use the OCO algorithm and the Z parameter to combine constraints into the objective. If a dimension is being consumed too fast, then the multiplier for that dimension should increase, making the algorithm to pick arms that are not likely to consume too much along this dimension."
    }, {
      "heading" : "3.3 Algorithm with Z computation",
      "text" : "In this section, we present a modification of Algorithm 1 which computes the required parameter Z and therefore does not need to be provided with a Z as input, as assumed previously in Assumption 1. The algorithm computes Z using the observations from first T0 rounds. Once Z is computed, the algorithm from the previous section can be run for the remaining time steps. However, it needs to be modified slightly to take into account the budget consumed during the first T0 rounds. We handle this by using a smaller budget B′ = B − T0 in the computations for remaining rounds. The modified algorithm is given below.\nAlgorithm 2 Algorithm for linCBwK , with Z computation\nInputs: B, T0, B ′ = B − T0 Using observations from first T0 rounds, compute Z such that OPT B′ ≤ Z ≤ O(OPTB′ + 1). Run Algorithm 1 for T − T0 rounds and budget B′.\nNext, we provide details of the first T0 rounds, and choice of T0. We provide a method that takes advantage of the linear structure of the problem, and explores in the mdimensional space of contexts and weight vectors to obtain bounds independent of K. We use the following procedure. In every round t = 1, . . . , T0, after observing Xt, let pt ∈ ∆[K] be\npt := arg max p∈∆[K] ‖Xtp‖M−1t , (9)\nwhere Mt := I + ∑t−1 i=1(Xipi)(Xipi) ⊤. (10)\nSelect arm at = a with probability pt(a). In fact, since Mt is a PSD matrix, due to convexity of the function ‖Xtp‖2M−1t , it is the same as playing at = argmaxa∈[K] ‖xt(a)‖M−1t . Construct estimates µ̂, Ŵt of µ∗,W∗ at time t as\nµ̂t := M −1 t ∑t−1 i=1(Xipi)ri(ai), Ŵt := M −1 t ∑t−1 i=1(Xipi)vi(ai) ⊤.\nAnd, for some value of γ defined later, obtain an estimate ˆOPT γ of OPT as:\nˆOPT γ := maxπ\nT T0 ∑T0 i=1 µ̂ ⊤ i Xiπ(Xi)\nsuch that TT0 ∑T0 i=1 Ŵ ⊤ i Xiπ(Xi) ≤ B + γ.\n(11)\nFor an intuition about the choice of arm in (9), observe from the discussion in Section 2.1 that every column w∗j of W∗ is guaranteed to lie inside the confidence ellipsoid centered at column ŵtj of Ŵt, namely the ellipsoid, ‖w − ŵtj‖2Mt ≤ 4m ln(Tm/δ). Note that this ellipsoid has principle axes as eigenvectors of Mt, and the length of semi-principle axes is given by inverse eigenvalues of Mt. Therefore, by maximizing ‖Xtp‖M−1t we are choosing the context closest to the direction of the longest principal axes of the confidence ellipsoid, i.e. in the direction of maximum uncertainty. Intuitively, this corresponds to pure exploration: by making an observation in the direction where uncertainty is large we can reduce the uncertainty in our estimate most effectively.\nA more algebraic explanation is as follows. For a good estimation of OPT by ˆOPT γ , we want the\nestimates Ŵt and W∗ (and, µ̂ and µ∗) to be close enough so that ‖ ∑T0 t=1(Ŵt − Ŵ∗)⊤Xtπ(Xt)‖∞ (and, |∑T0t=1(µ̂t − µ∗)⊤Xtπ(Xt)|) is small for all policies π, and in particular for sample optimal policies. Now, using Cauchy-Schwartz these are bounded by\n∑T0 t=1 ‖µ̂t − µ∗‖Mt‖Xtπ(Xt))‖M−1t , and ∑T0\nt=1 ‖Ŵt −W∗‖Mt‖Xtπ(Xt))‖M−1t ,\nwhere we define ‖W‖M , the M -norm of matrix W to be the max of column-wise M -norms. Using Lemma 2, the term ‖µ̂t − µ∗‖Mt is bounded by 2 √ m ln(T0m/δ) , and ‖Ŵt −W∗‖Mt is bounded by 2 √ m ln(T0md/δ), with probability 1 − δ. Lemma 3 bounds the second term ∑T0t=1 ‖Xtπ(Xt)‖M−1t but only when π is the played policy. This is where we use that the played policy pt was chosen to maximize ‖Xtpt‖M−1t , so that ∑T0\nt=1 ‖Xtπ(Xt)‖M−1t ≤ ∑T0 t=1 ‖Xtpt‖M−1t and the bound ∑T0 t=1 ‖Xtpt‖M−1t ≤ √ mT0 ln(T0) given by Lemma\n3 actually bounds ∑T0 t=1 ‖Xtπ(Xt)‖M−1t for all π. Combining, we get a bound of 2m √ T0ln(T0) ln(T0d/δ) on deviations ‖∑T0t=1(Ŵt − Ŵ∗)⊤Xtπ(Xt)‖∞ and | ∑T0\nt=1(µ̂t − µ∗)⊤Xtπ(Xt)| for all π. We prove the following lemma.\nLemma 5. For γ = (\nT T0\n)\n2m √ T0ln(T0) ln(T0d/δ), with probability 1−O(δ),\nOPT− 2γ ≤ ˆOPT2γ ≤ OPT+ 9γ(OPTB + 1).\nCorollary 3. Set Z = ( ˆOPT\n2γ +2γ) B + 1, with above value of γ. Then, with probability 1−O(δ), OPT\nB + 1 ≤ Z ≤ (1 + 11γ B )( OPT B + 1).\nCorollary 3 implies that as long as B ≥ γ, i.e., B ≥ Ω̃( mT√ T0 ), Z is a constant factor approximation of\nOPT B + 1 ≥ Z∗, therefore Theorem 2 should provide an Õ\n( (OPTB + 1)m √ T ) regret bound. However, this\nbound does not account for the budget consumed in the first T0 rounds. Considering that (at most) T0 amount can be consumed from the budget in the first T0 rounds, we have an additional regret of OPT B T0. Further, since we have B′ = B − T0 budget for remaining T − T0 rounds, we need a Z that satisfies the required assumption for B′ instead of B (i.e., we need OPTB′ ≤ Z ≤ O(1) ( OPT B′ + 1 )\n). If B ≥ 2T0, then, B′ ≥ B/2, and using 2 times the Z computed in Corollary 3 would satisfy the required assumption.\nTogether, these observations give Theorem 3.\nTheorem 3. Using Algorithm 2 with T0 such that B > max{2T0,mT/ √ T0}, and twice the Z given by Corollary 3, we get a high probability regret bound of\nÕ ( ( OPT\nB + 1 )\n( T0 +m √ T )) .\nIn particular, using T0 = √ T , and assuming B > mT 3/4 gives a regret bound of\nÕ ( ( OPT\nB + 1 )\nm √ T ) ."
    }, {
      "heading" : "A Concentration Inequalities",
      "text" : "Lemma 6 (Azuma-Hoeffding inequality). If a super-martingale (Yt; t ≥ 0), corresponding to filtration Ft, satisfies |Yt − Yt−1| ≤ ct for some constant ct, for all t = 1, . . . , T , then for any a ≥ 0,\nPr(YT − Y0 ≥ a) ≤ e − a2 2 ∑T t=1 c2 t ."
    }, {
      "heading" : "B Benchmark",
      "text" : "Proof of Lemma 1. For an instantiation ω = (Xt, Vt) T t=1 of the sequence of inputs, let vector p ∗ t (ω) ∈ ∆K+1 denote the distribution over actions (plus no-op) taken by the optimal adaptive policy at time t. Then,\nOPT = Eω∼DT [ ∑T t=1 r ⊤ t p ∗ t (ω)] (12)\nAlso, since this is a feasible policy,\nEω∼DT [ T ∑\nt=1\nV ⊤t p ∗ t (ω)] ≤ B1 (13)\nConstruct a static context dependent policy π∗ as follows: for any X ∈ [0, 1]m×K , define\nπ∗(X) := 1\nT\nT ∑\nt=1\nEω[p ∗ t (ω)|Xt = X ].\nIntuitively, π∗(X)a denotes (in hindsight) the probability that the optimal adaptive policy takes an action a when presented with a context X , averaged over all time steps. Now, by definition of r(π),v(π), from above definition of π∗, and (12), (13),\nT r(π∗) = TEX∼D[µ ⊤ ∗ Xπ ∗(X)] = Eω[ ∑T t=1 Vtp ∗ t (ω)] = OPT,\nTv(π∗) = TEX∼D[W ⊤ ∗ Xπ ∗(X)] = Eω [ ∑T t=1 Vtp ∗ t (ω)] ≤ B1,"
    }, {
      "heading" : "C Hardness of linear AMO",
      "text" : "In this section we show that finding the best linear policy is NP-Hard. The input to the problem is, for each t ∈ [T ], and each arm a ∈ [K], a context xt(a) ∈ [0, 1]m, and a reward rt(a) ∈ [−1, 1]. The output is a vector θ ∈ ℜm that maximizes ∑t rt(at) where\nat = arg max a∈[K]\n{xt(a)⊤θ}.\nWe give a reduction from the problem of learning halfspaces with noise [25]. The input to this problem is for some integer n, for each i ∈ [n], a vector zi ∈ [0, 1]m, and yi ∈ {−1,+1}. The output is a vector θ ∈ ℜm that maximizes\nn ∑\ni=1\nsign(z⊤i θ)yi.\nGiven an instance of the problem of learning halfspaces with noise, construct an instance of the linear AMO as follows. The time horizon T = n, and the number of arms K = 2. For each t ∈ [T ], the context of\nthe first arm, xt(1) = zt, and its reward rt(1) = yt. The context of the second arm, xt(2) = 0, the all zeroes vector, and the reward rt(2) is also 0.\nThe total reward of a linear policy w.r.t a vector θ for this instance is\n|{i : sign(z⊤i θ) = 1, yi = 1}| − |{i : sign(z⊤i θ) = 1, yi = −1}|.\nIt is easy to see that this is an affine transformation of the objective for the problem of learning halfspaces with noise."
    }, {
      "heading" : "D Confidence ellipsoids",
      "text" : "Proof of Corollary 1. The following holds with probability 1− δ. T ∑\nt=1\n|µ̃⊤t xt − µ⊤∗ xt| ≤ T ∑\nt=1\n‖µ̃t − µ∗‖Mt‖xt‖M−1t\n≤ ( √ m ln ( 1 + tm\nδ\n) + √ m\n)\n√\nmT ln(T ).\nThe inequality in the first line is a matrix-norm version of Cauchy-Schwartz (Lemma 7). The inequality in the second line is due to Lemmas 2 and 3. The lemma follows from multiplying out the two factors in the second line.\nLemma 7. For any positive definite matrix M ∈ Rn×n and any two vectors a,b ∈ Rn, |a⊤b| ≤ ‖a‖M‖b‖M−1 .\nProof. Since M is positive definite, there exists a matrix M1/2 such that M = M1/2M ⊤ 1/2. Further, M −1 = M⊤−1/2M−1/2 where M−1/2 = M −1 1/2.\n‖a⊤M1/2‖2 = a⊤M1/2M⊤1/2a = a⊤Ma = ‖a‖2M .\nSimilarly, ‖M−1/2b‖2 = ‖b‖2M−1 . Now applying Cauchy-Schwartz, we get that\n|a⊤b| = |a⊤M1/2M−1/2b| ≤ ‖a⊤M1/2‖‖M−1/2b‖ = ‖a‖M‖b‖M−1 .\nProof of Corollary 2. Here, the first claim follows simply from definition of W̃t(a) and the observation that with probability 1 − δ, W ∗ ∈ Gt. To obtain the second claim, apply Corollary 1 with µ∗ = w∗j ,yt = xt(at), µ̃t = [W̃t(at)]j (the j th column of W̃t(at)), to bound | ∑ t([W̃t(at)]j−w∗j)⊤xt(at)| ≤ ∑\nt |([W̃t(at)]j− w∗j)⊤xt(at)| for every j, and then take the norm."
    }, {
      "heading" : "E Appendix for Section 3.2",
      "text" : "Proof of Theorem 2: We will use R′ to denote the main term in the regret bound.\nR′(T ) := O ( m √ ln(mdT/δ) ln(T )T )\nLet τ be the stopping time of the algorithm. Let Ht−1 be the history of plays and observations before time t, i.e. Ht−1 := {θτ , Xτ , aτ , rτ (aτ ),vτ (aτ ), τ = 1, . . . , t− 1}. Note that Ht−1 determines θt, µ̂t, Ŵt,Gt, but it does not determine Xt, at, W̃t (since at and W̃t(a) depend on the context Xt at time t). The proof is in 3 steps:\nStep 1: Since E[vt(at)|Xt, at, Ht−1] = W⊤∗ xt(at), we apply Azuma-Hoeffding to get that with probability 1− δ,\n∥ ∥ ∑τ t=1 vt(at)−W⊤∗ xt(at) ∥ ∥ ∞ ≤ R ′(T ). (14)\nSimilarly, a lower bound on the sum of µ⊤∗ xt(at) is sufficient.\nStep 2: From Corollary 2, with probability 1− δ, ∥\n∥ ∥ ∑T t=1(W∗ − W̃t(at))⊤xt(at)\n∥ ∥ ∥\n∞ ≤ R′(T ). (15)\nIt is therefore sufficient to bound the sum of the vectors W̃t(at) ⊤xt(at), and similarly for µ̃t(at) ⊤xt(at). We use the shorthand notation of r̃t := µt(at) ⊤xt(at), r̃sum := ∑τ t=1 r̃t, ṽt := W̃t(at) ⊤xt(at) and ṽsum := ∑τ t=1 ṽt for the rest of this proof.\nStep 3: The proof is completed by showing that\nE[r̃sum] ≥ OPT− ZR′(T ).\nLemma 8. τ ∑\nt=1\nE[r̃t|Ht−1] ≥ τ\nT OPT+ Z\nτ ∑\nt=1\nθt · E[ṽt − 1 B\nT |Ht−1]\nProof. Let r∗t := µt(at) ⊤Xtπ∗(Xt) and v̂∗t := W̃t(at) ⊤Xtπ∗(Xt). By Corollary 2, with probability 1− δ, we have that TEXt [r ∗ t |Ht−1] ≥ OPT, and EXt [v̂∗t |Ht−1] ≤ BT 1. By the choice made by the algorithm,\nr̃t − Z(θt · ṽt) ≥ r∗t − Z(θt · v̂∗t ) EXt [r̃t − Z(θt · ṽt)|Ht−1] ≥ EXt [r̃t|Ht−1]− Z(θt · E[ṽt|Ht−1])\n≥ 1 T OPT− Zθt · B1 T\nSumming above inequality for t = 1 to τ gives the lemma statement.\nLemma 9. τ ∑\nt=1\nθt · (ṽt − B T 1) ≥ B − τB T −R′(T ).\nProof. Recall that gt(θt) = θt · ( ṽt − BT 1 ) , therefore the LHS in the required inequality is ∑τ\nt=1 gt(θt). Let θ∗ := argmax||θ||1≤1,θ≥0 ∑τ t=1 gt(θ). We use the regret definition for the OCO algorithm to get that ∑τ t=1 gt(θt) ≥ ∑τ t=1 gt(θ ∗)−R(T ). Note that fromt the regret bound given in Lemma 4, R(T ) ≤ R′(T ).\nCase 1: τ < T . This means that ∑τ t=1(vt(at) · ej) ≥ B for some j. Then from (14) and (15), it must be that\n∑τ t=1(ṽt · ej) ≥ B −R′(T ) so that ∑τ t=1 gt(θ ∗) ≥∑τt=1 gt(ej) ≥ B − τBT −R′(T ).\nCase 2: τ = T . In this case, B − τT B = 0 = ∑τ t=1 gt(0) ≤ ∑τ t=1 gt(θ ∗), which completes the proof of the lemma.\nNow, we are ready to prove Theorem 2, which states that Algorithm 1 achieves a regret of ZR′(T ). Proof of Theorem 2. Substituting the inequality from Lemma 9 in Lemma 8, we get\nτ ∑\nt=1\nE[r̃t|Ht−1] ≥ τ\nT OPT+ ZB\n( 1− τ T ) − ZR′(T )\nAlso, Z ≥ OPTB . Substituting in above,\nE[r̃sum] =\nτ ∑\nt=1\nE[r̃t|Ht−1] ≥ τ T OPT+OPT(1− τ T )− ZR(T )\n≥ OPT− ZR′(T )\nFrom Steps 1 and 2, this implies a lower bound on E[ ∑τ\nt=1 rt(at)]. The proof is now completed by using Azuma-Hoeffding to bound the actual total reward with high probability."
    }, {
      "heading" : "F Appendix for Section 3.3",
      "text" : "Proof of Lemma 5. Let us define an “intermediate sample optimal” as:\nOPT γ := maxq\nT T0 ∑T0 i=1 µ ⊤ ∗ Xiπ(Xi)])\nsuch that TT0 ∑T0 i=1 W ⊤ ∗ Xiπ(Xi) ≤ B + γ\n(16)\nAbove sample optimal knows the parameters µ∗,W∗, the error comes only from approximating the expected value over context distribution by average over the observed contexts. We do not actually compute OPT γ , but will use it for the convenience of proof exposition. The proof involves two steps.\nStep 1: Bound |OPTγ −OPT|.\nStep 2: Bound | ˆOPT2γ −OPTγ |\nStep 1 bound can be borrowed from the work on Online Stochastic Convex Programming in [4]: since µ∗,W\n∗ is known, so there is effectively full information before making the decision, i.e., consider the vectors [µ⊤∗ xt(a),W ⊤ ∗ xt(a)] as outcome vectors which can be observed for all arms a before choosing the distribution over arms to be played at time t, therefore, the setting in [4] applies. In fact, ˆOPT γ as defined by Equation (F.10) in [4] when At = {[µ⊤∗ xt(a),W⊤∗ xt(a)], a ∈ [K]}, f identity, and S = {v−1 ≤ BT }, is same as 1T times OPT γ defined here. And using Lemma F.4 and Lemma F.6 in [4] (using L = 1, Z∗ = OPT/B), we obtain that for any γ ≥ (\nT T0\n)\n2m √ T0ln(T0) ln(T0d/δ), with probability 1−O(δ),\nOPT− γ ≤ OPTγ ≤ OPT+ 2γ(OPT B + 1). (17)\nFor Step 2, we show that with probability 1− δ, for all π, γ ≥ (\nT T0\n)\n2m √\nT0ln(T0) ln(T0d/δ)\n| T0 ∑\ni=1\n(µ̂i − µ∗)⊤Xiπ(Xi)| ≤ γ (18)\n‖ T T0\nT0 ∑\ni=1\n(Ŵi −W∗)⊤Xiπ(Xi)‖∞ ≤ γ (19)\nThis is sufficient to prove both lower and upper bound on ˆOPT 2γ for γ ≥ (\nT T0\n)\n2m √\nT0ln(T0) ln(T0d/δ). For\nlower bound, we can simply use (19) for optimal policy for OPT γ , denoted by π̄. This implies that (because of relaxation of distance constraint by γ) π̄ is a feasible primal solution for ˆOPT 2γ , and therefore using (17) and (18),\nˆOPT 2γ + γ ≥ OPTγ ≥ OPT− γ.\nFor the upper bound, we can use (19) for the optimal policy π̂ for ˆOPT 2γ . Then, using (17) and (18),\nˆOPT 2γ ≤ OPT3γ + γ ≤ OPT+ 6γ(OPT\nB + 1) + γ.\nCombining, this proves the desired lemma statement:\nOPT− 2γ ≤ ˆOPT2γ ≤ OPT+ 7γ(OPT B + 1) (20)\nWhat remains is to proof the claim in (18) and (19). We show the proof for (19), the proof for (18) is similar. Observe that for any π,\n‖ T0 ∑\nt=1\n(Ŵt −W∗)⊤Xtπ(Xt)‖∞ ≤ T0 ∑\nt=1\n‖(Ŵt −W∗)⊤Xtπ(Xt)‖∞\n≤ T0 ∑\nt=1\n‖Ŵt −W∗‖Mt‖Xtπ(Xt)‖M−1t\nwhere ‖Ŵt −W∗‖Mt = maxj ‖ŵtj −w∗j‖Mt . Now, applying Lemma 2 to every column ŵtj of Ŵt, we have that with probability 1− δ for all t,\n‖Ŵt −W∗‖Mt ≤ 2 √ m log(td/δ) ≤ 2 √ m log(T0d/δ)\nAnd, by choice of pt ‖Xtπ(Xt)‖M−1t ≤ ‖Xtpt‖M−1t .\nAlso, by Lemma 3, T0 ∑\nt=1\n‖Xtpt‖M−1t ≤ √ mT0 ln(T0)\nTherefore, substituting,\n‖ T0 ∑\nt=1\n(Ŵt −W∗)⊤Xtπ(Xt)‖∞ ≤ (2 √ m log(T0d/δ))\nT0 ∑\nt=1\n‖Xtpt‖M−1t\n≤ (2 √ m log(T0d/δ)) √ mT0 ln(T0) ≤ T0 T γ"
    } ],
    "references" : [ ],
    "referenceMentions" : [ ],
    "year" : 2016,
    "abstractText" : "<lb>We consider the linear contextual bandit problem with resource consumption, in addition to reward<lb>generation. In each round, the outcome of pulling an arm is a reward as well as a vector of resource<lb>consumptions. The expected values of these outcomes depend linearly on the context of that arm. The<lb>budget/capacity constraints require that the total consumption doesn’t exceed the budget for each re-<lb>source. The objective is once again to maximize the total reward. This problem turns out to be a<lb>common generalization of classic linear contextual bandits (linContextual) [7, 16, 1], bandits with knap-<lb>sacks (BwK) [3, 10], and the online stochastic packing problem (OSPP) [4, 19]. We present algorithms<lb>with near-optimal regret bounds for this problem. Our bounds compare favorably to results on the<lb>unstructured version of the problem [5, 11] where the relation between the contexts and the outcomes<lb>could be arbitrary, but the algorithm only competes against a fixed set of policies accessible through<lb>an optimization oracle. We combine techniques from the work on linContextual, BwK and OSPP in a<lb>nontrivial manner while also tackling new difficulties that are not present in any of these special cases.",
    "creator" : "LaTeX with hyperref package"
  }
}